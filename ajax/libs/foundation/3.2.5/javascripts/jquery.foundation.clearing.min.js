(function(e,t,n){"use strict";var i={templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="#"><p class="clearing-caption"></p><a href="#" class="clearing-main-left"></a><a href="#" class="clearing-main-right"></a></div>'},close_selectors:"a.clearing-close",initialized:!1,locked:!1},r={init:function(){return this.find("ul[data-clearing]").each(function(){var t=(e(n),e(this)),o=o||{},a=t.data("fndtn.clearing.settings");a||(o.$parent=t.parent(),t.data("fndtn.clearing.settings",e.extend({},i,o)),r.assemble(t.find("li")),i.initialized||(r.events(t),Modernizr.touch&&r.swipe_events()))})},events:function(o){var a=o.data("fndtn.clearing.settings");e(n).on("click.fndtn.clearing","ul[data-clearing] li",function(t,n,i){var n=n||e(this),i=i||n,o=n.parent().data("fndtn.clearing.settings");t.preventDefault(),o||n.parent().foundationClearing(),r.open(e(t.target),n,i),r.update_paddles(i)}).on("click.fndtn.clearing",".clearing-main-right",function(e){r.nav(e,"next")}).on("click.fndtn.clearing",".clearing-main-left",function(e){r.nav(e,"prev")}).on("click.fndtn.clearing",a.close_selectors,this.close).on("keydown.fndtn.clearing",this.keydown),e(t).on("resize.fndtn.clearing",this.resize),i.initialized=!0},swipe_events:function(){e(n).bind("swipeleft","ul[data-clearing]",function(e){r.nav(e,"next")}).bind("swiperight","ul[data-clearing]",function(e){r.nav(e,"prev")}).bind("movestart","ul[data-clearing]",function(e){(e.distX>e.distY&&e.distX<-e.distY||e.distX<e.distY&&e.distX>-e.distY)&&e.preventDefault()})},assemble:function(e){var t=e.parent(),n=t.data("fndtn.clearing.settings"),i=t.detach(),r={grid:'<div class="carousel">'+this.outerHTML(i[0])+"</div>",viewing:n.templates.viewing},o='<div class="clearing-assembled"><div>'+r.viewing+r.grid+"</div></div>";return n.$parent.append(o)},open:function(e,t,n){var i=n.closest(".clearing-assembled"),o=i.find("div:first"),a=o.find(".visible-img"),s=a.find("img").not(e);r.locked()||(s.attr("src",this.load(e)),s.loaded(function(){i.addClass("clearing-blackout"),o.addClass("clearing-container"),this.caption(a.find(".clearing-caption"),e),a.show(),this.fix_height(n),this.center(s),this.shift(t,n,function(){n.siblings().removeClass("visible"),n.addClass("visible")})}.bind(this)))},close:function(t){t.preventDefault();var n,r,o=function(e){return/blackout/.test(e.selector)?e:e.closest(".clearing-blackout")}(e(this));return this===t.target&&o&&(n=o.find("div:first"),r=n.find(".visible-img"),i.prev_index=0,o.find("ul[data-clearing]").attr("style",""),o.removeClass("clearing-blackout"),n.removeClass("clearing-container"),r.hide()),!1},keydown:function(t){var n=e(".clearing-blackout").find("ul[data-clearing]");39===t.which&&r.go(n,"next"),37===t.which&&r.go(n,"prev"),27===t.which&&e("a.clearing-close").trigger("click")},nav:function(t,n){var i=e(".clearing-blackout").find("ul[data-clearing]");t.preventDefault(),this.go(i,n)},resize:function(){var t=e(".clearing-blackout .visible-img").find("img");t.length>0&&r.center(t)},fix_height:function(t){var n=t.siblings();n.each(function(){var t=e(this),n=t.find("img");t.height()>n.outerHeight()&&t.addClass("fix-height")}).closest("ul").width(100*n.length+"%")},update_paddles:function(e){var t=e.closest(".carousel").siblings(".visible-img");e.next().length>0?t.find(".clearing-main-right").removeClass("disabled"):t.find(".clearing-main-right").addClass("disabled"),e.prev().length>0?t.find(".clearing-main-left").removeClass("disabled"):t.find(".clearing-main-left").addClass("disabled")},load:function(e){var t=e.parent().attr("href");return this.preload(e),t?t:e.attr("src")},preload:function(e){this.img(e.closest("li").next()),this.img(e.closest("li").prev())},img:function(e){if(e.length>0){var t=new Image,n=e.find("a");t.src=n.length>0?n.attr("href"):e.find("img").attr("src")}},caption:function(e,t){var n=t.data("caption");n?e.text(n).show():e.text("").hide()},go:function(e,t){var n=e.find(".visible"),i=n[t]();i.length>0&&i.find("img").trigger("click",[n,i])},shift:function(e,t,n){var r,o=t.parent(),a=i.prev_index,s=this.direction(o,e,t),l=parseInt(o.css("left"),10),c=t.outerWidth();t.index()===a||/skip/.test(s)?/skip/.test(s)&&(r=t.index()-i.up_count,this.lock(),r>0?o.animate({left:-(r*c)},300,this.unlock):o.animate({left:0},300,this.unlock)):/left/.test(s)?(this.lock(),o.animate({left:l+c},300,this.unlock)):/right/.test(s)&&(this.lock(),o.animate({left:l-c},300,this.unlock)),n()},lock:function(){i.locked=!0},unlock:function(){i.locked=!1},locked:function(){return i.locked},direction:function(t,n,r){var o,a=t.find("li"),s=a.outerWidth()+a.outerWidth()/4,l=Math.floor(e(".clearing-container").outerWidth()/s)-1,c=a.index(r);return i.up_count=l,o=this.adjacent(i.prev_index,c)?c>l&&c>i.prev_index?"right":c>l-1&&i.prev_index>=c?"left":!1:"skip",i.prev_index=c,o},adjacent:function(e,t){for(var n=t+1;n>=t-1;n--)if(n===e)return!0;return!1},center:function(e){e.css({marginLeft:-(e.outerWidth()/2),marginTop:-(e.outerHeight()/2)})},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)}};e.fn.foundationClearing=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.foundationClearing"),undefined):r.init.apply(this,arguments)},function(e){e.fn.loaded=function(t,n){function i(){s-=1,!s&&t()}function r(){if(this.one("load",i),e.browser.msie){var t=this.attr("src"),n=t.match(/\?/)?"&":"?";n+=o.cachePrefix+"="+(new Date).getTime(),this.attr("src",t+n)}}var o=e.extend({},e.fn.loaded.defaults,n),a=this.find("img").add(this.filter("img")),s=a.length;return a.each(function(){var t=e(this);return t.attr("src")?(this.complete||4===this.readyState?i():r.call(t),undefined):(i(),undefined)})},e.fn.loaded.defaults={cachePrefix:"random"}}(jQuery)})(jQuery,this,this.document);