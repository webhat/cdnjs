(function(e,t,n,i){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.0.0",settings:{templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="//:0"><p class="clearing-caption"></p><a href="#" class="clearing-main-left"><span></span></a><a href="#" class="clearing-main-right"><span></span></a></div>'},close_selectors:".clearing-close",init:!1,locked:!1},init:function(t,n,i){return this.scope=this.scope||t,Foundation.inherit(this,"set_data get_data remove_data throttle"),"object"==typeof n&&(i=e.extend(!0,this.settings,n)),"string"!=typeof n?(e(this.scope).find("ul[data-clearing]").each(function(){var t=Foundation.libs.clearing,n=e(this),i=i||{},r=t.get_data(n);r||(i.$parent=n.parent(),t.set_data(n,e.extend(!0,t.settings,i)),t.assemble(n.find("li")),t.settings.init||t.events().swipe_events())}),this.settings.init):this[n].call(this,i)},events:function(){var n=this;return e(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(t,i,r){var i=i||e(this),r=r||i,o=n.get_data(i.parent());t.preventDefault(),o||n.init(),n.open(e(t.target),i,r),n.update_paddles(r)}).on("click.fndtn.clearing",".clearing-main-right",function(e){this.nav(e,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-left",function(e){this.nav(e,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(e){Foundation.libs.clearing.close(e,this)}).on("keydown.fndtn.clearing",function(e){this.keydown(e)}.bind(this)),e(t).on("resize.fndtn.clearing",function(){this.resize()}.bind(this)),this.settings.init=!0,this},swipe_events:function(){var t=this;e(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(t){t.touches||(t=t.originalEvent);var n={start_page_x:t.touches[0].pageX,start_page_y:t.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:i};e(this).data("swipe-transition",n),t.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(n){if(n.touches||(n=n.originalEvent),!(n.touches.length>1||n.scale&&1!==n.scale)){var r=e(this).data("swipe-transition");if(r===i&&(r={}),r.delta_x=n.touches[0].pageX-r.start_page_x,r.is_scrolling===i&&(r.is_scrolling=!!(r.is_scrolling||Math.abs(r.delta_x)<Math.abs(n.touches[0].pageY-r.start_page_y))),!r.is_scrolling&&!r.active){n.preventDefault();var o=0>r.delta_x?"next":"prev";r.active=!0,t.nav(n,o)}}}).on("touchend.fndtn.clearing",".visible-img",function(t){e(this).data("swipe-transition",{}),t.stopPropagation()})},assemble:function(e){var t=e.parent(),n=this.get_data(t),i=t.detach(),r={grid:'<div class="carousel">'+this.outerHTML(i[0])+"</div>",viewing:n.templates.viewing},o='<div class="clearing-assembled"><div>'+r.viewing+r.grid+"</div></div>";return n.$parent.append(o)},open:function(e,t,n){var i=n.closest(".clearing-assembled"),r=i.find("div").first(),o=r.find(".visible-img"),a=o.find("img").not(e);this.locked()||(a.attr("src",this.load(e)),this.loaded(a,function(){i.addClass("clearing-blackout"),r.addClass("clearing-container"),o.show(),this.fix_height(n).caption(o.find(".clearing-caption"),e).center(a).shift(t,n,function(){n.siblings().removeClass("visible"),n.addClass("visible")})}.bind(this)))},close:function(t,n){t.preventDefault();var i,r,o=function(e){return/blackout/.test(e.selector)?e:e.closest(".clearing-blackout")}(e(n));return n===t.target&&o&&(i=o.find("div").first(),r=i.find(".visible-img"),this.settings.prev_index=0,o.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout"),i.removeClass("clearing-container"),r.hide()),!1},keydown:function(t){var n=e(".clearing-blackout").find("ul[data-clearing]");39===t.which&&this.go(n,"next"),37===t.which&&this.go(n,"prev"),27===t.which&&e("a.clearing-close").trigger("click")},nav:function(t,n){var i=e(".clearing-blackout").find("ul[data-clearing]");t.preventDefault(),this.go(i,n)},resize:function(){var t=e(".clearing-blackout .visible-img").find("img");t.length&&this.center(t)},fix_height:function(t){var n=t.parent().children(),i=this;return n.each(function(){var t=e(this),n=t.find("img");t.height()>i.outerHeight(n)&&t.addClass("fix-height")}).closest("ul").width(100*n.length+"%"),this},update_paddles:function(e){var t=e.closest(".carousel").siblings(".visible-img");e.next().length?t.find(".clearing-main-right").removeClass("disabled"):t.find(".clearing-main-right").addClass("disabled"),e.prev().length?t.find(".clearing-main-left").removeClass("disabled"):t.find(".clearing-main-left").addClass("disabled")},center:function(e){return e.css({marginLeft:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)}),this},load:function(e){var t=e.parent().attr("href");return this.preload(e),t?t:e.attr("src")},preload:function(e){this.img(e.closest("li").next()).img(e.closest("li").prev())},loaded:function(e,t){function n(){t()}function r(){if(this.one("load",n),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=this.attr("src"),t=e.match(/\?/)?"&":"?";t+="random="+(new Date).getTime(),this.attr("src",e+t)}}return e.attr("src")?(this.complete||4===this.readyState?n():r.call(e),i):(n(),i)},img:function(e){if(e.length){var t=new Image,n=e.find("a");t.src=n.length?n.attr("href"):e.find("img").attr("src")}return this},caption:function(e,t){var n=t.data("caption");return n?e.text(n).show():e.text("").hide(),this},go:function(e,t){var n=e.find(".visible"),i=n[t]();i.length&&i.find("img").trigger("click",[n,i])},shift:function(e,t,n){var i,r=t.parent(),o=this.settings.prev_index||t.index(),a=this.direction(r,e,t),s=parseInt(r.css("left"),10),l=this.outerWidth(t);t.index()===o||/skip/.test(a)?/skip/.test(a)&&(i=t.index()-this.settings.up_count,this.lock(),i>0?r.animate({left:-(i*l)},300,this.unlock()):r.animate({left:0},300,this.unlock())):/left/.test(a)?(this.lock(),r.animate({left:s+l},300,this.unlock())):/right/.test(a)&&(this.lock(),r.animate({left:s-l},300,this.unlock())),n()},direction:function(t,n,i){var r,o=t.find("li"),a=this.outerWidth(o)+this.outerWidth(o)/4,s=Math.floor(this.outerWidth(e(".clearing-container"))/a)-1,l=o.index(i);return this.settings.up_count=s,r=this.adjacent(this.settings.prev_index,l)?l>s&&l>this.settings.prev_index?"right":l>s-1&&this.settings.prev_index>=l?"left":!1:"skip",this.settings.prev_index=l,r},adjacent:function(e,t){for(var n=t+1;n>=t-1;n--)if(n===e)return!0;return!1},lock:function(){this.settings.locked=!0},unlock:function(){this.settings.locked=!1},locked:function(){return this.settings.locked},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},off:function(){e(this.scope).off(".fndtn.clearing"),e(t).off(".fndtn.clearing"),this.remove_data(),this.settings.init=!1}}})(Foundation.zj,this,this.document);