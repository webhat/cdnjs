/* Version 0.95 */
/* Version 0.95 */
/*
    Copyright 2008-2012
        Matthias Ehmann,
        Michael Gerhaeuser,
        Carsten Miller,
        Bianca Valentin,
        Alfred Wassermann,
        Peter Wilfahrt

    This file is part of JSXGraph.

    JSXGraph is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    JSXGraph is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with JSXGraph.  If not, see <http://www.gnu.org/licenses/>.
*/
    JXG.CinderellaReader=new function(){this.parseData=function(l){var t,v,u,s,n,p,m,d,b,q,f,o,h,r,g,c,a,e,x,w,y;t=this.data.split("\n");for(v=0;v<t.length;v++){if(t[v].search(/FreePoint.+/)!=-1){n=t[v].slice(t[v].search(/FreePoint.+/)+11);n=n.split(",");for(u=0;u<n.length;u++){n[u]=n[u].slice(0,n[u].search(/\+i\*/))}m=t[v].match(/"[A-Za-z]*"/);m=m[0].slice(1,m[0].length-1);o=this.readPointProperties(t,v);v=o[1];l.create("point",[n[0]/n[2],-1*n[1]/n[2]],{name:m,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]})}else{if(t[v].search(/Join\(.+/)!=-1||t[v].search(/Segment\(.+/)!=-1){if(t[v].search(/Join\(.+/)!=-1){d=t[v].slice(t[v].search(/Join.+/)+5);b=false}else{d=t[v].slice(t[v].search(/Segment.+/)+8);b=true}d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z]*"/);m=m[0].slice(1,m[0].length-1);o=this.readLineProperties(t,v);v=o[2];l.create("line",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{straightFirst:!b,straightLast:!b,name:m,withLabel:true,strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]})}else{if(t[v].search(/CircleMP.+/)!=-1){d=t[v].slice(t[v].search(/CircleMP.+/)+9);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];l.create("circle",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{if(t[v].search(/CircleByFixedRadius.+/)!=-1||t[v].search(/CircleByRadius.+/)!=-1){if(t[v].search(/CircleByFixedRadius.+/)!=-1){d=t[v].slice(t[v].search(/CircleByFixedRadius.+/)+20)}else{d=t[v].slice(t[v].search(/CircleByRadius.+/)+15)}d=d.split(",");p=d[0].match(/"[A-Za-z0-9]*"/)[0];p=p.slice(1,p.length-1);m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);q=d[1].slice(0,d[1].search(/\+i\*/));o=this.readCircleProperties(t,v);v=o[3];l.create("circle",[JXG.getReference(l,p),Math.sqrt(1*q)],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{if(t[v].search(/PointOnCircle.+/)!=-1){d=t[v].split(":=");m=d[0].match(/"[A-Za-z]*"/)[0];m=m.slice(1,m.length-1);p=d[1].match(/"[A-Za-z0-9]*"/)[0];p=p.slice(1,p.length-1);d=d[1].match(/\[.*\]/)[0];d=d.split(",");for(s=0;s<d.length;s++){d[s]=d[s].split("+i*")}d[0]=1*(d[0][0].slice(1));d[1]=1*d[1][0];if(t[v][1]=="n"){d[0]=-1*d[0];d[1]=-1*d[1]}o=this.readPointProperties(t,v);v=o[1];f=JXG.getReference(l,p);l.create("glider",[f.center.coords.usrCoords[1]+d[0],f.center.coords.usrCoords[2]-d[1],f],{name:m,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]})}else{if(t[v].search(/PointOnLine.+/)!=-1){d=t[v].split(":=");m=d[0].match(/"[A-Za-z]*"/)[0];m=m.slice(1,m.length-1);p=d[1].match(/"[A-Za-z0-9]*"/)[0];p=p.slice(1,p.length-1);n=d[1].match(/\[.*\]/)[0];n=n.split(",");n[0]=1*(n[0].slice(1,n[0].search(/\+i\*/)));for(u=1;u<n.length;u++){n[u]=1*(n[u].slice(0,n[u].search(/\+i\*/)))}o=this.readPointProperties(t,v);v=o[1];l.create("glider",[n[0]/n[2],-1*n[1]/n[2],JXG.getReference(l,p)],{name:m,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]})}else{if(t[v].search(/Mid\(.+/)!=-1){d=t[v].slice(t[v].search(/Mid.+/)+4);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readPointProperties(t,v);v=o[1];l.create("midpoint",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{name:m,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]})}else{if(t[v].search(/CircleBy3\(.+/)!=-1){d=t[v].slice(t[v].search(/CircleBy3.+/)+10);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];f=l.create("circumcircle",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),JXG.getReference(l,p[2])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2],point:{name:"",visible:false}})}else{if(t[v].search(/Parallel\(.+/)!=-1){d=t[v].slice(t[v].search(/Parallel.+/)+9);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readLineProperties(t,v);v=o[2];l.create("parallel",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{name:m,withLabel:true,strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]})}else{if(t[v].search(/Orthogonal\(.+/)!=-1){d=t[v].slice(t[v].search(/Parallel.+/)+11);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readLineProperties(t,v);v=o[2];l.create("normal",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{name:m,withLabel:true,strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]})}else{if(t[v].search(/ConicBy5\(.+/)!=-1){d=t[v].slice(t[v].search(/ConicBy5.+/)+9);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];l.create("conic",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),JXG.getReference(l,p[2]),JXG.getReference(l,p[3]),JXG.getReference(l,p[4])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{if(t[v].search(/ConicFoci\(.+/)!=-1||t[v].search(/ConicFociH\(.+/)!=-1){d=t[v].split(":=");m=d[0].match(/"[A-Za-z0-9]*"/)[0];m=m.slice(1,m.length-1);p=d[1].match(/"[A-Za-z0-9]*"/g);for(u=0;u<p.length;u++){p[u]=p[u].slice(1,p[u].length-1)}o=this.readCircleProperties(t,v);if(t[v].search(/ConicFociH\(.+/)!=-1){l.create("hyperbola",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),JXG.getReference(l,p[2])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{l.create("ellipse",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),JXG.getReference(l,p[2])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}v=o[3]}else{if(t[v].search(/ConicParabolaPL\(.+/)!=-1){d=t[v].slice(t[v].search(/ConicParabolaPL.+/)+16);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];l.create("parabola",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{if(t[v].search(/Poly\(.+/)!=-1){d=t[v].slice(t[v].search(/Poly.+/)+5);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1);p[u]=JXG.getReference(l,p[u])}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];h=l.create("polygon",p,{name:m});h.setProperty({fillColor:o[1],fillOpacity:o[2]});for(u=0;u<h.borders.length;u++){h.borders[u].setProperty({strokeColor:o[0][0],strokeWidth:o[0][2]})}}else{if(t[v].search(/Arc\(.+/)!=-1){d=t[v].slice(t[v].search(/Arc.+/)+4);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];h=l.create("circumcirclearc",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),JXG.getReference(l,p[2])],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{if(t[v].search(/Through\(.+/)!=-1){d=t[v].slice(t[v].search(/Through.+/)+8);p=d.match(/"[A-Za-z]*"/)[0];p=p.slice(1,p.length-1);n=d.match(/\[.*\]/)[0];n=n.split(",");n[0]=1*(n[0].slice(1,n[0].search(/\+i\*/)));for(u=1;u<n.length;u++){n[u]=1*(n[u].slice(0,n[u].search(/\+i\*/)))}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);u=JXG.getReference(l,p);r=l.create("point",[u.coords.usrCoords[1]+1*n[0],u.coords.usrCoords[2]+1*n[1]],{visible:false});o=this.readLineProperties(t,v);v=o[2];l.create("line",[u,r],{name:m,withLabel:true,strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]})}else{if(t[v].search(/:=Compass\(.+/)!=-1){d=t[v].slice(t[v].search(/Compass.+/)+8);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readCircleProperties(t,v);v=o[3];q=(function(j,i){return function(){return JXG.getReference(i,j[0]).Dist(JXG.getReference(i,j[1]))}})(p,l);l.create("circle",[JXG.getReference(l,p[2]),q],{name:m,strokeColor:o[0][0],fillColor:o[1],fillOpacity:o[2],strokeWidth:o[0][2]})}else{if(t[v].search(/AngularBisector\(.+/)!=-1){d=t[v].split(":=");d[0]=d[0].split(",");if(d[0][0]=="{null"){m=""}else{m=d[0][0].slice(2,d[0][0].length-1)}if(d[0][1]=="null"){g=""}else{g=d[0][1].slice(1,d[0][1].length-1)}d[1]=d[1].match(/"[A-Za-z0-9]*"/g);p=[];p[0]=d[1][0].slice(1,d[1][0].length-1);p[1]=d[1][1].slice(1,d[1][1].length-1);o=this.readLineProperties(t,v);v=o[2];if(!(m==""||g=="")){c=this.readLineProperties(t,v);v=o[2]}a=l.create("bisectorlines",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1])],{line1:{name:g},line2:{name:m},withLabel:true});if(m==""){a.line2.setProperty({visible:false});a.line1.setProperty({strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]})}else{if(g==""){a.line1.setProperty({visible:false});a.line2.setProperty({strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]})}else{a.line1.setProperty({strokeColor:o[0][0],strokeWidth:o[0][2],dash:o[1]});a.line2.setProperty({strokeColor:c[0][0],strokeWidth:c[0][2],dash:c[1]})}}}else{if(t[v].search(/Meet\(.+/)!=-1){d=t[v].slice(t[v].search(/Meet.+/)+5);d=d.split(",");p=[];for(u=0;u<d.length;u++){p[u]=d[u].match(/"[A-Za-z]*"/)[0];p[u]=p[u].slice(1,p[u].length-1)}m=t[v].match(/"[A-Za-z0-9]*"/);m=m[0].slice(1,m[0].length-1);o=this.readPointProperties(t,v);v=o[1];l.create("intersection",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),0],{name:m,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]})}else{if(t[v].search(/IntersectionConicLine\(.+/)!=-1||t[v].search(/IntersectionCircleCircle\(.+/)!=-1){if(t[v].search(/IntersectionConicLine\(.+/)!=-1){s=0;u=1}else{s=1;u=0}d=t[v].split(":=");d[0]=d[0].split(",");if(d[0][0]=="{null"){m=""}else{m=d[0][0].slice(2,d[0][0].length-1)}if(d[0][1]=="null"){g=""}else{g=d[0][1].slice(1,d[0][1].length-1)}d[1]=d[1].match(/"[A-Za-z0-9]*"/g);p=[];p[0]=d[1][0].slice(1,d[1][0].length-1);p[1]=d[1][1].slice(1,d[1][1].length-1);o=this.readPointProperties(t,v);v=o[1];if(!(m==""||g=="")){c=this.readPointProperties(t,v);v=o[1]}if(g!=""){r=l.create("intersection",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),u],{name:g,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]});if(m!=""){e=l.create("otherintersection",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),r],{name:m,size:c[0][1],fillColor:c[0][0],strokeColor:c[2],labelColor:c[3]})}}else{r=l.create("intersection",[JXG.getReference(l,p[0]),JXG.getReference(l,p[1]),s],{name:m,size:o[0][1],fillColor:o[0][0],strokeColor:o[2],labelColor:o[3]})}}else{if(t[v].search(/setOriginX\(([0-9.]*)\)/)!=-1){x=RegExp.$1}else{if(t[v].search(/setOriginY\(([0-9.]*)\)/)!=-1){w=RegExp.$1}else{if(t[v].search(/setScale\(([0-9.]*)\)/)!=-1){y=1*RegExp.$1/25}}}}}}}}}}}}}}}}}}}}}}}}l.zoomX*=y/2.4;l.zoomY*=y/2.4;x=l.origin.scrCoords[1]*l.options.zoom.factorX;w=l.origin.scrCoords[2]*l.options.zoom.factorY;l.origin=new JXG.Coords(JXG.COORDS_BY_SCREEN,[x-150,w+50],l);l.applyZoom();return l};this.calculateColor=function(a){a=parseInt(a);switch(a){case 0:return"white";case 1:return"black";case 2:return"red";case 3:return"blue";case 4:return"green";case 5:return"yellow";case 6:return"#ffafaf";case 7:return"cyan";case 8:return"#ffc800";case 9:return"#199e4e";case 10:return"#b75500";case 11:return"#7700b7";case 12:return"#ff7f00";case 13:return"#03a7bc";case 14:return"#c10000";case 15:return"#808080";case 16:return"#ff4a4a";case 17:return"#faff9e";case 18:return"#b6ffaa";case 19:return"#82f2ff";case 20:return"#d4a3ff";case 21:return"#ffbd77"}};this.readPointProperties=function(b,e){var d,c,a;do{e=e+1}while(b[e].search(/setAppearance/)==-1);d=(b[e].match(/\([A-Za-z,0-9\.]*\)/))[0];d=d.slice(1,d.length-1).split(",");d[0]=this.calculateColor(d[0]);do{e=e+1}while(b[e].search(/pointborder/)==-1);if(b[e].search(/false/)!=-1){c="none";a=d[0]}else{c="black";a="black"}return[d,e,c,a]};this.readCircleProperties=function(a,d){var c,e,b;do{d=d+1}while(a[d].search(/setAppearance/)==-1);c=(a[d].match(/\([A-Za-z,0-9\.]*\)/))[0];c=c.slice(1,c.length-1).split(",");c[0]=this.calculateColor(c[0]);do{d=d+1}while(a[d].search(/colorfill/)==-1);e=a[d].match(/"[0-9]*"/)[0];e=e.slice(1,e.length-1);e=this.calculateColor(e);do{d=d+1}while(a[d].search(/visibilityfill|fillalpha/)==-1);b=a[d].match(/"[0-9\.]*"/)[0];b=b.slice(1,b.length-1);if(a[d].match(/visibilityfill/)){b=1*b/10}else{b=1*b}return[c,e,b,d]};this.readLineProperties=function(a,c){var b,d;do{c=c+1}while(a[c].search(/setAppearance/)==-1);b=(a[c].match(/\([A-Za-z,0-9\.]*\)/))[0];b=b.slice(1,b.length-1).split(",");b[0]=this.calculateColor(b[0]);do{c=c+1}while(a[c].search(/linedashing/)==-1);if(a[c].search(/false/)!=-1){d=0}else{d=3}return[b,d,c]};this.prepareString=function(c){var b,d=[],a;if(c.indexOf("<")!=0){a=c.length;for(b=0;b<a;b++){d[b]=JXG.Util.asciiCharCodeAt(c,b)}c=(new JXG.Util.Unzip(d)).unzip()[0][0]}return c};this.readCinderella=function(b,a){this.data=this.prepareString(b);a.suspendUpdate();this.parseData(a);a.unsuspendUpdate()}};