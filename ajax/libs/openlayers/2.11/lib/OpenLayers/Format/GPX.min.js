OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,initialize:function(e){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=[];if(this.extractTracks)for(var i=e.getElementsByTagName("trk"),n=0,r=i.length;r>n;n++){var o={};this.extractAttributes&&(o=this.parseAttributes(i[n]));for(var s=this.getElementsByTagNameNS(i[n],i[n].namespaceURI,"trkseg"),a=0,l=s.length;l>a;a++){var c=this.extractSegment(s[a],"trkpt");t.push(new OpenLayers.Feature.Vector(c,o))}}if(this.extractRoutes)for(var h=e.getElementsByTagName("rte"),u=0,d=h.length;d>u;u++){var o={};this.extractAttributes&&(o=this.parseAttributes(h[u]));var p=this.extractSegment(h[u],"rtept");t.push(new OpenLayers.Feature.Vector(p,o))}if(this.extractWaypoints)for(var f=e.getElementsByTagName("wpt"),m=0,r=f.length;r>m;m++){var o={};this.extractAttributes&&(o=this.parseAttributes(f[m]));var g=new OpenLayers.Geometry.Point(f[m].getAttribute("lon"),f[m].getAttribute("lat"));t.push(new OpenLayers.Feature.Vector(g,o))}if(this.internalProjection&&this.externalProjection)for(var v=0,y=t.length;y>v;v++)t[v].geometry.transform(this.externalProjection,this.internalProjection);return t},extractSegment:function(e,t){for(var i=this.getElementsByTagNameNS(e,e.namespaceURI,t),n=[],r=0,o=i.length;o>r;r++)n.push(new OpenLayers.Geometry.Point(i[r].getAttribute("lon"),i[r].getAttribute("lat")));return new OpenLayers.Geometry.LineString(n)},parseAttributes:function(e){for(var t,i,n={},r=e.firstChild;r;)1==r.nodeType&&(t=r.firstChild,(3==t.nodeType||4==t.nodeType)&&(i=r.prefix?r.nodeName.split(":")[1]:r.nodeName,"trkseg"!=i&&"rtept"!=i&&(n[i]=t.nodeValue))),r=r.nextSibling;return n},CLASS_NAME:"OpenLayers.Format.GPX"});