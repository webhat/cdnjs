OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement;if(i){var n=this["read_"+i.nodeName];t=n?n.call(this,i):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],i=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(i)for(var n=0,r=i.length;r>n;++n){var o=i[n],s=o.nodeName;o.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),a=this.getSiblingNodesByTagCriteria(o,this.featureIdentifier);if(a)for(var l=0;a.length>l;l++){var c=a[l],u=this.parseGeometry(c),h=this.parseAttributes(c),d=new OpenLayers.Feature.Vector(u.geometry,h,null);d.bounds=u.bounds,d.type=s,t.push(d)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],i=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,r=i.length;r>n;n++){var o,s=i[n],a=null,l={},c=s.attributes.length;if(c>0)for(o=0;c>o;o++){var u=s.attributes[o];l[u.nodeName]=u.nodeValue}else{var h=s.childNodes;for(o=0,c=h.length;c>o;++o){var d=h[o];3!=d.nodeType&&(l[d.getAttribute("name")]=d.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(a,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var i,n,r,o,s,a=[];if(e&&e.hasChildNodes()){i=e.childNodes,r=i.length;for(var l=0;r>l;l++){for(s=i[l];s&&1!=s.nodeType;)s=s.nextSibling,l++;n=s?s.nodeName:"",n.length>0&&n.indexOf(t)>-1?a.push(s):(o=this.getSiblingNodesByTagCriteria(s,t),o.length>0&&(0==a.length?a=o:a.push(o)))}}return a},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var i=e.childNodes,n=i.length,r=0;n>r;++r){var o=i[r];if(1==o.nodeType){var s=o.childNodes,a=o.prefix?o.nodeName.split(":")[1]:o.nodeName;if(0==s.length)t[a]=null;else if(1==s.length){var l=s[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[a]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,i=this.gmlFormat.parseFeature(e),n=null;return i&&(t=i.geometry&&i.geometry.clone(),n=i.bounds&&i.bounds.clone(),i.destroy()),{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});