OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(){var e=this.components&&this.components.length>2;return e&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),e},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,r=this.getSortedSegments();n="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var o,s,a,l,c,u,h,d;e:for(var p=0,f=r.length;f>p;++p){o=r[p],s=o.x1,a=o.x2,l=o.y1,c=o.y2;for(var m=0,g=n.length;g>m&&(u=n[m],!(u.x1>a));++m)if(!(s>u.x2||(h=u.y1,d=u.y2,Math.min(h,d)>Math.max(l,c)||Math.max(h,d)<Math.min(l,c)||!OpenLayers.Geometry.segmentsIntersect(o,u)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,n=this.components.length-1,r=Array(n),o=0;n>o;++o)t=this.components[o],i=this.components[o+1],r[o]=t.x<i.x?{x1:t.x,y1:t.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:t.x,y2:t.y};return r.sort(e)},splitWithSegment:function(e,t){for(var i,n,r,o,s,a=!(t&&t.edge===!1),l=t&&t.tolerance,c=[],u=this.getVertices(),h=[],d=[],p=!1,f={point:!0,tolerance:l},m=null,g=0,y=u.length-2;y>=g;++g)if(i=u[g],h.push(i.clone()),n=u[g+1],s={x1:i.x,y1:i.y,x2:n.x,y2:n.y},r=OpenLayers.Geometry.segmentsIntersect(e,s,f),r instanceof OpenLayers.Geometry.Point&&(o=r.x===e.x1&&r.y===e.y1||r.x===e.x2&&r.y===e.y2||r.equals(i)||r.equals(n)?!0:!1,o||a)){if(r.equals(d[d.length-1])||d.push(r.clone()),0===g&&r.equals(i))continue;if(r.equals(n))continue;p=!0,r.equals(i)||h.push(r),c.push(new OpenLayers.Geometry.LineString(h)),h=[r.clone()]}if(p&&(h.push(n.clone()),c.push(new OpenLayers.Geometry.LineString(h))),d.length>0){var v=e.x1<e.x2?1:-1,b=e.y1<e.y2?1:-1;m={lines:c,points:d.sort(function(e,t){return v*e.x-v*t.x||b*e.y-b*t.y})}}return m},split:function(e,t){var i,n,r,o,s=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,c,u,h,d,p,f=this.getVertices(),m=[];r=[];for(var g=0,y=f.length-2;y>=g;++g){l=f[g],c=f[g+1],u={x1:l.x,y1:l.y,x2:c.x,y2:c.y},o=o||[e],a&&m.push(l.clone());for(var v=0;o.length>v;++v)if(h=o[v].splitWithSegment(u,t),h&&(d=h.lines,d.length>0&&(d.unshift(v,1),Array.prototype.splice.apply(o,d),v+=d.length-2),a))for(var b=0,x=h.points.length;x>b;++b)p=h.points[b],p.equals(l)||(m.push(p),r.push(new OpenLayers.Geometry.LineString(m)),m=p.equals(c)?[]:[p.clone()])}a&&r.length>0&&m.length>0&&(m.push(c.clone()),r.push(new OpenLayers.Geometry.LineString(m)))}else s=e.splitWith(this,t);return o&&o.length>1?n=!0:o=[],r&&r.length>1?i=!0:r=[],(n||i)&&(s=a?[r,o]:o),s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1),r=n&&t&&t.details,o={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var a,l=this.getSortedSegments(),c=e.x,u=e.y,h=0,d=l.length;d>h;++h)if(a=l[h],i=OpenLayers.Geometry.distanceToSegment(e,a),s>i.distance){if(s=i.distance,o=i,0===s)break}else if(a.x2>c&&(u>a.y1&&a.y2>u||a.y1>u&&u>a.y2))break;o=r?{distance:o.distance,x0:o.x,y0:o.y,x1:c,y1:u}:o.distance}else if(e instanceof OpenLayers.Geometry.LineString){var p,f,m,g,y,v=this.getSortedSegments(),b=e.getSortedSegments(),x=b.length,C={point:!0};e:for(var h=0,d=v.length;d>h;++h){p=v[h],g=p.x1,y=p.y1;for(var _=0;x>_;++_){if(f=b[_],m=OpenLayers.Geometry.segmentsIntersect(p,f,C)){s=0,o={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:g,y:y},f),s>i.distance&&(s=i.distance,o={distance:s,x0:g,y0:y,x1:i.x,y1:i.y})}}if(r||(o=o.distance),0!==s&&p){i=e.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),t);var w=r?i.distance:i;s>w&&(o=r?{distance:s,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:w)}}else o=e.distanceTo(this,t),r&&(o={distance:o.distance,x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0});return o},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(3>t.length)return this;var i=function(e,t){return e-t},n=function(e,t,i,o){for(var s,l=0,c=0,u=t;i>u;u++)s=r(e[t],e[i],e[u]),s>l&&(l=s,c=u);l>o&&c!=t&&(a.push(c),n(e,t,c,o),n(e,c,i,o))},r=function(e,t,i){var n=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=2*(n/r);return o},o=0,s=t.length-1,a=[];for(a.push(o),a.push(s);t[o].equals(t[s]);)s--,a.push(s);n(t,o,s,e);var l=[];a.sort(i);for(var c=0;a.length>c;c++)l.push(t[a[c]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});