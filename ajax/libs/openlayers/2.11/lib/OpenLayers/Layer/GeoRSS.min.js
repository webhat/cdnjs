OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(e,t,i){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,i]),this.location=t,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(e){var t=e.responseXML;if(t&&t.documentElement||(t=OpenLayers.Format.XML.prototype.read(e.responseText)),this.useFeedTitle){var i=null;try{i=t.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(n){i=t.getElementsByTagName("title")[0].firstChild.nodeValue}i&&this.setName(i)}var r={};OpenLayers.Util.extend(r,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(r.externalProjection=this.projection,r.internalProjection=this.map.getProjectionObject());for(var o=new OpenLayers.Format.GeoRSS(r),s=o.read(t),a=0,l=s.length;l>a;a++){var c={},u=s[a];if(u.geometry){var h=u.attributes.title?u.attributes.title:"Untitled",d=u.attributes.description?u.attributes.description:"No description.",p=u.attributes.link?u.attributes.link:"",f=u.geometry.getBounds().getCenterLonLat();if(c.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),c.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),h||d){c.title=h,c.description=d;var m='<div class="olLayerGeoRSSClose">[x]</div>';m+='<div class="olLayerGeoRSSTitle">',p&&(m+='<a class="link" href="'+p+'" target="_blank">'),m+=h,p&&(m+="</a>"),m+="</div>",m+='<div style="" class="olLayerGeoRSSDescription">',m+=d,m+="</div>",c.popupContentHTML=m}var u=new OpenLayers.Feature(this,f,c);this.features.push(u);var g=u.createMarker();g.events.register("click",u,this.markerClick),this.addMarker(g)}}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,n=this.layer.map.popups.length;n>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);if(!t){var r=this.createPopup();OpenLayers.Event.observe(r.div,"click",OpenLayers.Function.bind(function(){for(var e=0,t=this.layer.map.popups.length;t>e;e++)this.layer.map.removePopup(this.layer.map.popups[e])},this)),this.layer.map.addPopup(r)}OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});