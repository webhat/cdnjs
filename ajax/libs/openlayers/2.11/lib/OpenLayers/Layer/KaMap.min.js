OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(e,t,i,n){var r=[];r.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),r=-Math.round(e.top/t);return this.getFullRequestString({t:r,l:n,s:i})},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,r=i*this.tileSize.h,o=e.left,s=Math.floor(o/n)-this.buffer,a=o/n-s,l=-a*this.tileSize.w,c=s*n,u=e.top,h=Math.ceil(u/r)+this.buffer,d=h-u/r,p=-(d+1)*this.tileSize.h,f=h*r;return{tilelon:n,tilelat:r,tileoffsetlon:c,tileoffsetlat:f,tileoffsetx:l,tileoffsety:p}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),i=t*this.tileSize.w,n=t*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),o=i*Math.floor(r.lon/i),s=n*Math.floor(r.lat/n);return new OpenLayers.Bounds(o,s,o+i,s+n)},CLASS_NAME:"OpenLayers.Layer.KaMap"});