OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var e=function(){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:e,scope:this}),this.loaded=!0}},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(e){var t=e.responseText,i={};OpenLayers.Util.extend(i,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(i.externalProjection=this.projection,i.internalProjection=this.map.getProjectionObject());for(var n=new OpenLayers.Format.Text(i),r=n.read(t),o=0,s=r.length;s>o;o++){var a,l,c,u={},h=r[o];a=new OpenLayers.LonLat(h.geometry.x,h.geometry.y),h.style.graphicWidth&&h.style.graphicHeight&&(l=new OpenLayers.Size(h.style.graphicWidth,h.style.graphicHeight)),void 0!==h.style.graphicXOffset&&void 0!==h.style.graphicYOffset&&(c=new OpenLayers.Pixel(h.style.graphicXOffset,h.style.graphicYOffset)),null!=h.style.externalGraphic?u.icon=new OpenLayers.Icon(h.style.externalGraphic,l,c):(u.icon=OpenLayers.Marker.defaultIcon(),null!=l&&u.icon.setSize(l)),null!=h.attributes.title&&null!=h.attributes.description&&(u.popupContentHTML="<h2>"+h.attributes.title+"</h2>"+"<p>"+h.attributes.description+"</p>"),u.overflow=h.attributes.overflow||"auto";var d=new OpenLayers.Feature(this,a,u);this.features.push(d);var p=d.createMarker();null!=h.attributes.title&&null!=h.attributes.description&&p.events.register("click",d,this.markerClick),this.addMarker(p)}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,n=this.layer.map.popups.length;n>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);t||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"});