"use strict";var THREE=THREE||{REVISION:"49"};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;t.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+n)},n);return e=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},THREE.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()},THREE.Clock.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime=this.elapsedTime+e}return e},THREE.Color=function(e){return void 0!==e&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var n,r,s;if(0===i)this.r=this.g=this.b=0;else switch(n=Math.floor(6*e),r=6*e-n,e=i*(1-t),s=i*(1-t*r),t=i*(1-t*(1-r)),n){case 1:this.r=s,this.g=i,this.b=e;break;case 2:this.r=e,this.g=i,this.b=t;break;case 3:this.r=e,this.g=s,this.b=i;break;case 4:this.r=t,this.g=e,this.b=i;break;case 5:this.r=i,this.g=e,this.b=s;break;case 6:case 0:this.r=i,this.g=t,this.b=e}return this},setHex:function(e){return e=Math.floor(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},lerpSelf:function(e,t){return this.r=this.r+(e.r-this.r)*t,this.g=this.g+(e.g-this.g)*t,this.b=this.b+(e.b-this.b)*t,this},getHex:function(){return Math.floor(255*this.r)<<16^Math.floor(255*this.g)<<8^Math.floor(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(){return 1e-4>this.lengthSq()},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this},addScalar:function(e){return this.x=this.x+e,this.y=this.y+e,this.z=this.z+e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x=this.x*e.x,this.y=this.y*e.y,this.z=this.z*e.z,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this},divideSelf:function(e){return this.x=this.x/e.x,this.y=this.y/e.y,this.z=this.z/e.z,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-i*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getRotationFromMatrix:function(e,t){var i=t?t.x:1,n=t?t.y:1,r=t?t.z:1,s=e.elements[0]/i,o=e.elements[4]/n,i=e.elements[1]/i,n=e.elements[5]/n,a=e.elements[9]/r,l=e.elements[10]/r;return this.y=Math.asin(e.elements[8]/r),r=Math.cos(this.y),Math.abs(r)>1e-5?(this.x=Math.atan2(-a/r,l/r),this.z=Math.atan2(-o/r,s/r)):(this.x=0,this.z=Math.atan2(i,n)),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t,this.y=i,this.z=e},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(){return 1e-4>this.lengthSq()},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this.w=this.w+e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this.w=this.w-e.w,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this.w=this.w/e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this.w=this.w+(e.w-this.w)*t,this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]},THREE.Frustum.prototype.setFromMatrix=function(e){var t,i=this.planes,n=e.elements,e=n[0];t=n[1];var r=n[2],s=n[3],o=n[4],a=n[5],l=n[6],h=n[7],c=n[8],u=n[9],d=n[10],p=n[11],f=n[12],m=n[13],g=n[14],n=n[15];for(i[0].set(s-e,h-o,p-c,n-f),i[1].set(s+e,h+o,p+c,n+f),i[2].set(s+t,h+a,p+u,n+m),i[3].set(s-t,h-a,p-u,n-m),i[4].set(s-r,h-l,p-d,n-g),i[5].set(s+r,h+l,p+d,n+g),e=0;6>e;e++)t=i[e],t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))},THREE.Frustum.prototype.contains=function(e){for(var t=this.planes,i=e.matrixWorld,n=i.elements,i=-e.geometry.boundingSphere.radius*i.getMaxScaleOnAxis(),r=0;6>r;r++)if(e=t[r].x*n[12]+t[r].y*n[13]+t[r].z*n[14]+t[r].w,i>=e)return!1;return!0},THREE.Frustum.__v1=new THREE.Vector3,THREE.Ray=function(e,t){function i(e,t,i){return E.sub(i,e),f=E.dot(t),m=O.add(e,_.copy(t).multiplyScalar(f)),g=i.distanceTo(m)}function n(e,t,i,n){return E.sub(n,t),O.sub(i,t),_.sub(e,t),y=E.dot(E),v=E.dot(O),b=E.dot(_),x=O.dot(O),L=O.dot(_),w=1/(y*x-v*v),C=(x*b-v*L)*w,S=(y*L-v*b)*w,C>=0&&S>=0&&1>C+S}this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3;var r=1e-4;this.setPrecision=function(e){r=e};var s=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3;this.intersectObject=function(e){var t,f=[];if(e instanceof THREE.Particle){var m=i(this.origin,this.direction,e.matrixWorld.getPosition());if(m>e.scale.x)return[];t={distance:m,point:e.position,face:null,object:e},f.push(t)}else if(e instanceof THREE.Mesh){var m=i(this.origin,this.direction,e.matrixWorld.getPosition()),g=THREE.Frustum.__v1.set(e.matrixWorld.getColumnX().length(),e.matrixWorld.getColumnY().length(),e.matrixWorld.getColumnZ().length());if(m>e.geometry.boundingSphere.radius*Math.max(g.x,Math.max(g.y,g.z)))return f;var y,v,b,x=e.geometry,L=x.vertices;for(e.matrixRotationWorld.extractRotation(e.matrixWorld),m=0,g=x.faces.length;g>m;m++)t=x.faces[m],h.copy(this.origin),c.copy(this.direction),b=e.matrixWorld,u=b.multiplyVector3(u.copy(t.centroid)).subSelf(h),d=e.matrixRotationWorld.multiplyVector3(d.copy(t.normal)),y=c.dot(d),r>Math.abs(y)||(v=d.dot(u)/y,0>v||!e.doubleSided&&!(e.flipSided?y>0:0>y)||(p.add(h,c.multiplyScalar(v)),t instanceof THREE.Face3?(s=b.multiplyVector3(s.copy(L[t.a])),o=b.multiplyVector3(o.copy(L[t.b])),a=b.multiplyVector3(a.copy(L[t.c])),n(p,s,o,a)&&(t={distance:h.distanceTo(p),point:p.clone(),face:t,object:e},f.push(t))):t instanceof THREE.Face4&&(s=b.multiplyVector3(s.copy(L[t.a])),o=b.multiplyVector3(o.copy(L[t.b])),a=b.multiplyVector3(a.copy(L[t.c])),l=b.multiplyVector3(l.copy(L[t.d])),(n(p,s,o,l)||n(p,o,a,l))&&(t={distance:h.distanceTo(p),point:p.clone(),face:t,object:e},f.push(t)))))}return f},this.intersectObjects=function(e){for(var t=[],i=0,n=e.length;n>i;i++)Array.prototype.push.apply(t,this.intersectObject(e[i]));return t.sort(function(e,t){return e.distance-t.distance}),t};var f,m,g,y,v,b,x,L,w,C,S,E=new THREE.Vector3,O=new THREE.Vector3,_=new THREE.Vector3},THREE.Rectangle=function(){function e(){s=n-t,o=r-i}var t,i,n,r,s,o,a=!0;this.getX=function(){return t},this.getY=function(){return i},this.getWidth=function(){return s},this.getHeight=function(){return o},this.getLeft=function(){return t},this.getTop=function(){return i},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(s,o,l,h){a=!1,t=s,i=o,n=l,r=h,e()},this.addPoint=function(s,o){a?(a=!1,t=s,i=o,n=s,r=o):(t=s>t?t:s,i=o>i?i:o,n=n>s?n:s,r=r>o?r:o),e()},this.add3Points=function(s,o,l,h,c,u){a?(a=!1,t=l>s?c>s?s:c:c>l?l:c,i=h>o?u>o?o:u:u>h?h:u,n=s>l?s>c?s:c:l>c?l:c,r=o>h?o>u?o:u:h>u?h:u):(t=l>s?c>s?t>s?s:t:t>c?c:t:c>l?t>l?l:t:t>c?c:t,i=h>o?u>o?i>o?o:i:i>u?u:i:u>h?i>h?h:i:i>u?u:i,n=s>l?s>c?s>n?s:n:c>n?c:n:l>c?l>n?l:n:c>n?c:n,r=o>h?o>u?o>r?o:r:u>r?u:r:h>u?h>r?h:r:u>r?u:r),e()},this.addRectangle=function(s){a?(a=!1,t=s.getLeft(),i=s.getTop(),n=s.getRight(),r=s.getBottom()):(t=s.getLeft()>t?t:s.getLeft(),i=s.getTop()>i?i:s.getTop(),n=n>s.getRight()?n:s.getRight(),r=r>s.getBottom()?r:s.getBottom()),e()},this.inflate=function(s){t-=s,i-=s,n+=s,r+=s,e()},this.minSelf=function(s){t=t>s.getLeft()?t:s.getLeft(),i=i>s.getTop()?i:s.getTop(),n=s.getRight()>n?n:s.getRight(),r=s.getBottom()>r?r:s.getBottom(),e()},this.intersects=function(e){return e.getLeft()>n||t>e.getRight()||e.getTop()>r||i>e.getBottom()?!1:!0},this.empty=function(){a=!0,r=n=i=t=0,e()},this.isEmpty=function(){return a}},THREE.Math={clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0}},THREE.Matrix3=function(){this.elements=new Float32Array(9)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],i=-t[10]*t[1]+t[2]*t[9],n=t[6]*t[1]-t[2]*t[5],r=-t[10]*t[4]+t[6]*t[8],s=t[10]*t[0]-t[2]*t[8],o=-t[6]*t[0]+t[2]*t[4],a=t[9]*t[4]-t[5]*t[8],l=-t[9]*t[0]+t[1]*t[8],h=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*r+t[2]*a;0===t&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,c=this.elements;return c[0]=t*e,c[1]=t*i,c[2]=t*n,c[3]=t*r,c[4]=t*s,c[5]=t*o,c[6]=t*a,c[7]=t*l,c[8]=t*h,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,i,n,r,s,o,a,l,h,c,u,d,p,f,m){this.elements=new Float32Array(16),this.set(void 0!==e?e:1,t||0,i||0,n||0,r||0,void 0!==s?s:1,o||0,a||0,l||0,h||0,void 0!==c?c:1,u||0,d||0,p||0,f||0,void 0!==m?m:1)},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,n,r,s,o,a,l,h,c,u,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},lookAt:function(e,t,i){var n=this.elements,r=THREE.Matrix4.__v1,s=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(e,t).normalize(),0===o.length()&&(o.z=1),r.cross(i,o).normalize(),0===r.length()&&(o.x=o.x+1e-4,r.cross(i,o).normalize()),s.cross(o,r),n[0]=r.x,n[4]=s.x,n[8]=o.x,n[1]=r.y,n[5]=s.y,n[9]=o.y,n[2]=r.z,n[6]=s.z,n[10]=o.z,this},multiply:function(e,t){var i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],y=i[3],v=i[7],b=i[11],i=i[15],x=n[0],L=n[4],w=n[8],C=n[12],S=n[1],E=n[5],O=n[9],_=n[13],T=n[2],k=n[6],P=n[10],A=n[14],M=n[3],N=n[7],R=n[11],n=n[15];return r[0]=s*x+o*S+a*T+l*M,r[4]=s*L+o*E+a*k+l*N,r[8]=s*w+o*O+a*P+l*R,r[12]=s*C+o*_+a*A+l*n,r[1]=h*x+c*S+u*T+d*M,r[5]=h*L+c*E+u*k+d*N,r[9]=h*w+c*O+u*P+d*R,r[13]=h*C+c*_+u*A+d*n,r[2]=p*x+f*S+m*T+g*M,r[6]=p*L+f*E+m*k+g*N,r[10]=p*w+f*O+m*P+g*R,r[14]=p*C+f*_+m*A+g*n,r[3]=y*x+v*S+b*T+i*M,r[7]=y*L+v*E+b*k+i*N,r[11]=y*w+v*O+b*P+i*R,r[15]=y*C+v*_+b*A+i*n,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiply(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]=t[0]*e,t[4]=t[4]*e,t[8]=t[8]*e,t[12]=t[12]*e,t[1]=t[1]*e,t[5]=t[5]*e,t[9]=t[9]*e,t[13]=t[13]*e,t[2]=t[2]*e,t[6]=t[6]*e,t[10]=t[10]*e,t[14]=t[14]*e,t[3]=t[3]*e,t[7]=t[7]*e,t[11]=t[11]*e,t[15]=t[15]*e,this},multiplyVector3:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,s=1/(t[3]*i+t[7]*n+t[11]*r+t[15]);return e.x=(t[0]*i+t[4]*n+t[8]*r+t[12])*s,e.y=(t[1]*i+t[5]*n+t[9]*r+t[13])*s,e.z=(t[2]*i+t[6]*n+t[10]*r+t[14])*s,e},multiplyVector4:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,s=e.w;return e.x=t[0]*i+t[4]*n+t[8]*r+t[12]*s,e.y=t[1]*i+t[5]*n+t[9]*r+t[13]*s,e.z=t[2]*i+t[6]*n+t[10]*r+t[14]*s,e.w=t[3]*i+t[7]*n+t[11]*r+t[15]*s,e},rotateAxis:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return e.x=i*t[0]+n*t[4]+r*t[8],e.y=i*t[1]+n*t[5]+r*t[9],e.z=i*t[2]+n*t[6]+r*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new THREE.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14],p=e[3],f=e[7],m=e[11],e=e[15];return r*a*c*p-n*l*c*p-r*o*u*p+i*l*u*p+n*o*d*p-i*a*d*p-r*a*h*f+n*l*h*f+r*s*u*f-t*l*u*f-n*s*d*f+t*a*d*f+r*o*h*m-i*l*h*m-r*s*c*m+t*l*c*m+i*s*d*m-t*o*d*m-n*o*h*e+i*a*h*e+n*s*c*e-t*a*c*e-i*s*u*e+t*o*u*e},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,i=e.elements,n=i[0],r=i[4],s=i[8],o=i[12],a=i[1],l=i[5],h=i[9],c=i[13],u=i[2],d=i[6],p=i[10],f=i[14],m=i[3],g=i[7],y=i[11],i=i[15];return t[0]=h*f*g-c*p*g+c*d*y-l*f*y-h*d*i+l*p*i,t[4]=o*p*g-s*f*g-o*d*y+r*f*y+s*d*i-r*p*i,t[8]=s*c*g-o*h*g+o*l*y-r*c*y-s*l*i+r*h*i,t[12]=o*h*d-s*c*d-o*l*p+r*c*p+s*l*f-r*h*f,t[1]=c*p*m-h*f*m-c*u*y+a*f*y+h*u*i-a*p*i,t[5]=s*f*m-o*p*m+o*u*y-n*f*y-s*u*i+n*p*i,t[9]=o*h*m-s*c*m-o*a*y+n*c*y+s*a*i-n*h*i,t[13]=s*c*u-o*h*u+o*a*p-n*c*p-s*a*f+n*h*f,t[2]=l*f*m-c*d*m+c*u*g-a*f*g-l*u*i+a*d*i,t[6]=o*d*m-r*f*m-o*u*g+n*f*g+r*u*i-n*d*i,t[10]=r*c*m-o*l*m+o*a*g-n*c*g-r*a*i+n*l*i,t[14]=o*l*u-r*c*u-o*a*d+n*c*d+r*a*f-n*l*f,t[3]=h*d*m-l*p*m-h*u*g+a*p*g+l*u*y-a*d*y,t[7]=r*p*m-s*d*m+s*u*g-n*p*g-r*u*y+n*d*y,t[11]=s*l*m-r*h*m-s*a*g+n*h*g+r*a*y-n*l*y,t[15]=r*h*u-s*l*u+s*a*d-n*h*d-r*a*p+n*l*p,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var i=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),n=Math.sin(n),a=Math.cos(r),r=Math.sin(r),l=Math.cos(s),s=Math.sin(s);switch(t){case"YXZ":var h=a*l,c=a*s,u=r*l,d=r*s;i[0]=h+d*n,i[4]=u*n-c,i[8]=o*r,i[1]=o*s,i[5]=o*l,i[9]=-n,i[2]=c*n-u,i[6]=d+h*n,i[10]=o*a;break;case"ZXY":h=a*l,c=a*s,u=r*l,d=r*s,i[0]=h-d*n,i[4]=-o*s,i[8]=u+c*n,i[1]=c+u*n,i[5]=o*l,i[9]=d-h*n,i[2]=-o*r,i[6]=n,i[10]=o*a;break;case"ZYX":h=o*l,c=o*s,u=n*l,d=n*s,i[0]=a*l,i[4]=u*r-c,i[8]=h*r+d,i[1]=a*s,i[5]=d*r+h,i[9]=c*r-u,i[2]=-r,i[6]=n*a,i[10]=o*a;break;case"YZX":h=o*a,c=o*r,u=n*a,d=n*r,i[0]=a*l,i[4]=d-h*s,i[8]=u*s+c,i[1]=s,i[5]=o*l,i[9]=-n*l,i[2]=-r*l,i[6]=c*s+u,i[10]=h-d*s;break;case"XZY":h=o*a,c=o*r,u=n*a,d=n*r,i[0]=a*l,i[4]=-s,i[8]=r*l,i[1]=h*s+d,i[5]=o*l,i[9]=c*s-u,i[2]=u*s-c,i[6]=n*l,i[10]=d*s+h;break;default:h=o*l,c=o*s,u=n*l,d=n*s,i[0]=a*l,i[4]=-a*s,i[8]=r,i[1]=c+u*r,i[5]=h-d*r,i[9]=-n*a,i[2]=d-h*r,i[6]=u+c*r,i[10]=o*a}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,s=e.w,o=i+i,a=n+n,l=r+r,e=i*o,h=i*a,i=i*l,c=n*a,n=n*l,r=r*l,o=s*o,a=s*a,s=s*l;return t[0]=1-(c+r),t[4]=h-s,t[8]=i+a,t[1]=h+s,t[5]=1-(e+r),t[9]=n-o,t[2]=i-a,t[6]=n+o,t[10]=1-(e+c),this},compose:function(e,t,i){var n=this.elements,r=THREE.Matrix4.__m1,s=THREE.Matrix4.__m2;return r.identity(),r.setRotationFromQuaternion(t),s.makeScale(i.x,i.y,i.z),this.multiply(r,s),n[12]=e.x,n[13]=e.y,n[14]=e.z,this},decompose:function(e,t,i){var n=this.elements,r=THREE.Matrix4.__v1,s=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return r.set(n[0],n[1],n[2]),s.set(n[4],n[5],n[6]),o.set(n[8],n[9],n[10]),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,i=i instanceof THREE.Vector3?i:new THREE.Vector3,i.x=r.length(),i.y=s.length(),i.z=o.length(),e.x=n[12],e.y=n[13],e.z=n[14],n=THREE.Matrix4.__m1,n.copy(this),n.elements[0]=n.elements[0]/i.x,n.elements[1]=n.elements[1]/i.x,n.elements[2]=n.elements[2]/i.x,n.elements[4]=n.elements[4]/i.y,n.elements[5]=n.elements[5]/i.y,n.elements[6]=n.elements[6]/i.y,n.elements[8]=n.elements[8]/i.z,n.elements[9]=n.elements[9]/i.z,n.elements[10]=n.elements[10]/i.z,t.setFromRotationMatrix(n),[e,t,i]},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(e){var t=this.elements,e=e.elements,i=THREE.Matrix4.__v1,n=1/i.set(e[0],e[1],e[2]).length(),r=1/i.set(e[4],e[5],e[6]).length(),i=1/i.set(e[8],e[9],e[10]).length();return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,this},translate:function(e){var t=this.elements,i=e.x,n=e.y,e=e.z;return t[12]=t[0]*i+t[4]*n+t[8]*e+t[12],t[13]=t[1]*i+t[5]*n+t[9]*e+t[13],t[14]=t[2]*i+t[6]*n+t[10]*e+t[14],t[15]=t[3]*i+t[7]*n+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,i=t[4],n=t[5],r=t[6],s=t[7],o=t[8],a=t[9],l=t[10],h=t[11],c=Math.cos(e),e=Math.sin(e);return t[4]=c*i+e*o,t[5]=c*n+e*a,t[6]=c*r+e*l,t[7]=c*s+e*h,t[8]=c*o-e*i,t[9]=c*a-e*n,t[10]=c*l-e*r,t[11]=c*h-e*s,this},rotateY:function(e){var t=this.elements,i=t[0],n=t[1],r=t[2],s=t[3],o=t[8],a=t[9],l=t[10],h=t[11],c=Math.cos(e),e=Math.sin(e);return t[0]=c*i-e*o,t[1]=c*n-e*a,t[2]=c*r-e*l,t[3]=c*s-e*h,t[8]=c*o+e*i,t[9]=c*a+e*n,t[10]=c*l+e*r,t[11]=c*h+e*s,this},rotateZ:function(e){var t=this.elements,i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=Math.cos(e),e=Math.sin(e);return t[0]=c*i+e*o,t[1]=c*n+e*a,t[2]=c*r+e*l,t[3]=c*s+e*h,t[4]=c*o-e*i,t[5]=c*a-e*n,t[6]=c*l-e*r,t[7]=c*h-e*s,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var n=e.x,r=e.y,s=e.z,o=Math.sqrt(n*n+r*r+s*s),n=n/o,r=r/o,s=s/o,o=n*n,a=r*r,l=s*s,h=Math.cos(t),c=Math.sin(t),u=1-h,d=n*r*u,p=n*s*u,u=r*s*u,n=n*c,f=r*c,c=s*c,s=o+(1-o)*h,o=d+c,r=p-f,d=d-c,a=a+(1-a)*h,c=u+n,p=p+f,u=u-n,l=l+(1-l)*h,h=i[0],n=i[1],f=i[2],m=i[3],g=i[4],y=i[5],v=i[6],b=i[7],x=i[8],L=i[9],w=i[10],C=i[11];return i[0]=s*h+o*g+r*x,i[1]=s*n+o*y+r*L,i[2]=s*f+o*v+r*w,i[3]=s*m+o*b+r*C,i[4]=d*h+a*g+c*x,i[5]=d*n+a*y+c*L,i[6]=d*f+a*v+c*w,i[7]=d*m+a*b+c*C,i[8]=p*h+u*g+l*x,i[9]=p*n+u*y+l*L,i[10]=p*f+u*v+l*w,i[11]=p*m+u*b+l*C,this},scale:function(e){var t=this.elements,i=e.x,n=e.y,e=e.z;return t[0]=t[0]*i,t[4]=t[4]*n,t[8]=t[8]*e,t[1]=t[1]*i,t[5]=t[5]*n,t[9]=t[9]*e,t[2]=t[2]*i,t[6]=t[6]*n,t[10]=t[10]*e,t[3]=t[3]*i,t[7]=t[7]*n,t[11]=t[11]*e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,h=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,h*o+i,h*a-n*s,0,l*a-n*o,h*a+n*s,r*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,n,r,s){var o=this.elements;return o[0]=2*r/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*r/(n-i),o[9]=(n+i)/(n-i),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+r)/(s-r),o[14]=-2*s*r/(s-r),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,i,n){var e=i*Math.tan(e*Math.PI/360),r=-e;return this.makeFrustum(r*t,e*t,r,e,i,n)},makeOrthographic:function(e,t,i,n,r,s){var o=this.elements,a=t-e,l=i-n,h=s-r;return o[0]=2/a,o[4]=0,o[8]=0,o[12]=-((t+e)/a),o[1]=0,o[5]=2/l,o[9]=0,o[13]=-((i+n)/l),o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-((s+r)/h),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.id=THREE.Object3DCount++,this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix),this.rotation.getRotationFromMatrix(this.matrix,this.scale),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){for(e.parent=void 0,this.children.splice(t,1),t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__removeObject(e)}},getChildByName:function(e,t){var i,n,r;for(i=0,n=this.children.length;n>i;i++){if(r=this.children[i],r.name===e)return r;if(t&&(r=r.getChildByName(e,t),void 0!==r))return r}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)}},THREE.Object3DCount=0,THREE.Projector=function(){function e(){var e=m[s]=m[s]||new THREE.RenderableObject;return s++,e}function t(){var e=g[a]=g[a]||new THREE.RenderableVertex;return a++,e}function i(e,t){return t.z-e.z}function n(e,t){var i=0,n=1,r=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,a=-t.z+t.w;return r>=0&&s>=0&&o>=0&&a>=0?!0:0>r&&0>s||0>o&&0>a?!1:(0>r?i=Math.max(i,r/(r-s)):0>s&&(n=Math.min(n,r/(r-s))),0>o?i=Math.max(i,o/(o-a)):0>a&&(n=Math.min(n,o/(o-a))),i>n?!1:(e.lerpSelf(t,i),t.lerpSelf(e,1-n),!0))}var r,s,o,a,l,h,c,u,d,p,f,m=[],g=[],y=[],v=[],b=[],x=[],L={objects:[],sprites:[],lights:[],elements:[]},w=new THREE.Vector3,C=new THREE.Vector4,S=new THREE.Matrix4,E=new THREE.Matrix4,O=new THREE.Frustum,_=new THREE.Vector4,T=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),S.multiply(t.projectionMatrix,t.matrixWorldInverse),S.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),S.multiply(t.matrixWorld,t.projectionMatrixInverse),S.multiplyVector3(e),e},this.pickingRay=function(e,t){var i;return e.z=-1,i=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(i,t),i.subSelf(e).normalize(),new THREE.Ray(e,i)},this.projectGraph=function(t,n){s=0,L.objects.length=0,L.sprites.length=0,L.lights.length=0;var o=function(t){if(t.visible!==!1){(t instanceof THREE.Mesh||t instanceof THREE.Line)&&(t.frustumCulled===!1||O.contains(t))?(w.copy(t.matrixWorld.getPosition()),S.multiplyVector3(w),r=e(),r.object=t,r.z=w.z,L.objects.push(r)):t instanceof THREE.Sprite||t instanceof THREE.Particle?(w.copy(t.matrixWorld.getPosition()),S.multiplyVector3(w),r=e(),r.object=t,r.z=w.z,L.sprites.push(r)):t instanceof THREE.Light&&L.lights.push(t);for(var i=0,n=t.children.length;n>i;i++)o(t.children[i])}};return o(t),n&&L.objects.sort(i),L},this.projectScene=function(e,r,s){var m,w,k,P,A,M,N,R,D,I,F,B,G,j,z,X=r.near,U=r.far,H=!1;for(f=d=c=h=0,L.elements.length=0,void 0===r.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(r)),e.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),S.multiply(r.projectionMatrix,r.matrixWorldInverse),O.setFromMatrix(S),L=this.projectGraph(e,!1),e=0,m=L.objects.length;m>e;e++)if(D=L.objects[e].object,I=D.matrixWorld,a=0,D instanceof THREE.Mesh){for(F=D.geometry,B=D.geometry.materials,P=F.vertices,G=F.faces,j=F.faceVertexUvs,F=D.matrixRotationWorld.extractRotation(I),w=0,k=P.length;k>w;w++)o=t(),o.positionWorld.copy(P[w]),I.multiplyVector3(o.positionWorld),o.positionScreen.copy(o.positionWorld),S.multiplyVector4(o.positionScreen),o.positionScreen.x=o.positionScreen.x/o.positionScreen.w,o.positionScreen.y=o.positionScreen.y/o.positionScreen.w,o.visible=o.positionScreen.z>X&&U>o.positionScreen.z;
for(P=0,w=G.length;w>P;P++){if(k=G[P],k instanceof THREE.Face3){if(A=g[k.a],M=g[k.b],N=g[k.c],!(A.visible&&M.visible&&N.visible))continue;if(H=0>(N.positionScreen.x-A.positionScreen.x)*(M.positionScreen.y-A.positionScreen.y)-(N.positionScreen.y-A.positionScreen.y)*(M.positionScreen.x-A.positionScreen.x),!D.doubleSided&&H==D.flipSided)continue;R=y[h]=y[h]||new THREE.RenderableFace3,h++,l=R,l.v1.copy(A),l.v2.copy(M),l.v3.copy(N)}else if(k instanceof THREE.Face4){if(A=g[k.a],M=g[k.b],N=g[k.c],R=g[k.d],!(A.visible&&M.visible&&N.visible&&R.visible))continue;if(H=0>(R.positionScreen.x-A.positionScreen.x)*(M.positionScreen.y-A.positionScreen.y)-(R.positionScreen.y-A.positionScreen.y)*(M.positionScreen.x-A.positionScreen.x)||0>(M.positionScreen.x-N.positionScreen.x)*(R.positionScreen.y-N.positionScreen.y)-(M.positionScreen.y-N.positionScreen.y)*(R.positionScreen.x-N.positionScreen.x),!D.doubleSided&&H==D.flipSided)continue;z=v[c]=v[c]||new THREE.RenderableFace4,c++,l=z,l.v1.copy(A),l.v2.copy(M),l.v3.copy(N),l.v4.copy(R)}for(l.normalWorld.copy(k.normal),!H&&(D.flipSided||D.doubleSided)&&l.normalWorld.negate(),F.multiplyVector3(l.normalWorld),l.centroidWorld.copy(k.centroid),I.multiplyVector3(l.centroidWorld),l.centroidScreen.copy(l.centroidWorld),S.multiplyVector3(l.centroidScreen),N=k.vertexNormals,A=0,M=N.length;M>A;A++)R=l.vertexNormalsWorld[A],R.copy(N[A]),!H&&(D.flipSided||D.doubleSided)&&R.negate(),F.multiplyVector3(R);for(A=0,M=j.length;M>A;A++)if(z=j[A][P])for(N=0,R=z.length;R>N;N++)l.uvs[A][N]=z[N];l.material=D.material,l.faceMaterial=null!==k.materialIndex?B[k.materialIndex]:null,l.z=l.centroidScreen.z,L.elements.push(l)}}else if(D instanceof THREE.Line)for(E.multiply(S,I),P=D.geometry.vertices,A=t(),A.positionScreen.copy(P[0]),E.multiplyVector4(A.positionScreen),I=D.type===THREE.LinePieces?2:1,w=1,k=P.length;k>w;w++)A=t(),A.positionScreen.copy(P[w]),E.multiplyVector4(A.positionScreen),(w+1)%I>0||(M=g[a-2],_.copy(A.positionScreen),T.copy(M.positionScreen),n(_,T)&&(_.multiplyScalar(1/_.w),T.multiplyScalar(1/T.w),B=b[d]=b[d]||new THREE.RenderableLine,d++,u=B,u.v1.positionScreen.copy(_),u.v2.positionScreen.copy(T),u.z=Math.max(_.z,T.z),u.material=D.material,L.elements.push(u)));for(e=0,m=L.sprites.length;m>e;e++)D=L.sprites[e].object,I=D.matrixWorld,D instanceof THREE.Particle&&(C.set(I.elements[12],I.elements[13],I.elements[14],1),S.multiplyVector4(C),C.z=C.z/C.w,C.z>0&&1>C.z&&(X=x[f]=x[f]||new THREE.RenderableParticle,f++,p=X,p.x=C.x/C.w,p.y=C.y/C.w,p.z=C.z,p.rotation=D.rotation.z,p.scale.x=D.scale.x*Math.abs(p.x-(C.x+r.projectionMatrix.elements[0])/(C.w+r.projectionMatrix.elements[12])),p.scale.y=D.scale.y*Math.abs(p.y-(C.y+r.projectionMatrix.elements[5])/(C.w+r.projectionMatrix.elements[13])),p.material=D.material,L.elements.push(p)));return s&&L.elements.sort(i),L}},THREE.Quaternion=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=Math.PI/360,i=e.x*t,n=e.y*t,r=e.z*t,e=Math.cos(n),n=Math.sin(n),t=Math.cos(-r),r=Math.sin(-r),s=Math.cos(i),i=Math.sin(i),o=e*t,a=n*r;return this.w=o*s-a*i,this.x=o*i+a*s,this.y=n*t*s+e*r*i,this.z=e*r*s-n*t*i,this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,t+e.elements[0]+e.elements[5]+e.elements[10]))/2,this.x=Math.sqrt(Math.max(0,t+e.elements[0]-e.elements[5]-e.elements[10]))/2,this.y=Math.sqrt(Math.max(0,t-e.elements[0]+e.elements[5]-e.elements[10]))/2,this.z=Math.sqrt(Math.max(0,t-e.elements[0]-e.elements[5]+e.elements[10]))/2,this.x=0>e.elements[6]-e.elements[9]?-Math.abs(this.x):Math.abs(this.x),this.y=0>e.elements[8]-e.elements[2]?-Math.abs(this.y):Math.abs(this.y),this.z=0>e.elements[1]-e.elements[4]?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x=-1*this.x,this.y=-1*this.y,this.z=-1*this.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplySelf:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,s=e.x,o=e.y,a=e.z,e=e.w;return this.x=t*e+r*s+i*a-n*o,this.y=i*e+r*o+n*s-t*a,this.z=n*e+r*a+t*o-i*s,this.w=r*e-t*s-i*o-n*a,this},multiplyVector3:function(e,t){t||(t=e);var i=e.x,n=e.y,r=e.z,s=this.x,o=this.y,a=this.z,l=this.w,h=l*i+o*r-a*n,c=l*n+a*i-s*r,u=l*r+s*n-o*i,i=-s*i-o*n-a*r;return t.x=h*l+i*-s+c*-a-u*-o,t.y=c*l+i*-o+u*-s-h*-a,t.z=u*l+i*-a+h*-o-c*-s,t},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}},THREE.Quaternion.slerp=function(e,t,i,n){var r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(0>r?(i.w=-t.w,i.x=-t.x,i.y=-t.y,i.z=-t.z,r=-r):i.copy(t),Math.abs(r)>=1)return i.w=e.w,i.x=e.x,i.y=e.y,i.z=e.z,i;var s=Math.acos(r),r=Math.sqrt(1-r*r);return.001>Math.abs(r)?(i.w=.5*(e.w+t.w),i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i):(t=Math.sin((1-n)*s)/r,n=Math.sin(n*s)/r,i.w=e.w*t+i.w*n,i.x=e.x*t+i.x*n,i.y=e.y*t+i.y*n,i.z=e.z*t+i.z*n,i)},THREE.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")},THREE.Face3=function(e,t,i,n,r,s){this.a=e,this.b=t,this.c=i,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,i,n,r,s,o){this.a=e,this.b=t,this.c=i,this.d=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=s instanceof THREE.Color?s:new THREE.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},lerpSelf:function(e,t){return this.u=this.u+(e.u-this.u)*t,this.v=this.v+(e.v-this.v)*t,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e);for(var i=0,n=this.vertices.length;n>i;i++)e.multiplyVector3(this.vertices[i]);for(i=0,n=this.faces.length;n>i;i++){var r=this.faces[i];t.multiplyVector3(r.normal);for(var s=0,o=r.vertexNormals.length;o>s;s++)t.multiplyVector3(r.vertexNormals[s]);e.multiplyVector3(r.centroid)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i.centroid.set(0,0,0),i instanceof THREE.Face3?(i.centroid.addSelf(this.vertices[i.a]),i.centroid.addSelf(this.vertices[i.b]),i.centroid.addSelf(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof THREE.Face4&&(i.centroid.addSelf(this.vertices[i.a]),i.centroid.addSelf(this.vertices[i.b]),i.centroid.addSelf(this.vertices[i.c]),i.centroid.addSelf(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,i,n,r,s,o=new THREE.Vector3,a=new THREE.Vector3;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],n=this.vertices[i.a],r=this.vertices[i.b],s=this.vertices[i.c],o.sub(s,r),a.sub(n,r),o.crossSelf(a),o.isZero()||o.normalize(),i.normal.copy(o)},computeVertexNormals:function(){var e,t,i,n;if(void 0===this.__tmpVertices){for(n=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;t>e;e++)n[e]=new THREE.Vector3;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i instanceof THREE.Face3?i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:i instanceof THREE.Face4&&(i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(n=this.__tmpVertices,e=0,t=this.vertices.length;t>e;e++)n[e].set(0,0,0);for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i instanceof THREE.Face3?(n[i.a].addSelf(i.normal),n[i.b].addSelf(i.normal),n[i.c].addSelf(i.normal)):i instanceof THREE.Face4&&(n[i.a].addSelf(i.normal),n[i.b].addSelf(i.normal),n[i.c].addSelf(i.normal),n[i.d].addSelf(i.normal));for(e=0,t=this.vertices.length;t>e;e++)n[e].normalize();for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i instanceof THREE.Face3?(i.vertexNormals[0].copy(n[i.a]),i.vertexNormals[1].copy(n[i.b]),i.vertexNormals[2].copy(n[i.c])):i instanceof THREE.Face4&&(i.vertexNormals[0].copy(n[i.a]),i.vertexNormals[1].copy(n[i.b]),i.vertexNormals[2].copy(n[i.c]),i.vertexNormals[3].copy(n[i.d]))},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;n>i;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;t>e;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var s=new THREE.Geometry;for(s.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o,a,l=this.morphNormals[e].faceNormals,h=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],o=new THREE.Vector3,a=r instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},l.push(o),h.push(a)}for(l=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),i=0,n=this.faces.length;n>i;i++)r=this.faces[i],o=l.faceNormals[i],a=l.vertexNormals[i],o.copy(r.normal),r instanceof THREE.Face3?(a.a.copy(r.vertexNormals[0]),a.b.copy(r.vertexNormals[1]),a.c.copy(r.vertexNormals[2])):(a.a.copy(r.vertexNormals[0]),a.b.copy(r.vertexNormals[1]),a.c.copy(r.vertexNormals[2]),a.d.copy(r.vertexNormals[3]))}for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){function e(e,t,i,n,r,s,S){a=e.vertices[t],l=e.vertices[i],h=e.vertices[n],c=o[r],u=o[s],d=o[S],p=l.x-a.x,f=h.x-a.x,m=l.y-a.y,g=h.y-a.y,y=l.z-a.z,v=h.z-a.z,b=u.u-c.u,x=d.u-c.u,L=u.v-c.v,w=d.v-c.v,C=1/(b*w-x*L),_.set((w*p-L*f)*C,(w*m-L*g)*C,(w*y-L*v)*C),T.set((b*f-x*p)*C,(b*g-x*m)*C,(b*v-x*y)*C),E[t].addSelf(_),E[i].addSelf(_),E[n].addSelf(_),O[t].addSelf(T),O[i].addSelf(T),O[n].addSelf(T)}var t,i,n,r,s,o,a,l,h,c,u,d,p,f,m,g,y,v,b,x,L,w,C,S,E=[],O=[],_=new THREE.Vector3,T=new THREE.Vector3,k=new THREE.Vector3,P=new THREE.Vector3,A=new THREE.Vector3;for(t=0,i=this.vertices.length;i>t;t++)E[t]=new THREE.Vector3,O[t]=new THREE.Vector3;for(t=0,i=this.faces.length;i>t;t++)s=this.faces[t],o=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.d,0,1,3),e(this,s.b,s.c,s.d,1,2,3));var M=["a","b","c","d"];for(t=0,i=this.faces.length;i>t;t++)for(s=this.faces[t],n=0;s.vertexNormals.length>n;n++)A.copy(s.vertexNormals[n]),r=s[M[n]],S=E[r],k.copy(S),k.subSelf(A.multiplyScalar(A.dot(S))).normalize(),P.cross(s.vertexNormals[n],S),r=P.dot(O[r]),r=0>r?-1:1,s.vertexTangents[n]=new THREE.Vector4(k.x,k.y,k.z,r);this.hasTangents=!0},computeBoundingBox:function(){if(this.boundingBox||(this.boundingBox={min:new THREE.Vector3,max:new THREE.Vector3}),this.vertices.length>0){var e;e=this.vertices[0],this.boundingBox.min.copy(e),this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,i=this.boundingBox.max,n=1,r=this.vertices.length;r>n;n++)e=this.vertices[n],e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y),e.z<t.z?t.z=e.z:e.z>i.z&&(i.z=e.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});for(var e,t=0,i=0,n=this.vertices.length;n>i;i++)e=this.vertices[i].length(),e>t&&(t=e);this.boundingSphere.radius=t},mergeVertices:function(){var e,t,i,n,r={},s=[],o=[],a=Math.pow(10,4);for(t=0,i=this.vertices.length;i>t;t++)e=this.vertices[t],e=[Math.round(e.x*a),Math.round(e.y*a),Math.round(e.z*a)].join("_"),void 0===r[e]?(r[e]=t,s.push(this.vertices[t]),o[t]=s.length-1):o[t]=o[r[e]];for(t=0,i=this.faces.length;i>t;t++)if(a=this.faces[t],a instanceof THREE.Face3)a.a=o[a.a],a.b=o[a.b],a.c=o[a.c];else if(a instanceof THREE.Face4)for(a.a=o[a.a],a.b=o[a.b],a.c=o[a.c],a.d=o[a.d],e=[a.a,a.b,a.c,a.d],r=3;r>0;r--)if(e.indexOf(a["abcd"[r]])!=r){for(e.splice(r,1),this.faces[t]=new THREE.Face3(e[0],e[1],e[2]),a=0,e=this.faceVertexUvs.length;e>a;a++)(n=this.faceVertexUvs[a][t])&&n.splice(r,1);break}return o=this.vertices.length-s.length,this.vertices=s,o}},THREE.GeometryCount=0,THREE.Spline=function(e){function t(e,t,i,n,r,s,o){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*o+(-3*(t-i)-2*e-n)*s+e*r+t}this.points=e;var i,n,r,s,o,a,l,h,c,u=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;e.length>t;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,n=Math.floor(i),r=i-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?this.points.length-1:n+1,u[3]=n>this.points.length-3?this.points.length-1:n+2,a=this.points[u[0]],l=this.points[u[1]],h=this.points[u[2]],c=this.points[u[3]],s=r*r,o=r*s,d.x=t(a.x,l.x,h.x,c.x,r,s,o),d.y=t(a.y,l.y,h.y,c.y,r,s,o),d.z=t(a.z,l.z,h.z,c.z,r,s,o),d},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;i>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,i,n,r=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,a=[],l=0;for(a[0]=0,e||(e=100),i=this.points.length*e,s.copy(this.points[0]),e=1;i>e;e++)t=e/i,n=this.getPoint(t),o.copy(n),l+=o.distanceTo(s),s.copy(n),t=(this.points.length-1)*t,t=Math.floor(t),t!=r&&(a[t]=l,r=t);return a[a.length]=l,{chunks:a,total:l}},this.reparametrizeByArcLength=function(e){var t,i,n,r,s,o,a=[],l=new THREE.Vector3,h=this.getLength();for(a.push(l.copy(this.points[0]).clone()),t=1;this.points.length>t;t++){for(i=h.chunks[t]-h.chunks[t-1],o=Math.ceil(e*i/h.total),r=(t-1)/(this.points.length-1),s=t/(this.points.length-1),i=1;o-1>i;i++)n=r+i*(1/o)*(s-r),n=this.getPoint(n),a.push(l.copy(n).clone());a.push(l.copy(this.points[t]).clone())}this.points=a}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(e,t,i,n,r,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,i,n){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((void 0!==t?t:24)/(2*e))*(180/Math.PI),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,s){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,i=-t,n=e*i,e=Math.abs(e*t-n),i=Math.abs(t-i);this.projectionMatrix.makeFrustum(n+this.x*e/this.fullWidth,n+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*i/this.fullHeight,t-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(e,t,i,n,r){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/2,this.exponent=void 0!==r?r:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(e,t,i){e.materials=[];for(var n=0;t.length>n;++n)e.materials[n]=THREE.Loader.prototype.createMaterial(t[n],i)},hasNormals:function(e){var t,i,n=e.materials.length;for(i=0;n>i;i++)if(t=e.materials[i],t instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function i(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function n(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function r(e,t){var r=new Image;r.onload=function(){if(i(this.width)&&i(this.height))e.image=this;else{var t=n(this.width),r=n(this.height);e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}e.needsUpdate=!0},r.crossOrigin=a.crossOrigin,r.src=t}function s(e,i,n,s,o,a){var l=document.createElement("canvas");e[i]=new THREE.Texture(l),e[i].sourceFile=n,s&&(e[i].repeat.set(s[0],s[1]),1!=s[0]&&(e[i].wrapS=THREE.RepeatWrapping),1!=s[1]&&(e[i].wrapT=THREE.RepeatWrapping)),o&&e[i].offset.set(o[0],o[1]),a&&(s={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==s[a[0]]&&(e[i].wrapS=s[a[0]]),void 0!==s[a[1]]&&(e[i].wrapT=s[a[1]])),r(e[i],t+"/"+n)}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a=this,l="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:e.wireframe};if(e.shading){var c=e.shading.toLowerCase();"phong"===c?l="MeshPhongMaterial":"basic"===c&&(l="MeshBasicMaterial")}return void 0!==e.blending&&void 0!==THREE[e.blending]&&(h.blending=THREE[e.blending]),(void 0!==e.transparent||1>e.opacity)&&(h.transparent=e.transparent),void 0!==e.depthTest&&(h.depthTest=e.depthTest),void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite),void 0!==e.vertexColors&&("face"==e.vertexColors?h.vertexColors=THREE.FaceColors:e.vertexColors&&(h.vertexColors=THREE.VertexColors)),e.colorDiffuse?h.color=o(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=o(e.colorSpecular)),e.colorAmbient&&(h.ambient=o(e.colorAmbient)),e.transparency&&(h.opacity=e.transparency),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&t&&s(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap),e.mapLight&&t&&s(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap),e.mapNormal&&t&&s(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap),e.mapSpecular&&t&&s(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap),e.mapNormal?(l=THREE.ShaderUtils.lib.normal,c=THREE.UniformsUtils.clone(l.uniforms),c.tNormal.texture=h.normalMap,e.mapNormalFactor&&(c.uNormalScale.value=e.mapNormalFactor),h.map&&(c.tDiffuse.texture=h.map,c.enableDiffuse.value=!0),h.specularMap&&(c.tSpecular.texture=h.specularMap,c.enableSpecular.value=!0),h.lightMap&&(c.tAO.texture=h.lightMap,c.enableAO.value=!0),c.uDiffuseColor.value.setHex(h.color),c.uSpecularColor.value.setHex(h.specular),c.uAmbientColor.value.setHex(h.ambient),c.uShininess.value=h.shininess,void 0!==h.opacity&&(c.uOpacity.value=h.opacity),h=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:c,lights:!0,fog:!0})):h=new THREE[l](h),void 0!==e.DbgName&&(h.name=e.DbgName),h}},THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=new THREE.Loader,THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader,THREE.BinaryLoader.prototype.load=function(e,t,i,n){var i=i?i:this.extractUrlBase(e),n=n?n:this.extractUrlBase(e),r=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,i,n,r)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,i,n,r,s){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==o.status){var a=JSON.parse(o.responseText);e.loadAjaxBuffers(a,i,r,n,s)}else console.error("THREE.BinaryLoader: Couldn't load ["+t+"] ["+o.status+"]")},o.open("GET",t,!0),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,i,n,r){var s=new XMLHttpRequest,o=i+"/"+e.buffers,a=0;s.onreadystatechange=function(){4==s.readyState?200==s.status||0==s.status?THREE.BinaryLoader.prototype.createBinModel(s.response,t,n,e.materials):console.error("THREE.BinaryLoader: Couldn't load ["+o+"] ["+s.status+"]"):3==s.readyState?r&&(0==a&&(a=s.getResponseHeader("Content-Length")),r({total:a,loaded:s.responseText.length})):2==s.readyState&&(a=s.getResponseHeader("Content-Length"))},s.open("GET",o,!0),s.responseType="arraybuffer",s.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(e,t,i,n){var r=function(t){function i(e){return e%4?4-e%4:0}function r(e,t){return new Uint8Array(e,t,1)[0]}function s(e,t){return new Uint32Array(e,t,1)[0]}function o(t,i){var n,r,s,o,a,l,h,c,u=new Uint32Array(e,i,3*t);for(n=0;t>n;n++){r=u[3*n],s=u[3*n+1],o=u[3*n+2],a=N[2*r],r=N[2*r+1],l=N[2*s],h=N[2*s+1],s=N[2*o],c=N[2*o+1],o=P.faceVertexUvs[0];var d=[];d.push(new THREE.UV(a,r)),d.push(new THREE.UV(l,h)),d.push(new THREE.UV(s,c)),o.push(d)}}function a(t,i){var n,r,s,o,a,l,h,c,u,d,p=new Uint32Array(e,i,4*t);for(n=0;t>n;n++){r=p[4*n],s=p[4*n+1],o=p[4*n+2],a=p[4*n+3],l=N[2*r],r=N[2*r+1],h=N[2*s],u=N[2*s+1],c=N[2*o],d=N[2*o+1],o=N[2*a],s=N[2*a+1],a=P.faceVertexUvs[0];var f=[];f.push(new THREE.UV(l,r)),f.push(new THREE.UV(h,u)),f.push(new THREE.UV(c,d)),f.push(new THREE.UV(o,s)),a.push(f)}}function l(t,i,n){for(var r,s,o,a,i=new Uint32Array(e,i,3*t),l=new Uint16Array(e,n,t),n=0;t>n;n++)r=i[3*n],s=i[3*n+1],o=i[3*n+2],a=l[n],P.faces.push(new THREE.Face3(r,s,o,null,null,a))}function h(t,i,n){for(var r,s,o,a,l,i=new Uint32Array(e,i,4*t),h=new Uint16Array(e,n,t),n=0;t>n;n++)r=i[4*n],s=i[4*n+1],o=i[4*n+2],a=i[4*n+3],l=h[n],P.faces.push(new THREE.Face4(r,s,o,a,null,null,l))}function c(t,i,n,r){for(var s,o,a,l,h,c,u,i=new Uint32Array(e,i,3*t),n=new Uint32Array(e,n,3*t),d=new Uint16Array(e,r,t),r=0;t>r;r++){s=i[3*r],o=i[3*r+1],a=i[3*r+2],h=n[3*r],c=n[3*r+1],u=n[3*r+2],l=d[r];var p=M[3*c],f=M[3*c+1];c=M[3*c+2];var m=M[3*u],g=M[3*u+1];u=M[3*u+2],P.faces.push(new THREE.Face3(s,o,a,[new THREE.Vector3(M[3*h],M[3*h+1],M[3*h+2]),new THREE.Vector3(p,f,c),new THREE.Vector3(m,g,u)],null,l))}}function u(t,i,n,r){for(var s,o,a,l,h,c,u,d,p,i=new Uint32Array(e,i,4*t),n=new Uint32Array(e,n,4*t),f=new Uint16Array(e,r,t),r=0;t>r;r++){s=i[4*r],o=i[4*r+1],a=i[4*r+2],l=i[4*r+3],c=n[4*r],u=n[4*r+1],d=n[4*r+2],p=n[4*r+3],h=f[r];var m=M[3*u],g=M[3*u+1];u=M[3*u+2];var y=M[3*d],v=M[3*d+1];d=M[3*d+2];var b=M[3*p],x=M[3*p+1];p=M[3*p+2],P.faces.push(new THREE.Face4(s,o,a,l,[new THREE.Vector3(M[3*c],M[3*c+1],M[3*c+2]),new THREE.Vector3(m,g,u),new THREE.Vector3(y,v,d),new THREE.Vector3(b,x,p)],null,h))}}var d,p,f,m,g,y,v,b,x,L,w,C,S,E,O,_,T,k,P=this,A=0,M=[],N=[];THREE.Geometry.call(this),THREE.Loader.prototype.initMaterials(P,n,t),function(e,t,i){for(var e=new Uint8Array(e,t,i),n="",r=0;i>r;r++)n+=String.fromCharCode(e[t+r]);return n}(e,A,12),d=r(e,A+12),r(e,A+13),r(e,A+14),r(e,A+15),p=r(e,A+16),f=r(e,A+17),m=r(e,A+18),g=r(e,A+19),y=s(e,A+20),v=s(e,A+20+4),b=s(e,A+20+8),t=s(e,A+20+12),x=s(e,A+20+16),L=s(e,A+20+20),w=s(e,A+20+24),C=s(e,A+20+28),S=s(e,A+20+32),E=s(e,A+20+36),O=s(e,A+20+40),A+=d,d=3*p+g,k=4*p+g,_=t*d,T=x*(d+3*f),p=L*(d+3*m),g=w*(d+3*f+3*m),d=C*k,f=S*(k+4*f),m=E*(k+4*m),A+=function(t){var i,n,r,s,t=new Float32Array(e,t,3*y);for(i=0;y>i;i++)n=t[3*i],r=t[3*i+1],s=t[3*i+2],P.vertices.push(new THREE.Vector3(n,r,s));return 3*y*Float32Array.BYTES_PER_ELEMENT}(A),A+=function(t){if(v){var i,n,r,s,t=new Int8Array(e,t,3*v);for(i=0;v>i;i++)n=t[3*i],r=t[3*i+1],s=t[3*i+2],M.push(n/127,r/127,s/127)}return 3*v*Int8Array.BYTES_PER_ELEMENT}(A),A+=i(3*v),A+=function(t){if(b){var i,n,r,t=new Float32Array(e,t,2*b);for(i=0;b>i;i++)n=t[2*i],r=t[2*i+1],N.push(n,r)}return 2*b*Float32Array.BYTES_PER_ELEMENT}(A),_=A+_+i(2*t),T=_+T+i(2*x),p=T+p+i(2*L),g=p+g+i(2*w),d=g+d+i(2*C),f=d+f+i(2*S),m=f+m+i(2*E),function(e){if(L){var t=e+3*L*Uint32Array.BYTES_PER_ELEMENT;l(L,e,t+3*L*Uint32Array.BYTES_PER_ELEMENT),o(L,t)}}(T),function(e){if(w){var t=e+3*w*Uint32Array.BYTES_PER_ELEMENT,i=t+3*w*Uint32Array.BYTES_PER_ELEMENT;c(w,e,t,i+3*w*Uint32Array.BYTES_PER_ELEMENT),o(w,i)}}(p),function(e){if(E){var t=e+4*E*Uint32Array.BYTES_PER_ELEMENT;h(E,e,t+4*E*Uint32Array.BYTES_PER_ELEMENT),a(E,t)}}(f),function(e){if(O){var t=e+4*O*Uint32Array.BYTES_PER_ELEMENT,i=t+4*O*Uint32Array.BYTES_PER_ELEMENT;u(O,e,t,i+4*O*Uint32Array.BYTES_PER_ELEMENT),a(O,i)}}(m),t&&l(t,A,A+3*t*Uint32Array.BYTES_PER_ELEMENT),function(e){if(x){var t=e+3*x*Uint32Array.BYTES_PER_ELEMENT;c(x,e,t,t+3*x*Uint32Array.BYTES_PER_ELEMENT)}}(_),C&&h(C,g,g+4*C*Uint32Array.BYTES_PER_ELEMENT),function(e){if(S){var t=e+4*S*Uint32Array.BYTES_PER_ELEMENT;u(S,e,t,t+4*S*Uint32Array.BYTES_PER_ELEMENT)}}(d),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};r.prototype=new THREE.Geometry,r.prototype.constructor=r,t(new r(i))},THREE.JSONLoader=function(e){THREE.Loader.call(this,e)},THREE.JSONLoader.prototype=new THREE.Loader,THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.load=function(e,t,i){i=i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var a=JSON.parse(s.responseText);e.createModel(a,i,n)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+s.status+"]");else s.readyState===s.LOADING?r&&(0===o&&(o=s.getResponseHeader("Content-Length")),r({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.overrideMimeType&&s.overrideMimeType("text/plain; charset=x-user-defined"),s.setRequestHeader("Content-Type","text/plain"),s.send(null)},THREE.JSONLoader.prototype.createModel=function(e,t,i){var n=new THREE.Geometry,r=void 0!==e.scale?1/e.scale:1;this.initMaterials(n,e.materials,i),function(t){var i,r,s,o,a,l,h,c,u,d,p,f,m,g,y=e.faces;
l=e.vertices;var v=e.normals,b=e.colors,x=0;for(i=0;e.uvs.length>i;i++)e.uvs[i].length&&x++;for(i=0;x>i;i++)n.faceUvs[i]=[],n.faceVertexUvs[i]=[];for(o=0,a=l.length;a>o;)h=new THREE.Vector3,h.x=l[o++]*t,h.y=l[o++]*t,h.z=l[o++]*t,n.vertices.push(h);for(o=0,a=y.length;a>o;){if(t=y[o++],l=1&t,s=2&t,i=4&t,r=8&t,c=16&t,h=32&t,d=64&t,t=128&t,l?(p=new THREE.Face4,p.a=y[o++],p.b=y[o++],p.c=y[o++],p.d=y[o++],l=4):(p=new THREE.Face3,p.a=y[o++],p.b=y[o++],p.c=y[o++],l=3),s&&(s=y[o++],p.materialIndex=s),s=n.faces.length,i)for(i=0;x>i;i++)f=e.uvs[i],u=y[o++],g=f[2*u],u=f[2*u+1],n.faceUvs[i][s]=new THREE.UV(g,u);if(r)for(i=0;x>i;i++){for(f=e.uvs[i],m=[],r=0;l>r;r++)u=y[o++],g=f[2*u],u=f[2*u+1],m[r]=new THREE.UV(g,u);n.faceVertexUvs[i][s]=m}if(c&&(c=3*y[o++],r=new THREE.Vector3,r.x=v[c++],r.y=v[c++],r.z=v[c],p.normal=r),h)for(i=0;l>i;i++)c=3*y[o++],r=new THREE.Vector3,r.x=v[c++],r.y=v[c++],r.z=v[c],p.vertexNormals.push(r);if(d&&(h=y[o++],h=new THREE.Color(b[h]),p.color=h),t)for(i=0;l>i;i++)h=y[o++],h=new THREE.Color(b[h]),p.vertexColors.push(h);n.faces.push(p)}}(r),function(){var t,i,r,s;if(e.skinWeights)for(t=0,i=e.skinWeights.length;i>t;t+=2)r=e.skinWeights[t],s=e.skinWeights[t+1],n.skinWeights.push(new THREE.Vector4(r,s,0,0));if(e.skinIndices)for(t=0,i=e.skinIndices.length;i>t;t+=2)r=e.skinIndices[t],s=e.skinIndices[t+1],n.skinIndices.push(new THREE.Vector4(r,s,0,0));n.bones=e.bones,n.animation=e.animation}(),function(t){if(void 0!==e.morphTargets){var i,r,s,o,a,l;for(i=0,r=e.morphTargets.length;r>i;i++)for(n.morphTargets[i]={},n.morphTargets[i].name=e.morphTargets[i].name,n.morphTargets[i].vertices=[],a=n.morphTargets[i].vertices,l=e.morphTargets[i].vertices,s=0,o=l.length;o>s;s+=3){var h=new THREE.Vector3;h.x=l[s]*t,h.y=l[s+1]*t,h.z=l[s+2]*t,a.push(h)}}if(void 0!==e.morphColors)for(i=0,r=e.morphColors.length;r>i;i++)for(n.morphColors[i]={},n.morphColors[i].name=e.morphColors[i].name,n.morphColors[i].colors=[],o=n.morphColors[i].colors,a=e.morphColors[i].colors,t=0,s=a.length;s>t;t+=3)l=new THREE.Color(16755200),l.setRGB(a[t],a[t+1],a[t+2]),o.push(l)}(r),n.computeCentroids(),n.computeFaceNormals(),this.hasNormals(n)&&n.computeTangents(),t(n)},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status||0==n.status){var r=JSON.parse(n.responseText);i.createScene(r,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+n.status+"]")},n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.setRequestHeader("Content-Type","text/plain"),n.send(null)},THREE.SceneLoader.prototype.createScene=function(e,t,i){function n(e,t){return"relativeToHTML"==t?e:F+"/"+e}function r(){var e;for(c in k.objects)D.objects[c]||(m=k.objects[c],void 0!==m.geometry?(E=D.geometries[m.geometry])&&(e=!1,O=D.materials[m.materials[0]],(e=O instanceof THREE.ShaderMaterial)&&E.computeTangents(),b=m.position,x=m.rotation,L=m.quaternion,w=m.scale,g=m.matrix,L=0,0==m.materials.length&&(O=new THREE.MeshFaceMaterial),m.materials.length>1&&(O=new THREE.MeshFaceMaterial),e=new THREE.Mesh(E,O),e.name=c,g?(e.matrixAutoUpdate=!1,e.matrix.set(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15])):(e.position.set(b[0],b[1],b[2]),L?(e.quaternion.set(L[0],L[1],L[2],L[3]),e.useQuaternion=!0):e.rotation.set(x[0],x[1],x[2]),e.scale.set(w[0],w[1],w[2])),e.visible=m.visible,e.doubleSided=m.doubleSided,e.castShadow=m.castShadow,e.receiveShadow=m.receiveShadow,D.scene.add(e),D.objects[c]=e):(b=m.position,x=m.rotation,L=m.quaternion,w=m.scale,L=0,e=new THREE.Object3D,e.name=c,e.position.set(b[0],b[1],b[2]),L?(e.quaternion.set(L[0],L[1],L[2],L[3]),e.useQuaternion=!0):e.rotation.set(x[0],x[1],x[2]),e.scale.set(w[0],w[1],w[2]),e.visible=void 0!==m.visible?m.visible:!1,D.scene.add(e),D.objects[c]=e,D.empties[c]=e))}function s(e){return function(t){D.geometries[e]=t,r(),A-=1,I.onLoadComplete(),a()}}function o(e){return function(t){D.geometries[e]=t}}function a(){I.callbackProgress({totalModels:N,totalTextures:R,loadedModels:N-A,loadedTextures:R-M},D),I.onLoadProgress(),0==A&&0==M&&t(D)}var l,h,c,u,d,p,f,m,g,y,v,b,x,L,w,C,S,E,O,_,T,k,P,A,M,N,R,D,I=this,F=THREE.Loader.prototype.extractUrlBase(i);k=e,i=new THREE.BinaryLoader,P=new THREE.JSONLoader,M=A=0,D={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}},k.transform&&(e=k.transform.position,y=k.transform.rotation,C=k.transform.scale,e&&D.scene.position.set(e[0],e[1],e[2]),y&&D.scene.rotation.set(y[0],y[1],y[2]),C&&D.scene.scale.set(C[0],C[1],C[2]),(e||y||C)&&(D.scene.updateMatrix(),D.scene.updateMatrixWorld())),e=function(){M-=1,a(),I.onLoadComplete()};for(d in k.cameras)C=k.cameras[d],"perspective"==C.type?_=new THREE.PerspectiveCamera(C.fov,C.aspect,C.near,C.far):"ortho"==C.type&&(_=new THREE.OrthographicCamera(C.left,C.right,C.top,C.bottom,C.near,C.far)),b=C.position,y=C.target,C=C.up,_.position.set(b[0],b[1],b[2]),_.target=new THREE.Vector3(y[0],y[1],y[2]),C&&_.up.set(C[0],C[1],C[2]),D.cameras[d]=_;for(u in k.lights)y=k.lights[u],d=void 0!==y.color?y.color:16777215,_=void 0!==y.intensity?y.intensity:1,"directional"==y.type?(b=y.direction,v=new THREE.DirectionalLight(d,_),v.position.set(b[0],b[1],b[2]),v.position.normalize()):"point"==y.type?(b=y.position,v=y.distance,v=new THREE.PointLight(d,_,v),v.position.set(b[0],b[1],b[2])):"ambient"==y.type&&(v=new THREE.AmbientLight(d)),D.scene.add(v),D.lights[u]=v;for(p in k.fogs)u=k.fogs[p],"linear"==u.type?T=new THREE.Fog(0,u.near,u.far):"exp2"==u.type&&(T=new THREE.FogExp2(0,u.density)),C=u.color,T.color.setRGB(C[0],C[1],C[2]),D.fogs[p]=T;D.cameras&&k.defaults.camera&&(D.currentCamera=D.cameras[k.defaults.camera]),D.fogs&&k.defaults.fog&&(D.scene.fog=D.fogs[k.defaults.fog]),C=k.defaults.bgcolor,D.bgColor=new THREE.Color,D.bgColor.setRGB(C[0],C[1],C[2]),D.bgColorAlpha=k.defaults.bgalpha;for(l in k.geometries)p=k.geometries[l],("bin_mesh"==p.type||"ascii_mesh"==p.type)&&(A+=1,I.onLoadStart());N=A;for(l in k.geometries)p=k.geometries[l],"cube"==p.type?(E=new THREE.CubeGeometry(p.width,p.height,p.depth,p.segmentsWidth,p.segmentsHeight,p.segmentsDepth,null,p.flipped,p.sides),D.geometries[l]=E):"plane"==p.type?(E=new THREE.PlaneGeometry(p.width,p.height,p.segmentsWidth,p.segmentsHeight),D.geometries[l]=E):"sphere"==p.type?(E=new THREE.SphereGeometry(p.radius,p.segmentsWidth,p.segmentsHeight),D.geometries[l]=E):"cylinder"==p.type?(E=new THREE.CylinderGeometry(p.topRad,p.botRad,p.height,p.radSegs,p.heightSegs),D.geometries[l]=E):"torus"==p.type?(E=new THREE.TorusGeometry(p.radius,p.tube,p.segmentsR,p.segmentsT),D.geometries[l]=E):"icosahedron"==p.type?(E=new THREE.IcosahedronGeometry(p.radius,p.subdivisions),D.geometries[l]=E):"bin_mesh"==p.type?i.load(n(p.url,k.urlBaseType),s(l)):"ascii_mesh"==p.type?P.load(n(p.url,k.urlBaseType),s(l)):"embedded_mesh"==p.type&&(p=k.embeds[p.id],p.metadata=k.metadata,p&&P.createModel(p,o(l),""));for(f in k.textures)if(l=k.textures[f],l.url instanceof Array)for(M+=l.url.length,p=0;l.url.length>p;p++)I.onLoadStart();else M+=1,I.onLoadStart();R=M;for(f in k.textures){if(l=k.textures[f],void 0!=l.mapping&&void 0!=THREE[l.mapping]&&(l.mapping=new THREE[l.mapping]),l.url instanceof Array){for(p=[],T=0;l.url.length>T;T++)p[T]=n(l.url[T],k.urlBaseType);p=THREE.ImageUtils.loadTextureCube(p,l.mapping,e)}else p=THREE.ImageUtils.loadTexture(n(l.url,k.urlBaseType),l.mapping,e),void 0!=THREE[l.minFilter]&&(p.minFilter=THREE[l.minFilter]),void 0!=THREE[l.magFilter]&&(p.magFilter=THREE[l.magFilter]),l.repeat&&(p.repeat.set(l.repeat[0],l.repeat[1]),1!=l.repeat[0]&&(p.wrapS=THREE.RepeatWrapping),1!=l.repeat[1]&&(p.wrapT=THREE.RepeatWrapping)),l.offset&&p.offset.set(l.offset[0],l.offset[1]),l.wrap&&(T={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==T[l.wrap[0]]&&(p.wrapS=T[l.wrap[0]]),void 0!==T[l.wrap[1]]&&(p.wrapT=T[l.wrap[1]]));D.textures[f]=p}for(h in k.materials){g=k.materials[h];for(S in g.parameters)"envMap"==S||"map"==S||"lightMap"==S?g.parameters[S]=D.textures[g.parameters[S]]:"shading"==S?g.parameters[S]="flat"==g.parameters[S]?THREE.FlatShading:THREE.SmoothShading:"blending"==S?g.parameters[S]=THREE[g.parameters[S]]?THREE[g.parameters[S]]:THREE.NormalBlending:"combine"==S?g.parameters[S]="MixOperation"==g.parameters[S]?THREE.MixOperation:THREE.MultiplyOperation:"vertexColors"==S&&("face"==g.parameters[S]?g.parameters[S]=THREE.FaceColors:g.parameters[S]&&(g.parameters[S]=THREE.VertexColors));void 0!==g.parameters.opacity&&1>g.parameters.opacity&&(g.parameters.transparent=!0),g.parameters.normalMap?(f=THREE.ShaderUtils.lib.normal,e=THREE.UniformsUtils.clone(f.uniforms),l=g.parameters.color,p=g.parameters.specular,T=g.parameters.ambient,i=g.parameters.shininess,e.tNormal.texture=D.textures[g.parameters.normalMap],g.parameters.normalMapFactor&&(e.uNormalScale.value=g.parameters.normalMapFactor),g.parameters.map&&(e.tDiffuse.texture=g.parameters.map,e.enableDiffuse.value=!0),g.parameters.lightMap&&(e.tAO.texture=g.parameters.lightMap,e.enableAO.value=!0),g.parameters.specularMap&&(e.tSpecular.texture=D.textures[g.parameters.specularMap],e.enableSpecular.value=!0),e.uDiffuseColor.value.setHex(l),e.uSpecularColor.value.setHex(p),e.uAmbientColor.value.setHex(T),e.uShininess.value=i,g.parameters.opacity&&(e.uOpacity.value=g.parameters.opacity),O=new THREE.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:e,lights:!0,fog:!0})):O=new THREE[g.type](g.parameters),D.materials[h]=O}r(),I.callbackSync(D),a()},THREE.Material=function(e){e=e||{},this.id=THREE.MaterialCount++,this.name="",this.opacity=void 0!==e.opacity?e.opacity:1,this.transparent=void 0!==e.transparent?e.transparent:!1,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.blendSrc=void 0!==e.blendSrc?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=void 0!==e.blendDst?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=void 0!==e.blendEquation?e.blendEquation:THREE.AddEquation,this.depthTest=void 0!==e.depthTest?e.depthTest:!0,this.depthWrite=void 0!==e.depthWrite?e.depthWrite:!0,this.polygonOffset=void 0!==e.polygonOffset?e.polygonOffset:!1,this.polygonOffsetFactor=void 0!==e.polygonOffsetFactor?e.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==e.polygonOffsetUnits?e.polygonOffsetUnits:0,this.alphaTest=void 0!==e.alphaTest?e.alphaTest:0,this.overdraw=void 0!==e.overdraw?e.overdraw:!1,this.needsUpdate=this.visible=!0},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.AdditiveAlphaBlending=5,THREE.CustomBlending=6,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.linewidth=void 0!==e.linewidth?e.linewidth:1,this.linecap=void 0!==e.linecap?e.linecap:"round",this.linejoin=void 0!==e.linejoin?e.linejoin:"round",this.vertexColors=e.vertexColors?e.vertexColors:!1,this.fog=void 0!==e.fog?e.fog:!0},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0!==e.fog?e.fog:!0,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe?e.wireframe:!1,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning?e.skinning:!1,this.morphTargets=void 0!==e.morphTargets?e.morphTargets:!1},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(16777215),this.emissive=void 0!==e.emissive?new THREE.Color(e.emissive):new THREE.Color(0),this.wrapAround=void 0!==e.wrapAround?e.wrapAround:!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0!==e.fog?e.fog:!0,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe?e.wireframe:!1,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning?e.skinning:!1,this.morphTargets=void 0!==e.morphTargets?e.morphTargets:!1,this.morphNormals=void 0!==e.morphNormals?e.morphNormals:!1},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(16777215),this.emissive=void 0!==e.emissive?new THREE.Color(e.emissive):new THREE.Color(0),this.specular=void 0!==e.specular?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=void 0!==e.shininess?e.shininess:30,this.metal=void 0!==e.metal?e.metal:!1,this.perPixel=void 0!==e.perPixel?e.perPixel:!1,this.wrapAround=void 0!==e.wrapAround?e.wrapAround:!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0!==e.fog?e.fog:!0,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe?e.wireframe:!1,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning?e.skinning:!1,this.morphTargets=void 0!==e.morphTargets?e.morphTargets:!1,this.morphNormals=void 0!==e.morphNormals?e.morphNormals:!1},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe?e.wireframe:!1,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=e.wireframe?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.size=void 0!==e.size?e.size:1,this.sizeAttenuation=void 0!==e.sizeAttenuation?e.sizeAttenuation:!0,this.vertexColors=void 0!==e.vertexColors?e.vertexColors:!1,this.fog=void 0!==e.fog?e.fog:!0},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.program=void 0!==e.program?e.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.ParticleDOMMaterial=function(e){THREE.Material.call(this),this.domElement=e},THREE.ShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=void 0!==e.fragmentShader?e.fragmentShader:"void main() {}",this.vertexShader=void 0!==e.vertexShader?e.vertexShader:"void main() {}",this.uniforms=void 0!==e.uniforms?e.uniforms:{},this.attributes=e.attributes,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe?e.wireframe:!1,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.fog=void 0!==e.fog?e.fog:!1,this.lights=void 0!==e.lights?e.lights:!1,this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning?e.skinning:!1,this.morphTargets=void 0!==e.morphTargets?e.morphTargets:!1,this.morphNormals=void 0!==e.morphNormals?e.morphNormals:!1},THREE.ShaderMaterial.prototype=new THREE.Material,THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.Texture=function(e,t,i,n,r,s,o,a){this.id=THREE.TextureCount++,this.image=e,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==s?s:THREE.LinearMipMapLinearFilter,this.format=void 0!==o?o:THREE.RGBAFormat,this.type=void 0!==a?a:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.needsUpdate=this.premultiplyAlpha=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(e,t,i,n,r,s,o,a,l,h){THREE.Texture.call(this,null,s,o,a,l,h,n,r),this.image={data:e,width:t,height:i}},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius),this.frustumCulled=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){if(THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0;this.geometry.morphTargets.length>i;i++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t){THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var i,n,r,s,o,a;if(void 0!==this.geometry.bones){for(i=0;this.geometry.bones.length>i;i++)r=this.geometry.bones[i],s=r.pos,o=r.rotq,a=r.scl,n=this.addBone(),n.name=r.name,n.position.set(s[0],s[1],s[2]),n.quaternion.set(o[0],o[1],o[2],o[3]),n.useQuaternion=!0,void 0!==a?n.scale.set(a[0],a[1],a[2]):n.scale.set(1,1,1);for(i=0;this.bones.length>i;i++)r=this.geometry.bones[i],n=this.bones[i],-1===r.parent?this.add(n):this.bones[r.parent].add(n);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var e=0,t=this.children.length;t>e;e++){var i=this.children[e];i instanceof THREE.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}for(var t=this.bones.length,i=this.bones,n=this.boneMatrices,e=0;t>e;e++)i[e].skinMatrix.flattenToArrayOffset(n,16*e)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e,t=[],i=0;this.bones.length>i;i++){e=this.bones[i];var n=new THREE.Matrix4;n.getInverse(e.skinMatrix),t.push(n),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,16*i)}if(void 0===this.geometry.skinVerticesA)for(this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[],e=0;this.geometry.skinIndices.length>e;e++){var i=this.geometry.vertices[e],r=this.geometry.skinIndices[e].x,s=this.geometry.skinIndices[e].y,n=new THREE.Vector3(i.x,i.y,i.z);this.geometry.skinVerticesA.push(t[r].multiplyVector3(n)),n=new THREE.Vector3(i.x,i.y,i.z),this.geometry.skinVerticesB.push(t[s].multiplyVector3(n)),1!==this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y&&(i=.5*(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y)),this.geometry.skinWeights[e].x=this.geometry.skinWeights[e].x+i,this.geometry.skinWeights[e].y=this.geometry.skinWeights[e].y+i)}},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=new THREE.Mesh,THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)(\d+)/,r=0,s=e.morphTargets.length;s>r;r++){var o=e.morphTargets[r].name.match(n);if(o&&o.length>1){o=o[1],i[o]||(i[o]={start:1/0,end:-1/0});var a=i[o];a.start>r&&(a.start=r),r>a.end&&(a.end=r),t||(t=o)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time=this.time+this.direction*e,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction=-1*this.direction,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,0>this.time&&(this.time=this.time+this.duration)),e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),i=0;this.LODs.length>i&&!(this.LODs[i].visibleAtDistance>t);i++);this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;this.LODs.length>t&&e>=this.LODs[t].visibleAtDistance;t++)this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0;for(;this.LODs.length>t;t++)this.LODs[t].object3D.visible=!1}},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:new THREE.Texture,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.blendSrc=void 0!==e.blendSrc?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=void 0!==e.blendDst?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=void 0!==e.blendEquation?e.blendEquation:THREE.AddEquation,this.useScreenCoordinates=void 0!==e.useScreenCoordinates?e.useScreenCoordinates:!0,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);
var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;e.children.length>t;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else e instanceof THREE.Camera||(t=this.__objects.indexOf(e),-1!==t&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1)));for(t=0;e.children.length>t;t++)this.__removeObject(e.children[t])},THREE.Fog=function(e,t,i){this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.DOMRenderer=function(){console.log("THREE.DOMRenderer",THREE.REVISION);var e,t,i,n,r,s,o,a=new THREE.Projector;o=function(e){for(var t=document.documentElement,i=0;e.length>i;i++)if("string"==typeof t.style[e[i]])return e[i];return null}(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]),this.domElement=document.createElement("div"),this.setSize=function(e,t){i=e,n=t,r=i/2,s=n/2},this.render=function(i,n){var l,h,c,u,d,p;for(e=a.projectScene(i,n),t=e.elements,l=0,h=t.length;h>l;l++)c=t[l],c instanceof THREE.RenderableParticle&&c.material instanceof THREE.ParticleDOMMaterial&&(u=c.material.domElement,d=c.x*r+r-(u.offsetWidth>>1),p=c.y*s+s-(u.offsetHeight>>1),u.style.left=d+"px",u.style.top=p+"px",u.style.zIndex=Math.abs(Math.floor((1-c.z)*n.far/n.near)),o&&(u.style[o]="scale("+c.scale.x*r+","+c.scale.y*s+")"))}},THREE.CanvasRenderer=function(e){function t(e){Y!=e&&(W.globalAlpha=Y=e)}function i(e){if(K!=e){switch(e){case THREE.NormalBlending:W.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:W.globalCompositeOperation="lighter"}K=e}}function n(e){Z!=e&&(W.strokeStyle=Z=e)}function r(e){Q!=e&&(W.fillStyle=Q=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var s,o,a,l,h,c,u,d,p,f,m,g,y,v,b,x,L,w,C,S,E,O,_,T,k,P,A,M,N,R,D,I,F,B,G,j,z,X,U,e=e||{},H=this,J=new THREE.Projector,V=void 0!==e.canvas?e.canvas:document.createElement("canvas"),W=V.getContext("2d"),$=new THREE.Color(0),q=0,Y=1,K=0,Z=null,Q=null,et=null,tt=null,it=null,nt=new THREE.RenderableVertex,rt=new THREE.RenderableVertex,st=new THREE.Color,ot=new THREE.Color,at=new THREE.Color,lt=new THREE.Color,ht=new THREE.Color,ct=[],ut=[],dt=new THREE.Rectangle,pt=new THREE.Rectangle,ft=new THREE.Rectangle,mt=!1,gt=new THREE.Color,yt=new THREE.Color,vt=new THREE.Color,bt=new THREE.Vector3,e=16;B=document.createElement("canvas"),B.width=B.height=2,G=B.getContext("2d"),G.fillStyle="rgba(0,0,0,1)",G.fillRect(0,0,2,2),j=G.getImageData(0,0,2,2),z=j.data,X=document.createElement("canvas"),X.width=X.height=e,U=X.getContext("2d"),U.translate(-e/2,-e/2),U.scale(e,e),e--,this.domElement=V,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){l=e,h=t,c=Math.floor(l/2),u=Math.floor(h/2),V.width=l,V.height=h,dt.set(-c,-u,c,u),pt.set(-c,-u,c,u),Y=1,K=0,it=tt=et=Q=Z=null},this.setClearColor=function(e,t){$.copy(e),q=void 0!==t?t:1,pt.set(-c,-u,c,u)},this.setClearColorHex=function(e,t){$.setHex(e),q=void 0!==t?t:1,pt.set(-c,-u,c,u)},this.clear=function(){W.setTransform(1,0,0,-1,c,u),pt.isEmpty()||(pt.minSelf(dt),pt.inflate(2),1>q&&W.clearRect(Math.floor(pt.getX()),Math.floor(pt.getY()),Math.floor(pt.getWidth()),Math.floor(pt.getHeight())),q>0&&(i(THREE.NormalBlending),t(1),r("rgba("+Math.floor(255*$.r)+","+Math.floor(255*$.g)+","+Math.floor(255*$.b)+","+q+")"),W.fillRect(Math.floor(pt.getX()),Math.floor(pt.getY()),Math.floor(pt.getWidth()),Math.floor(pt.getHeight()))),pt.empty())},this.render=function(e,l){function h(e){var t,i,n,r;for(gt.setRGB(0,0,0),yt.setRGB(0,0,0),vt.setRGB(0,0,0),t=0,i=e.length;i>t;t++)n=e[t],r=n.color,n instanceof THREE.AmbientLight?(gt.r=gt.r+r.r,gt.g=gt.g+r.g,gt.b=gt.b+r.b):n instanceof THREE.DirectionalLight?(yt.r=yt.r+r.r,yt.g=yt.g+r.g,yt.b=yt.b+r.b):n instanceof THREE.PointLight&&(vt.r=vt.r+r.r,vt.g=vt.g+r.g,vt.b=vt.b+r.b)}function V(e,t,i,n){var r,s,o,a,l,h;for(r=0,s=e.length;s>r;r++)o=e[r],a=o.color,o instanceof THREE.DirectionalLight?(l=o.matrixWorld.getPosition(),h=i.dot(l),0>=h||(h*=o.intensity,n.r=n.r+a.r*h,n.g=n.g+a.g*h,n.b=n.b+a.b*h)):o instanceof THREE.PointLight&&(l=o.matrixWorld.getPosition(),h=i.dot(bt.sub(l,t).normalize()),0>=h||(h*=0==o.distance?1:1-Math.min(t.distanceTo(l)/o.distance,1),0!=h&&(h*=o.intensity,n.r=n.r+a.r*h,n.g=n.g+a.g*h,n.b=n.b+a.b*h)))}function $(e,s,o){t(o.opacity),i(o.blending);var a,l,h,d,p,f;o instanceof THREE.ParticleBasicMaterial?o.map&&(d=o.map.image,p=d.width>>1,f=d.height>>1,o=s.scale.x*c,h=s.scale.y*u,a=o*p,l=h*f,ft.set(e.x-a,e.y-l,e.x+a,e.y+l),dt.intersects(ft)&&(W.save(),W.translate(e.x,e.y),W.rotate(-s.rotation),W.scale(o,-h),W.translate(-p,-f),W.drawImage(d,0,0),W.restore())):o instanceof THREE.ParticleCanvasMaterial&&(a=s.scale.x*c,l=s.scale.y*u,ft.set(e.x-a,e.y-l,e.x+a,e.y+l),dt.intersects(ft)&&(n(o.color.getContextStyle()),r(o.color.getContextStyle()),W.save(),W.translate(e.x,e.y),W.rotate(-s.rotation),W.scale(a,l),o.program(W),W.restore()))}function q(e,r,s,o){t(o.opacity),i(o.blending),W.beginPath(),W.moveTo(e.positionScreen.x,e.positionScreen.y),W.lineTo(r.positionScreen.x,r.positionScreen.y),W.closePath(),o instanceof THREE.LineBasicMaterial&&(e=o.linewidth,et!=e&&(W.lineWidth=et=e),e=o.linecap,tt!=e&&(W.lineCap=tt=e),e=o.linejoin,it!=e&&(W.lineJoin=it=e),n(o.color.getContextStyle()),W.stroke(),ft.inflate(2*o.linewidth))}function Y(e,n,r,s,o,h,c,u){H.info.render.vertices=H.info.render.vertices+3,H.info.render.faces++,t(u.opacity),i(u.blending),g=e.positionScreen.x,y=e.positionScreen.y,v=n.positionScreen.x,b=n.positionScreen.y,x=r.positionScreen.x,L=r.positionScreen.y,Z(g,y,v,b,x,L),u instanceof THREE.MeshBasicMaterial?u.map?u.map.mapping instanceof THREE.UVMapping&&(A=c.uvs[0],wt(g,y,v,b,x,L,A[s].u,A[s].v,A[o].u,A[o].v,A[h].u,A[h].v,u.map)):u.envMap?u.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=l.matrixWorldInverse,bt.copy(c.vertexNormalsWorld[s]),M=.5*(bt.x*e.elements[0]+bt.y*e.elements[4]+bt.z*e.elements[8])+.5,N=.5*-(bt.x*e.elements[1]+bt.y*e.elements[5]+bt.z*e.elements[9])+.5,bt.copy(c.vertexNormalsWorld[o]),R=.5*(bt.x*e.elements[0]+bt.y*e.elements[4]+bt.z*e.elements[8])+.5,D=.5*-(bt.x*e.elements[1]+bt.y*e.elements[5]+bt.z*e.elements[9])+.5,bt.copy(c.vertexNormalsWorld[h]),I=.5*(bt.x*e.elements[0]+bt.y*e.elements[4]+bt.z*e.elements[8])+.5,F=.5*-(bt.x*e.elements[1]+bt.y*e.elements[5]+bt.z*e.elements[9])+.5,wt(g,y,v,b,x,L,M,N,R,D,I,F,u.envMap)):u.wireframe?xt(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(u.color):u instanceof THREE.MeshLambertMaterial?mt?u.wireframe||u.shading!=THREE.SmoothShading||3!=c.vertexNormalsWorld.length?(st.r=gt.r,st.g=gt.g,st.b=gt.b,V(a,c.centroidWorld,c.normalWorld,st),st.r=Math.max(0,Math.min(u.color.r*st.r,1)),st.g=Math.max(0,Math.min(u.color.g*st.g,1)),st.b=Math.max(0,Math.min(u.color.b*st.b,1)),u.wireframe?xt(st,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(st)):(ot.r=at.r=lt.r=gt.r,ot.g=at.g=lt.g=gt.g,ot.b=at.b=lt.b=gt.b,V(a,c.v1.positionWorld,c.vertexNormalsWorld[0],ot),V(a,c.v2.positionWorld,c.vertexNormalsWorld[1],at),V(a,c.v3.positionWorld,c.vertexNormalsWorld[2],lt),ot.r=Math.max(0,Math.min(u.color.r*ot.r,1)),ot.g=Math.max(0,Math.min(u.color.g*ot.g,1)),ot.b=Math.max(0,Math.min(u.color.b*ot.b,1)),at.r=Math.max(0,Math.min(u.color.r*at.r,1)),at.g=Math.max(0,Math.min(u.color.g*at.g,1)),at.b=Math.max(0,Math.min(u.color.b*at.b,1)),lt.r=Math.max(0,Math.min(u.color.r*lt.r,1)),lt.g=Math.max(0,Math.min(u.color.g*lt.g,1)),lt.b=Math.max(0,Math.min(u.color.b*lt.b,1)),ht.r=.5*(at.r+lt.r),ht.g=.5*(at.g+lt.g),ht.b=.5*(at.b+lt.b),P=St(ot,at,lt,ht),Ct(g,y,v,b,x,L,0,0,1,0,0,1,P)):u.wireframe?xt(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(u.color):u instanceof THREE.MeshDepthMaterial?(T=l.near,k=l.far,ot.r=ot.g=ot.b=1-Et(e.positionScreen.z,T,k),at.r=at.g=at.b=1-Et(n.positionScreen.z,T,k),lt.r=lt.g=lt.b=1-Et(r.positionScreen.z,T,k),ht.r=.5*(at.r+lt.r),ht.g=.5*(at.g+lt.g),ht.b=.5*(at.b+lt.b),P=St(ot,at,lt,ht),Ct(g,y,v,b,x,L,0,0,1,0,0,1,P)):u instanceof THREE.MeshNormalMaterial&&(st.r=Ot(c.normalWorld.x),st.g=Ot(c.normalWorld.y),st.b=Ot(c.normalWorld.z),u.wireframe?xt(st,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(st))}function K(e,n,r,s,o,h,c,u,d){H.info.render.vertices=H.info.render.vertices+4,H.info.render.faces++,t(u.opacity),i(u.blending),u.map||u.envMap?(Y(e,n,s,0,1,3,c,u,d),Y(o,r,h,1,2,3,c,u,d)):(g=e.positionScreen.x,y=e.positionScreen.y,v=n.positionScreen.x,b=n.positionScreen.y,x=r.positionScreen.x,L=r.positionScreen.y,w=s.positionScreen.x,C=s.positionScreen.y,S=o.positionScreen.x,E=o.positionScreen.y,O=h.positionScreen.x,_=h.positionScreen.y,u instanceof THREE.MeshBasicMaterial?(Q(g,y,v,b,x,L,w,C),u.wireframe?xt(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(u.color)):u instanceof THREE.MeshLambertMaterial?mt?u.wireframe||u.shading!=THREE.SmoothShading||4!=c.vertexNormalsWorld.length?(st.r=gt.r,st.g=gt.g,st.b=gt.b,V(a,c.centroidWorld,c.normalWorld,st),st.r=Math.max(0,Math.min(u.color.r*st.r,1)),st.g=Math.max(0,Math.min(u.color.g*st.g,1)),st.b=Math.max(0,Math.min(u.color.b*st.b,1)),Q(g,y,v,b,x,L,w,C),u.wireframe?xt(st,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(st)):(ot.r=at.r=lt.r=ht.r=gt.r,ot.g=at.g=lt.g=ht.g=gt.g,ot.b=at.b=lt.b=ht.b=gt.b,V(a,c.v1.positionWorld,c.vertexNormalsWorld[0],ot),V(a,c.v2.positionWorld,c.vertexNormalsWorld[1],at),V(a,c.v4.positionWorld,c.vertexNormalsWorld[3],lt),V(a,c.v3.positionWorld,c.vertexNormalsWorld[2],ht),ot.r=Math.max(0,Math.min(u.color.r*ot.r,1)),ot.g=Math.max(0,Math.min(u.color.g*ot.g,1)),ot.b=Math.max(0,Math.min(u.color.b*ot.b,1)),at.r=Math.max(0,Math.min(u.color.r*at.r,1)),at.g=Math.max(0,Math.min(u.color.g*at.g,1)),at.b=Math.max(0,Math.min(u.color.b*at.b,1)),lt.r=Math.max(0,Math.min(u.color.r*lt.r,1)),lt.g=Math.max(0,Math.min(u.color.g*lt.g,1)),lt.b=Math.max(0,Math.min(u.color.b*lt.b,1)),ht.r=Math.max(0,Math.min(u.color.r*ht.r,1)),ht.g=Math.max(0,Math.min(u.color.g*ht.g,1)),ht.b=Math.max(0,Math.min(u.color.b*ht.b,1)),P=St(ot,at,lt,ht),Z(g,y,v,b,w,C),Ct(g,y,v,b,w,C,0,0,1,0,0,1,P),Z(S,E,x,L,O,_),Ct(S,E,x,L,O,_,1,0,1,1,0,1,P)):(Q(g,y,v,b,x,L,w,C),u.wireframe?xt(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(u.color)):u instanceof THREE.MeshNormalMaterial?(st.r=Ot(c.normalWorld.x),st.g=Ot(c.normalWorld.y),st.b=Ot(c.normalWorld.z),Q(g,y,v,b,x,L,w,C),u.wireframe?xt(st,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Lt(st)):u instanceof THREE.MeshDepthMaterial&&(T=l.near,k=l.far,ot.r=ot.g=ot.b=1-Et(e.positionScreen.z,T,k),at.r=at.g=at.b=1-Et(n.positionScreen.z,T,k),lt.r=lt.g=lt.b=1-Et(s.positionScreen.z,T,k),ht.r=ht.g=ht.b=1-Et(r.positionScreen.z,T,k),P=St(ot,at,lt,ht),Z(g,y,v,b,w,C),Ct(g,y,v,b,w,C,0,0,1,0,0,1,P),Z(S,E,x,L,O,_),Ct(S,E,x,L,O,_,1,0,1,1,0,1,P)))}function Z(e,t,i,n,r,s){W.beginPath(),W.moveTo(e,t),W.lineTo(i,n),W.lineTo(r,s),W.lineTo(e,t),W.closePath()}function Q(e,t,i,n,r,s,o,a){W.beginPath(),W.moveTo(e,t),W.lineTo(i,n),W.lineTo(r,s),W.lineTo(o,a),W.lineTo(e,t),W.closePath()}function xt(e,t,i,r){et!=t&&(W.lineWidth=et=t),tt!=i&&(W.lineCap=tt=i),it!=r&&(W.lineJoin=it=r),n(e.getContextStyle()),W.stroke(),ft.inflate(2*t)}function Lt(e){r(e.getContextStyle()),W.fill()}function wt(e,t,i,n,s,o,a,l,h,c,u,d,p){if(0!=p.image.width){if(1==p.needsUpdate||void 0==ct[p.id]){var f=p.wrapS==THREE.RepeatWrapping,m=p.wrapT==THREE.RepeatWrapping;ct[p.id]=W.createPattern(p.image,f&&m?"repeat":f&&!m?"repeat-x":!f&&m?"repeat-y":"no-repeat"),p.needsUpdate=!1}r(ct[p.id]);var f=p.offset.x/p.repeat.x,m=p.offset.y/p.repeat.y,g=p.image.width*p.repeat.x,y=p.image.height*p.repeat.y,a=(a+f)*g,l=(l+m)*y,i=i-e,n=n-t,s=s-e,o=o-t,h=(h+f)*g-a,c=(c+m)*y-l,u=(u+f)*g-a,d=(d+m)*y-l,f=h*d-u*c;0==f?(void 0===ut[p.id]&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,t=t.getContext("2d"),t.drawImage(p.image,0,0),ut[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data),t=ut[p.id],a=4*(Math.floor(a)+Math.floor(l)*p.image.width),st.setRGB(t[a]/255,t[a+1]/255,t[a+2]/255),Lt(st)):(f=1/f,p=(d*i-c*s)*f,c=(d*n-c*o)*f,i=(h*s-u*i)*f,n=(h*o-u*n)*f,e=e-p*a-i*l,a=t-c*a-n*l,W.save(),W.transform(p,c,i,n,e,a),W.fill(),W.restore())}}function Ct(e,t,i,n,r,s,o,a,l,h,c,u,d){var p,f;p=d.width-1,f=d.height-1,o*=p,a*=f,i-=e,n-=t,r-=e,s-=t,l=l*p-o,h=h*f-a,c=c*p-o,u=u*f-a,f=1/(l*u-c*h),p=(u*i-h*r)*f,h=(u*n-h*s)*f,i=(l*r-c*i)*f,n=(l*s-c*n)*f,e=e-p*o-i*a,t=t-h*o-n*a,W.save(),W.transform(p,h,i,n,e,t),W.clip(),W.drawImage(d,0,0),W.restore()}function St(e,t,i,n){var r=~~(255*e.r),s=~~(255*e.g),e=~~(255*e.b),o=~~(255*t.r),a=~~(255*t.g),t=~~(255*t.b),l=~~(255*i.r),h=~~(255*i.g),i=~~(255*i.b),c=~~(255*n.r),u=~~(255*n.g),n=~~(255*n.b);return z[0]=0>r?0:r>255?255:r,z[1]=0>s?0:s>255?255:s,z[2]=0>e?0:e>255?255:e,z[4]=0>o?0:o>255?255:o,z[5]=0>a?0:a>255?255:a,z[6]=0>t?0:t>255?255:t,z[8]=0>l?0:l>255?255:l,z[9]=0>h?0:h>255?255:h,z[10]=0>i?0:i>255?255:i,z[12]=0>c?0:c>255?255:c,z[13]=0>u?0:u>255?255:u,z[14]=0>n?0:n>255?255:n,G.putImageData(j,0,0),U.drawImage(B,0,0),X}function Et(e,t,i){return e=(e-t)/(i-t),e*e*(3-2*e)}function Ot(e){return e=.5*(e+1),0>e?0:e>1?1:e}function _t(e,t){var i=t.x-e.x,n=t.y-e.y,r=i*i+n*n;0!=r&&(r=1/Math.sqrt(r),i*=r,n*=r,t.x=t.x+i,t.y=t.y+n,e.x=e.x-i,e.y=e.y-n)}var Tt,kt,Pt,At;for(this.autoClear?this.clear():W.setTransform(1,0,0,-1,c,u),H.info.render.vertices=0,H.info.render.faces=0,s=J.projectScene(e,l,this.sortElements),o=s.elements,a=s.lights,(mt=a.length>0)&&h(a),Tt=0,kt=o.length;kt>Tt;Tt++)Pt=o[Tt],At=Pt.material,At=At instanceof THREE.MeshFaceMaterial?Pt.faceMaterial:At,void 0!==At&&At.visible!==!1&&(ft.empty(),Pt instanceof THREE.RenderableParticle?(d=Pt,d.x=d.x*c,d.y=d.y*u,$(d,Pt,At,e)):Pt instanceof THREE.RenderableLine?(d=Pt.v1,p=Pt.v2,d.positionScreen.x=d.positionScreen.x*c,d.positionScreen.y=d.positionScreen.y*u,p.positionScreen.x=p.positionScreen.x*c,p.positionScreen.y=p.positionScreen.y*u,ft.addPoint(d.positionScreen.x,d.positionScreen.y),ft.addPoint(p.positionScreen.x,p.positionScreen.y),dt.intersects(ft)&&q(d,p,Pt,At,e)):Pt instanceof THREE.RenderableFace3?(d=Pt.v1,p=Pt.v2,f=Pt.v3,d.positionScreen.x=d.positionScreen.x*c,d.positionScreen.y=d.positionScreen.y*u,p.positionScreen.x=p.positionScreen.x*c,p.positionScreen.y=p.positionScreen.y*u,f.positionScreen.x=f.positionScreen.x*c,f.positionScreen.y=f.positionScreen.y*u,At.overdraw&&(_t(d.positionScreen,p.positionScreen),_t(p.positionScreen,f.positionScreen),_t(f.positionScreen,d.positionScreen)),ft.add3Points(d.positionScreen.x,d.positionScreen.y,p.positionScreen.x,p.positionScreen.y,f.positionScreen.x,f.positionScreen.y),dt.intersects(ft)&&Y(d,p,f,0,1,2,Pt,At,e)):Pt instanceof THREE.RenderableFace4&&(d=Pt.v1,p=Pt.v2,f=Pt.v3,m=Pt.v4,d.positionScreen.x=d.positionScreen.x*c,d.positionScreen.y=d.positionScreen.y*u,p.positionScreen.x=p.positionScreen.x*c,p.positionScreen.y=p.positionScreen.y*u,f.positionScreen.x=f.positionScreen.x*c,f.positionScreen.y=f.positionScreen.y*u,m.positionScreen.x=m.positionScreen.x*c,m.positionScreen.y=m.positionScreen.y*u,nt.positionScreen.copy(p.positionScreen),rt.positionScreen.copy(m.positionScreen),At.overdraw&&(_t(d.positionScreen,p.positionScreen),_t(p.positionScreen,m.positionScreen),_t(m.positionScreen,d.positionScreen),_t(f.positionScreen,nt.positionScreen),_t(f.positionScreen,rt.positionScreen)),ft.addPoint(d.positionScreen.x,d.positionScreen.y),ft.addPoint(p.positionScreen.x,p.positionScreen.y),ft.addPoint(f.positionScreen.x,f.positionScreen.y),ft.addPoint(m.positionScreen.x,m.positionScreen.y),dt.intersects(ft)&&K(d,p,f,m,nt,rt,Pt,At,e)),pt.addRectangle(ft));W.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function e(e,t,i,n){var r,s,o,a,l,h;for(r=0,s=e.length;s>r;r++)o=e[r],a=o.color,o instanceof THREE.DirectionalLight?(l=o.matrixWorld.getPosition(),h=i.dot(l),0>=h||(h*=o.intensity,n.r=n.r+a.r*h,n.g=n.g+a.g*h,n.b=n.b+a.b*h)):o instanceof THREE.PointLight&&(l=o.matrixWorld.getPosition(),h=i.dot(T.sub(l,t).normalize()),0>=h||(h*=0==o.distance?1:1-Math.min(t.distanceTo(l)/o.distance,1),0!=h&&(h*=o.intensity,n.r=n.r+a.r*h,n.g=n.g+a.g*h,n.b=n.b+a.b*h)))}function t(e){return null==k[e]&&(k[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==A&&k[e].setAttribute("shape-rendering","crispEdges")),k[e]}function i(e){return e=.5*(e+1),0>e?0:e>1?1:e}console.log("THREE.SVGRenderer",THREE.REVISION);var n,r,s,o,a,l,h,c,u,d,p,f,m,g,y,v=this,b=new THREE.Projector,x=document.createElementNS("http://www.w3.org/2000/svg","svg"),L=new THREE.Rectangle,w=new THREE.Rectangle,C=!1,S=new THREE.Color,E=new THREE.Color,O=new THREE.Color,_=new THREE.Color,T=new THREE.Vector3,k=[],P=[],A=1;this.domElement=x,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":A=1;break;case"low":A=0}},this.setSize=function(e,t){o=e,a=t,l=o/2,h=a/2,x.setAttribute("viewBox",-l+" "+-h+" "+o+" "+a),x.setAttribute("width",o),x.setAttribute("height",a),L.set(-l,-h,l,h)},this.clear=function(){for(;x.childNodes.length>0;)x.removeChild(x.childNodes[0])},this.render=function(o,a){var T,k,M,N;if(this.autoClear&&this.clear(),v.info.render.vertices=0,v.info.render.faces=0,n=b.projectScene(o,a,this.sortElements),r=n.elements,s=n.lights,y=g=0,C=s.length>0)for(E.setRGB(0,0,0),O.setRGB(0,0,0),_.setRGB(0,0,0),T=0,k=s.length;k>T;T++)N=s[T],M=N.color,N instanceof THREE.AmbientLight?(E.r=E.r+M.r,E.g=E.g+M.g,E.b=E.b+M.b):N instanceof THREE.DirectionalLight?(O.r=O.r+M.r,O.g=O.g+M.g,O.b=O.b+M.b):N instanceof THREE.PointLight&&(_.r=_.r+M.r,_.g=_.g+M.g,_.b=_.b+M.b);for(T=0,k=r.length;k>T;T++)if(M=r[T],N=M.material,N=N instanceof THREE.MeshFaceMaterial?M.faceMaterial:N,void 0!==N&&N.visible!==!1)if(w.empty(),M instanceof THREE.RenderableParticle)c=M,c.x=c.x*l,c.y=c.y*-h;else if(M instanceof THREE.RenderableLine){if(c=M.v1,u=M.v2,c.positionScreen.x=c.positionScreen.x*l,c.positionScreen.y=c.positionScreen.y*-h,u.positionScreen.x=u.positionScreen.x*l,u.positionScreen.y=u.positionScreen.y*-h,w.addPoint(c.positionScreen.x,c.positionScreen.y),w.addPoint(u.positionScreen.x,u.positionScreen.y),L.intersects(w)){M=c;var R=u,D=y++;null==P[D]&&(P[D]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==A&&P[D].setAttribute("shape-rendering","crispEdges")),m=P[D],m.setAttribute("x1",M.positionScreen.x),m.setAttribute("y1",M.positionScreen.y),m.setAttribute("x2",R.positionScreen.x),m.setAttribute("y2",R.positionScreen.y),N instanceof THREE.LineBasicMaterial&&(m.setAttribute("style","fill: none; stroke: "+N.color.getContextStyle()+"; stroke-width: "+N.linewidth+"; stroke-opacity: "+N.opacity+"; stroke-linecap: "+N.linecap+"; stroke-linejoin: "+N.linejoin),x.appendChild(m))}}else if(M instanceof THREE.RenderableFace3){if(c=M.v1,u=M.v2,d=M.v3,c.positionScreen.x=c.positionScreen.x*l,c.positionScreen.y=c.positionScreen.y*-h,u.positionScreen.x=u.positionScreen.x*l,u.positionScreen.y=u.positionScreen.y*-h,d.positionScreen.x=d.positionScreen.x*l,d.positionScreen.y=d.positionScreen.y*-h,w.addPoint(c.positionScreen.x,c.positionScreen.y),w.addPoint(u.positionScreen.x,u.positionScreen.y),w.addPoint(d.positionScreen.x,d.positionScreen.y),L.intersects(w)){var R=c,D=u,I=d;v.info.render.vertices=v.info.render.vertices+3,v.info.render.faces++,m=t(g++),m.setAttribute("d","M "+R.positionScreen.x+" "+R.positionScreen.y+" L "+D.positionScreen.x+" "+D.positionScreen.y+" L "+I.positionScreen.x+","+I.positionScreen.y+"z"),N instanceof THREE.MeshBasicMaterial?S.copy(N.color):N instanceof THREE.MeshLambertMaterial?C?(S.r=E.r,S.g=E.g,S.b=E.b,e(s,M.centroidWorld,M.normalWorld,S),S.r=Math.max(0,Math.min(N.color.r*S.r,1)),S.g=Math.max(0,Math.min(N.color.g*S.g,1)),S.b=Math.max(0,Math.min(N.color.b*S.b,1))):S.copy(N.color):N instanceof THREE.MeshDepthMaterial?(f=1-N.__2near/(N.__farPlusNear-M.z*N.__farMinusNear),S.setRGB(f,f,f)):N instanceof THREE.MeshNormalMaterial&&S.setRGB(i(M.normalWorld.x),i(M.normalWorld.y),i(M.normalWorld.z)),N.wireframe?m.setAttribute("style","fill: none; stroke: "+S.getContextStyle()+"; stroke-width: "+N.wireframeLinewidth+"; stroke-opacity: "+N.opacity+"; stroke-linecap: "+N.wireframeLinecap+"; stroke-linejoin: "+N.wireframeLinejoin):m.setAttribute("style","fill: "+S.getContextStyle()+"; fill-opacity: "+N.opacity),x.appendChild(m)}}else if(M instanceof THREE.RenderableFace4&&(c=M.v1,u=M.v2,d=M.v3,p=M.v4,c.positionScreen.x=c.positionScreen.x*l,c.positionScreen.y=c.positionScreen.y*-h,u.positionScreen.x=u.positionScreen.x*l,u.positionScreen.y=u.positionScreen.y*-h,d.positionScreen.x=d.positionScreen.x*l,d.positionScreen.y=d.positionScreen.y*-h,p.positionScreen.x=p.positionScreen.x*l,p.positionScreen.y=p.positionScreen.y*-h,w.addPoint(c.positionScreen.x,c.positionScreen.y),w.addPoint(u.positionScreen.x,u.positionScreen.y),w.addPoint(d.positionScreen.x,d.positionScreen.y),w.addPoint(p.positionScreen.x,p.positionScreen.y),L.intersects(w))){var R=c,D=u,I=d,F=p;v.info.render.vertices=v.info.render.vertices+4,v.info.render.faces++,m=t(g++),m.setAttribute("d","M "+R.positionScreen.x+" "+R.positionScreen.y+" L "+D.positionScreen.x+" "+D.positionScreen.y+" L "+I.positionScreen.x+","+I.positionScreen.y+" L "+F.positionScreen.x+","+F.positionScreen.y+"z"),N instanceof THREE.MeshBasicMaterial?S.copy(N.color):N instanceof THREE.MeshLambertMaterial?C?(S.r=E.r,S.g=E.g,S.b=E.b,e(s,M.centroidWorld,M.normalWorld,S),S.r=Math.max(0,Math.min(N.color.r*S.r,1)),S.g=Math.max(0,Math.min(N.color.g*S.g,1)),S.b=Math.max(0,Math.min(N.color.b*S.b,1))):S.copy(N.color):N instanceof THREE.MeshDepthMaterial?(f=1-N.__2near/(N.__farPlusNear-M.z*N.__farMinusNear),S.setRGB(f,f,f)):N instanceof THREE.MeshNormalMaterial&&S.setRGB(i(M.normalWorld.x),i(M.normalWorld.y),i(M.normalWorld.z)),N.wireframe?m.setAttribute("style","fill: none; stroke: "+S.getContextStyle()+"; stroke-width: "+N.wireframeLinewidth+"; stroke-opacity: "+N.opacity+"; stroke-linecap: "+N.wireframeLinecap+"; stroke-linejoin: "+N.wireframeLinejoin):m.setAttribute("style","fill: "+S.getContextStyle()+"; fill-opacity: "+N.opacity),x.appendChild(m)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,i,n,r={};
for(t=0;e.length>t;t++){n=this.clone(e[t]);for(i in n)r[i]=n[i]}return r},clone:function(e){var t,i,n,r={};for(t in e){r[t]={};for(i in e[t])n=e[t][i],r[t][i]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():n instanceof Array?n.slice():n}return r}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var i=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var r in n.attributes){var s=n.attributes[r];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;"v2"===s.type?o=2:"v3"===s.type?o=3:"v4"===s.type?o=4:"c"===s.type&&(o=3),s.size=o,s.array=new Float32Array(i*o),s.buffer=N.createBuffer(),s.buffer.belongsToAttribute=r,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function i(e,t){return!e.material||e.material instanceof THREE.MeshFaceMaterial?t.materialIndex>=0?e.geometry.materials[t.materialIndex]:void 0:e.material}function n(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&void 0!==e.shading&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function r(e){return e.map||e.lightMap||e instanceof THREE.ShaderMaterial?!0:!1}function s(e,t,i){var n,r,s,o,a=e.vertices;o=a.length;var l=e.colors,h=l.length,c=e.__vertexArray,u=e.__colorArray,d=e.__sortArray,p=e.verticesNeedUpdate,f=e.colorsNeedUpdate,m=e.__webglCustomAttributesList;if(i.sortParticles){for(lt.copy(at),lt.multiplySelf(i.matrixWorld),n=0;o>n;n++)r=a[n],ht.copy(r),lt.multiplyVector3(ht),d[n]=[ht.z,n];for(d.sort(function(e,t){return t[0]-e[0]}),n=0;o>n;n++)r=a[d[n][1]],s=3*n,c[s]=r.x,c[s+1]=r.y,c[s+2]=r.z;for(n=0;h>n;n++)s=3*n,r=l[d[n][1]],u[s]=r.r,u[s+1]=r.g,u[s+2]=r.b;if(m)for(l=0,h=m.length;h>l;l++)if(a=m[l],void 0===a.boundTo||"vertices"===a.boundTo)if(s=0,r=a.value.length,1===a.size)for(n=0;r>n;n++)o=d[n][1],a.array[n]=a.value[o];else if(2===a.size)for(n=0;r>n;n++)o=d[n][1],o=a.value[o],a.array[s]=o.x,a.array[s+1]=o.y,s+=2;else if(3===a.size)if("c"===a.type)for(n=0;r>n;n++)o=d[n][1],o=a.value[o],a.array[s]=o.r,a.array[s+1]=o.g,a.array[s+2]=o.b,s+=3;else for(n=0;r>n;n++)o=d[n][1],o=a.value[o],a.array[s]=o.x,a.array[s+1]=o.y,a.array[s+2]=o.z,s+=3;else if(4===a.size)for(n=0;r>n;n++)o=d[n][1],o=a.value[o],a.array[s]=o.x,a.array[s+1]=o.y,a.array[s+2]=o.z,a.array[s+3]=o.w,s+=4}else{if(p)for(n=0;o>n;n++)r=a[n],s=3*n,c[s]=r.x,c[s+1]=r.y,c[s+2]=r.z;if(f)for(n=0;h>n;n++)r=l[n],s=3*n,u[s]=r.r,u[s+1]=r.g,u[s+2]=r.b;if(m)for(l=0,h=m.length;h>l;l++)if(a=m[l],a.needsUpdate&&(void 0===a.boundTo||"vertices"===a.boundTo))if(r=a.value.length,s=0,1===a.size)for(n=0;r>n;n++)a.array[n]=a.value[n];else if(2===a.size)for(n=0;r>n;n++)o=a.value[n],a.array[s]=o.x,a.array[s+1]=o.y,s+=2;else if(3===a.size)if("c"===a.type)for(n=0;r>n;n++)o=a.value[n],a.array[s]=o.r,a.array[s+1]=o.g,a.array[s+2]=o.b,s+=3;else for(n=0;r>n;n++)o=a.value[n],a.array[s]=o.x,a.array[s+1]=o.y,a.array[s+2]=o.z,s+=3;else if(4===a.size)for(n=0;r>n;n++)o=a.value[n],a.array[s]=o.x,a.array[s+1]=o.y,a.array[s+2]=o.z,a.array[s+3]=o.w,s+=4}if((p||i.sortParticles)&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,c,t)),(f||i.sortParticles)&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,u,t)),m)for(l=0,h=m.length;h>l;l++)a=m[l],(a.needsUpdate||i.sortParticles)&&(N.bindBuffer(N.ARRAY_BUFFER,a.buffer),N.bufferData(N.ARRAY_BUFFER,a.array,t))}function o(e,t){return t.z-e.z}function a(e,t,i){if(e.length)for(var n=0,r=e.length;r>n;n++)j=I=null,B=G=U=X=q=$=H=-1,ut=!0,e[n].render(t,i,rt,st),j=I=null,B=G=U=X=q=$=H=-1,ut=!0}function l(e,t,i,n,r,s,o,a){var l,h,c,u;t?(h=e.length-1,u=t=-1):(h=0,t=e.length,u=1);for(var d=h;d!==t;d+=u)if(l=e[d],l.render){if(h=l.object,c=l.buffer,a)l=a;else{if(l=l[i],!l)continue;o&&R.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),R.setDepthTest(l.depthTest),R.setDepthWrite(l.depthWrite),y(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}R.setObjectFaces(h),c instanceof THREE.BufferGeometry?R.renderBufferDirect(n,r,s,l,c,h):R.renderBuffer(n,r,s,l,c,h)}}function h(e,t,i,n,r,s,o){for(var a,l,h=0,c=e.length;c>h;h++)if(a=e[h],l=a.object,l.visible){if(o)a=o;else{if(a=a[t],!a)continue;s&&R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),R.setDepthTest(a.depthTest),R.setDepthWrite(a.depthWrite),y(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}R.renderImmediateObject(i,n,r,a,l)}}function c(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function u(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function d(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function p(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function f(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function m(e,t,i,n,r){if((!n.program||n.needsUpdate)&&(R.initMaterial(n,t,i,r),n.needsUpdate=!1),n.morphTargets&&!r.__webglMorphTargetInfluences){r.__webglMorphTargetInfluences=new Float32Array(R.maxMorphTargets);for(var s=0,o=R.maxMorphTargets;o>s;s++)r.__webglMorphTargetInfluences[s]=0}var a=!1,s=n.program,o=s.uniforms,l=n.uniforms;if(s!==I&&(N.useProgram(s),I=s,a=!0),n.id!==B&&(B=n.id,a=!0),(a||e!==j)&&(N.uniformMatrix4fv(o.projectionMatrix,!1,e._projectionMatrixArray),e!==j&&(j=e)),a){if(i&&n.fog&&(l.fogColor.value=i.color,i instanceof THREE.Fog?(l.fogNear.value=i.near,l.fogFar.value=i.far):i instanceof THREE.FogExp2&&(l.fogDensity.value=i.density)),n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n.lights){if(ut){for(var h,c,u,d,p=0,f=0,m=0,g=dt,y=g.directional.colors,v=g.directional.positions,x=g.point.colors,L=g.point.positions,S=g.point.distances,E=g.spot.colors,O=g.spot.positions,_=g.spot.distances,T=g.spot.directions,k=g.spot.angles,P=g.spot.exponents,A=0,M=0,D=0,F=d=0,i=F=0,a=t.length;a>i;i++)h=t[i],h.onlyShadow||(c=h.color,u=h.intensity,d=h.distance,h instanceof THREE.AmbientLight?R.gammaInput?(p+=c.r*c.r,f+=c.g*c.g,m+=c.b*c.b):(p+=c.r,f+=c.g,m+=c.b):h instanceof THREE.DirectionalLight?(d=3*A,R.gammaInput?(y[d]=c.r*c.r*u*u,y[d+1]=c.g*c.g*u*u,y[d+2]=c.b*c.b*u*u):(y[d]=c.r*u,y[d+1]=c.g*u,y[d+2]=c.b*u),ct.copy(h.matrixWorld.getPosition()),ct.subSelf(h.target.matrixWorld.getPosition()),ct.normalize(),v[d]=ct.x,v[d+1]=ct.y,v[d+2]=ct.z,A+=1):h instanceof THREE.PointLight?(F=3*M,R.gammaInput?(x[F]=c.r*c.r*u*u,x[F+1]=c.g*c.g*u*u,x[F+2]=c.b*c.b*u*u):(x[F]=c.r*u,x[F+1]=c.g*u,x[F+2]=c.b*u),c=h.matrixWorld.getPosition(),L[F]=c.x,L[F+1]=c.y,L[F+2]=c.z,S[M]=d,M+=1):h instanceof THREE.SpotLight&&(F=3*D,R.gammaInput?(E[F]=c.r*c.r*u*u,E[F+1]=c.g*c.g*u*u,E[F+2]=c.b*c.b*u*u):(E[F]=c.r*u,E[F+1]=c.g*u,E[F+2]=c.b*u),c=h.matrixWorld.getPosition(),O[F]=c.x,O[F+1]=c.y,O[F+2]=c.z,_[D]=d,ct.copy(c),ct.subSelf(h.target.matrixWorld.getPosition()),ct.normalize(),T[F]=ct.x,T[F+1]=ct.y,T[F+2]=ct.z,k[D]=Math.cos(h.angle),P[D]=h.exponent,D+=1));for(i=3*A,a=y.length;a>i;i++)y[i]=0;for(i=3*M,a=x.length;a>i;i++)x[i]=0;for(i=3*D,a=E.length;a>i;i++)E[i]=0;g.directional.length=A,g.point.length=M,g.spot.length=D,g.ambient[0]=p,g.ambient[1]=f,g.ambient[2]=m,ut=!1}i=dt,l.ambientLightColor.value=i.ambient,l.directionalLightColor.value=i.directional.colors,l.directionalLightDirection.value=i.directional.positions,l.pointLightColor.value=i.point.colors,l.pointLightPosition.value=i.point.positions,l.pointLightDistance.value=i.point.distances,l.spotLightColor.value=i.spot.colors,l.spotLightPosition.value=i.spot.positions,l.spotLightDistance.value=i.spot.distances,l.spotLightDirection.value=i.spot.directions,l.spotLightAngle.value=i.spot.angles,l.spotLightExponent.value=i.spot.exponents}if((n instanceof THREE.MeshBasicMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.MeshPhongMaterial)&&(l.opacity.value=n.opacity,R.gammaInput?l.diffuse.value.copyGammaToLinear(n.color):l.diffuse.value=n.color,(l.map.texture=n.map)&&l.offsetRepeat.value.set(n.map.offset.x,n.map.offset.y,n.map.repeat.x,n.map.repeat.y),l.lightMap.texture=n.lightMap,l.envMap.texture=n.envMap,l.flipEnvMap.value=n.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,l.reflectivity.value=n.reflectivity,l.refractionRatio.value=n.refractionRatio,l.combine.value=n.combine,l.useRefract.value=n.envMap&&n.envMap.mapping instanceof THREE.CubeRefractionMapping),n instanceof THREE.LineBasicMaterial?(l.diffuse.value=n.color,l.opacity.value=n.opacity):n instanceof THREE.ParticleBasicMaterial?(l.psColor.value=n.color,l.opacity.value=n.opacity,l.size.value=n.size,l.scale.value=C.height/2,l.map.texture=n.map):n instanceof THREE.MeshPhongMaterial?(l.shininess.value=n.shininess,R.gammaInput?(l.ambient.value.copyGammaToLinear(n.ambient),l.emissive.value.copyGammaToLinear(n.emissive),l.specular.value.copyGammaToLinear(n.specular)):(l.ambient.value=n.ambient,l.emissive.value=n.emissive,l.specular.value=n.specular),n.wrapAround&&l.wrapRGB.value.copy(n.wrapRGB)):n instanceof THREE.MeshLambertMaterial?(R.gammaInput?(l.ambient.value.copyGammaToLinear(n.ambient),l.emissive.value.copyGammaToLinear(n.emissive)):(l.ambient.value=n.ambient,l.emissive.value=n.emissive),n.wrapAround&&l.wrapRGB.value.copy(n.wrapRGB)):n instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=n.opacity):n instanceof THREE.MeshNormalMaterial&&(l.opacity.value=n.opacity),r.receiveShadow&&!n._shadowPass&&l.shadowMatrix)for(a=i=0,h=t.length;h>a;a++)p=t[a],p.castShadow&&(p instanceof THREE.SpotLight||p instanceof THREE.DirectionalLight&&!p.shadowCascade)&&(l.shadowMap.texture[i]=p.shadowMap,l.shadowMapSize.value[i]=p.shadowMapSize,l.shadowMatrix.value[i]=p.shadowMatrix,l.shadowDarkness.value[i]=p.shadowDarkness,l.shadowBias.value[i]=p.shadowBias,i++);for(t=n.uniformsList,l=0,i=t.length;i>l;l++)if(p=s.uniforms[t[l][1]])switch(a=t[l][0],f=a.type,h=a.value,f){case"i":N.uniform1i(p,h);break;case"f":N.uniform1f(p,h);break;case"v2":N.uniform2f(p,h.x,h.y);break;case"v3":N.uniform3f(p,h.x,h.y,h.z);break;case"v4":N.uniform4f(p,h.x,h.y,h.z,h.w);break;case"c":N.uniform3f(p,h.r,h.g,h.b);break;case"fv1":N.uniform1fv(p,h);break;case"fv":N.uniform3fv(p,h);break;case"v2v":for(a._array||(a._array=new Float32Array(2*h.length)),f=0,m=h.length;m>f;f++)g=2*f,a._array[g]=h[f].x,a._array[g+1]=h[f].y;N.uniform2fv(p,a._array);break;case"v3v":for(a._array||(a._array=new Float32Array(3*h.length)),f=0,m=h.length;m>f;f++)g=3*f,a._array[g]=h[f].x,a._array[g+1]=h[f].y,a._array[g+2]=h[f].z;N.uniform3fv(p,a._array);break;case"v4v":for(a._array||(a._array=new Float32Array(4*h.length)),f=0,m=h.length;m>f;f++)g=4*f,a._array[g]=h[f].x,a._array[g+1]=h[f].y,a._array[g+2]=h[f].z,a._array[g+3]=h[f].w;N.uniform4fv(p,a._array);break;case"m4":a._array||(a._array=new Float32Array(16)),h.flattenToArray(a._array),N.uniformMatrix4fv(p,!1,a._array);break;case"m4v":for(a._array||(a._array=new Float32Array(16*h.length)),f=0,m=h.length;m>f;f++)h[f].flattenToArrayOffset(a._array,16*f);N.uniformMatrix4fv(p,!1,a._array);break;case"t":if(N.uniform1i(p,h),p=a.texture,!p)continue;if(p.image instanceof Array&&6===p.image.length){if(a=p,6===a.image.length)if(a.needsUpdate){for(a.image.__webglTextureCube||(a.image.__webglTextureCube=N.createTexture()),N.activeTexture(N.TEXTURE0+h),N.bindTexture(N.TEXTURE_CUBE_MAP,a.image.__webglTextureCube),h=[],p=0;6>p;p++)f=h,m=p,R.autoScaleCubemaps?(g=a.image[p],v=ft,v>=g.width&&v>=g.height||(x=Math.max(g.width,g.height),y=Math.floor(g.width*v/x),v=Math.floor(g.height*v/x),x=document.createElement("canvas"),x.width=y,x.height=v,x.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,y,v),g=x)):g=a.image[p],f[m]=g;for(p=h[0],f=0===(p.width&p.width-1)&&0===(p.height&p.height-1),m=w(a.format),g=w(a.type),b(N.TEXTURE_CUBE_MAP,a,f),p=0;6>p;p++)N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,m,m,g,h[p]);a.generateMipmaps&&f&&N.generateMipmap(N.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else N.activeTexture(N.TEXTURE0+h),N.bindTexture(N.TEXTURE_CUBE_MAP,a.image.__webglTextureCube)}else p instanceof THREE.WebGLRenderTargetCube?(a=p,N.activeTexture(N.TEXTURE0+h),N.bindTexture(N.TEXTURE_CUBE_MAP,a.__webglTexture)):R.setTexture(p,h);break;case"tv":if(!a._array)for(a._array=[],f=0,m=a.texture.length;m>f;f++)a._array[f]=h+f;for(N.uniform1iv(p,a._array),f=0,m=a.texture.length;m>f;f++)(p=a.texture[f])&&R.setTexture(p,a._array[f])}(n instanceof THREE.ShaderMaterial||n instanceof THREE.MeshPhongMaterial||n.envMap)&&null!==o.cameraPosition&&(t=e.matrixWorld.getPosition(),N.uniform3f(o.cameraPosition,t.x,t.y,t.z)),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.ShaderMaterial||n.skinning)&&null!==o.viewMatrix&&N.uniformMatrix4fv(o.viewMatrix,!1,e._viewMatrixArray),n.skinning&&N.uniformMatrix4fv(o.boneGlobalMatrices,!1,r.boneMatrices)}return N.uniformMatrix4fv(o.modelViewMatrix,!1,r._modelViewMatrix.elements),o.normalMatrix&&N.uniformMatrix3fv(o.normalMatrix,!1,r._normalMatrix.elements),null!==o.objectMatrix&&N.uniformMatrix4fv(o.objectMatrix,!1,r.matrixWorld.elements),s}function g(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function y(e,t,i){Y!==e&&(e?N.enable(N.POLYGON_OFFSET_FILL):N.disable(N.POLYGON_OFFSET_FILL),Y=e),!e||K===t&&Z===i||(N.polygonOffset(t,i),K=t,Z=i)}function v(e,t){var i;return"fragment"===e?i=N.createShader(N.FRAGMENT_SHADER):"vertex"===e&&(i=N.createShader(N.VERTEX_SHADER)),N.shaderSource(i,t),N.compileShader(i),N.getShaderParameter(i,N.COMPILE_STATUS)?i:(console.error(N.getShaderInfoLog(i)),console.error(t),null)}function b(e,t,i){i?(N.texParameteri(e,N.TEXTURE_WRAP_S,w(t.wrapS)),N.texParameteri(e,N.TEXTURE_WRAP_T,w(t.wrapT)),N.texParameteri(e,N.TEXTURE_MAG_FILTER,w(t.magFilter)),N.texParameteri(e,N.TEXTURE_MIN_FILTER,w(t.minFilter))):(N.texParameteri(e,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(e,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(e,N.TEXTURE_MAG_FILTER,L(t.magFilter)),N.texParameteri(e,N.TEXTURE_MIN_FILTER,L(t.minFilter)))}function x(e,t){N.bindRenderbuffer(N.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(N.renderbufferStorage(N.RENDERBUFFER,N.DEPTH_COMPONENT16,t.width,t.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.DEPTH_ATTACHMENT,N.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(N.renderbufferStorage(N.RENDERBUFFER,N.DEPTH_STENCIL,t.width,t.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.DEPTH_STENCIL_ATTACHMENT,N.RENDERBUFFER,e)):N.renderbufferStorage(N.RENDERBUFFER,N.RGBA4,t.width,t.height)}function L(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return N.NEAREST;default:return N.LINEAR}}function w(e){switch(e){case THREE.RepeatWrapping:return N.REPEAT;case THREE.ClampToEdgeWrapping:return N.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return N.MIRRORED_REPEAT;case THREE.NearestFilter:return N.NEAREST;case THREE.NearestMipMapNearestFilter:return N.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return N.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return N.LINEAR;case THREE.LinearMipMapNearestFilter:return N.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return N.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return N.BYTE;case THREE.UnsignedByteType:return N.UNSIGNED_BYTE;case THREE.ShortType:return N.SHORT;case THREE.UnsignedShortType:return N.UNSIGNED_SHORT;case THREE.IntType:return N.INT;case THREE.UnsignedIntType:return N.UNSIGNED_INT;case THREE.FloatType:return N.FLOAT;case THREE.AlphaFormat:return N.ALPHA;case THREE.RGBFormat:return N.RGB;case THREE.RGBAFormat:return N.RGBA;case THREE.LuminanceFormat:return N.LUMINANCE;case THREE.LuminanceAlphaFormat:return N.LUMINANCE_ALPHA;case THREE.AddEquation:return N.FUNC_ADD;case THREE.SubtractEquation:return N.FUNC_SUBTRACT;case THREE.ReverseSubtractEquation:return N.FUNC_REVERSE_SUBTRACT;case THREE.ZeroFactor:return N.ZERO;case THREE.OneFactor:return N.ONE;case THREE.SrcColorFactor:return N.SRC_COLOR;case THREE.OneMinusSrcColorFactor:return N.ONE_MINUS_SRC_COLOR;case THREE.SrcAlphaFactor:return N.SRC_ALPHA;case THREE.OneMinusSrcAlphaFactor:return N.ONE_MINUS_SRC_ALPHA;case THREE.DstAlphaFactor:return N.DST_ALPHA;case THREE.OneMinusDstAlphaFactor:return N.ONE_MINUS_DST_ALPHA;case THREE.DstColorFactor:return N.DST_COLOR;case THREE.OneMinusDstColorFactor:return N.ONE_MINUS_DST_COLOR;case THREE.SrcAlphaSaturateFactor:return N.SRC_ALPHA_SATURATE}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);var e=e||{},C=void 0!==e.canvas?e.canvas:document.createElement("canvas"),S=void 0!==e.precision?e.precision:"highp",E=void 0!==e.alpha?e.alpha:!0,O=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,_=void 0!==e.antialias?e.antialias:!1,T=void 0!==e.stencil?e.stencil:!0,k=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,P=void 0!==e.clearColor?new THREE.Color(e.clearColor):new THREE.Color(0),A=void 0!==e.clearAlpha?e.clearAlpha:0,M=void 0!==e.maxLights?e.maxLights:4;this.domElement=C,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var N,R=this,D=[],I=null,F=null,B=-1,G=null,j=null,z=0,X=-1,U=-1,H=-1,J=-1,V=-1,W=-1,$=-1,q=-1,Y=null,K=null,Z=null,Q=null,et=0,tt=0,it=0,nt=0,rt=0,st=0,ot=new THREE.Frustum,at=new THREE.Matrix4,lt=new THREE.Matrix4,ht=new THREE.Vector4,ct=new THREE.Vector3,ut=!0,dt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};N=function(){var e;try{if(!(e=C.getContext("experimental-webgl",{alpha:E,premultipliedAlpha:O,antialias:_,stencil:T,preserveDrawingBuffer:k})))throw"Error creating WebGL context."}catch(t){console.error(t)}return e.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported."),e}(),N.clearColor(0,0,0,1),N.clearDepth(1),N.clearStencil(0),N.enable(N.DEPTH_TEST),N.depthFunc(N.LEQUAL),N.frontFace(N.CCW),N.cullFace(N.BACK),N.enable(N.CULL_FACE),N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA),N.clearColor(P.r,P.g,P.b,A),this.context=N;var pt=N.getParameter(N.MAX_VERTEX_TEXTURE_IMAGE_UNITS);N.getParameter(N.MAX_TEXTURE_SIZE);var ft=N.getParameter(N.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return N},this.supportsVertexTextures=function(){return pt>0},this.setSize=function(e,t){C.width=e,C.height=t,this.setViewport(0,0,C.width,C.height)},this.setViewport=function(e,t,i,n){et=e,tt=t,it=i,nt=n,N.viewport(et,tt,it,nt)},this.setScissor=function(e,t,i,n){N.scissor(e,t,i,n)},this.enableScissorTest=function(e){e?N.enable(N.SCISSOR_TEST):N.disable(N.SCISSOR_TEST)},this.setClearColorHex=function(e,t){P.setHex(e),A=t,N.clearColor(P.r,P.g,P.b,A)},this.setClearColor=function(e,t){P.copy(e),A=t,N.clearColor(P.r,P.g,P.b,A)},this.getClearColor=function(){return P},this.getClearAlpha=function(){return A},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=N.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=N.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=N.STENCIL_BUFFER_BIT),N.clear(n)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.deallocateObject=function(e){if(e.__webglInit)if(e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._objectMatrixArray,e instanceof THREE.Mesh)for(var t in e.geometry.geometryGroups){var i=e.geometry.geometryGroups[t];N.deleteBuffer(i.__webglVertexBuffer),N.deleteBuffer(i.__webglNormalBuffer),N.deleteBuffer(i.__webglTangentBuffer),N.deleteBuffer(i.__webglColorBuffer),N.deleteBuffer(i.__webglUVBuffer),N.deleteBuffer(i.__webglUV2Buffer),N.deleteBuffer(i.__webglSkinVertexABuffer),N.deleteBuffer(i.__webglSkinVertexBBuffer),N.deleteBuffer(i.__webglSkinIndicesBuffer),N.deleteBuffer(i.__webglSkinWeightsBuffer),N.deleteBuffer(i.__webglFaceBuffer),N.deleteBuffer(i.__webglLineBuffer);var n=void 0,r=void 0;if(i.numMorphTargets)for(n=0,r=i.numMorphTargets;r>n;n++)N.deleteBuffer(i.__webglMorphTargetsBuffers[n]);if(i.numMorphNormals)for(n=0,r=i.numMorphNormals;r>n;n++)N.deleteBuffer(i.__webglMorphNormalsBuffers[n]);if(i.__webglCustomAttributesList){n=void 0;for(n in i.__webglCustomAttributesList)N.deleteBuffer(i.__webglCustomAttributesList[n].buffer)}R.info.memory.geometries--}else e instanceof THREE.Ribbon?(e=e.geometry,N.deleteBuffer(e.__webglVertexBuffer),N.deleteBuffer(e.__webglColorBuffer),R.info.memory.geometries--):e instanceof THREE.Line?(e=e.geometry,N.deleteBuffer(e.__webglVertexBuffer),N.deleteBuffer(e.__webglColorBuffer),R.info.memory.geometries--):e instanceof THREE.ParticleSystem&&(e=e.geometry,N.deleteBuffer(e.__webglVertexBuffer),N.deleteBuffer(e.__webglColorBuffer),R.info.memory.geometries--)},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,N.deleteTexture(e.__webglTexture),R.info.memory.textures--)},this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture)if(N.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)N.deleteFramebuffer(e.__webglFramebuffer[t]),N.deleteRenderbuffer(e.__webglRenderbuffer[t]);else N.deleteFramebuffer(e.__webglFramebuffer),N.deleteRenderbuffer(e.__webglRenderbuffer)},this.updateShadowMap=function(e,t){I=null,B=G=q=$=H=-1,ut=!0,U=X=-1,this.shadowMapPlugin.update(e,t)
},this.renderBufferImmediate=function(e,t,i){if(e.__webglVertexBuffer||(e.__webglVertexBuffer=N.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=N.createBuffer()),e.hasPos&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,e.positionArray,N.DYNAMIC_DRAW),N.enableVertexAttribArray(t.attributes.position),N.vertexAttribPointer(t.attributes.position,3,N.FLOAT,!1,0,0)),e.hasNormal){if(N.bindBuffer(N.ARRAY_BUFFER,e.__webglNormalBuffer),i===THREE.FlatShading){var n,r,s,o,a,l,h,c,u,d,p=3*e.count;for(d=0;p>d;d+=9)i=e.normalArray,n=i[d],r=i[d+1],s=i[d+2],o=i[d+3],l=i[d+4],c=i[d+5],a=i[d+6],h=i[d+7],u=i[d+8],n=(n+o+a)/3,r=(r+l+h)/3,s=(s+c+u)/3,i[d]=n,i[d+1]=r,i[d+2]=s,i[d+3]=n,i[d+4]=r,i[d+5]=s,i[d+6]=n,i[d+7]=r,i[d+8]=s}N.bufferData(N.ARRAY_BUFFER,e.normalArray,N.DYNAMIC_DRAW),N.enableVertexAttribArray(t.attributes.normal),N.vertexAttribPointer(t.attributes.normal,3,N.FLOAT,!1,0,0)}N.drawArrays(N.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,s){if(n.visible!==!1&&(i=m(e,t,i,n,s),e=i.attributes,t=!1,n=16777215*r.id+2*i.id+(n.wireframe?1:0),n!==G&&(G=n,t=!0),s instanceof THREE.Mesh))for(s=r.offsets,n=0,i=s.length;i>n;++n)t&&(N.bindBuffer(N.ARRAY_BUFFER,r.vertexPositionBuffer),N.vertexAttribPointer(e.position,r.vertexPositionBuffer.itemSize,N.FLOAT,!1,0,12*s[n].index),e.normal>=0&&r.vertexNormalBuffer&&(N.bindBuffer(N.ARRAY_BUFFER,r.vertexNormalBuffer),N.vertexAttribPointer(e.normal,r.vertexNormalBuffer.itemSize,N.FLOAT,!1,0,12*s[n].index)),e.uv>=0&&r.vertexUvBuffer&&(r.vertexUvBuffer?(N.bindBuffer(N.ARRAY_BUFFER,r.vertexUvBuffer),N.vertexAttribPointer(e.uv,r.vertexUvBuffer.itemSize,N.FLOAT,!1,0,8*s[n].index),N.enableVertexAttribArray(e.uv)):N.disableVertexAttribArray(e.uv)),e.color>=0&&r.vertexColorBuffer&&(N.bindBuffer(N.ARRAY_BUFFER,r.vertexColorBuffer),N.vertexAttribPointer(e.color,r.vertexColorBuffer.itemSize,N.FLOAT,!1,0,16*s[n].index)),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,r.vertexIndexBuffer)),N.drawElements(N.TRIANGLES,s[n].count,N.UNSIGNED_SHORT,2*s[n].start),R.info.render.calls++,R.info.render.vertices=R.info.render.vertices+s[n].count,R.info.render.faces=R.info.render.faces+s[n].count/3},this.renderBuffer=function(e,t,i,n,r,s){if(n.visible!==!1){var o,a,i=m(e,t,i,n,s),t=i.attributes,e=!1,i=16777215*r.id+2*i.id+(n.wireframe?1:0);if(i!==G&&(G=i,e=!0),!n.morphTargets&&t.position>=0)e&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglVertexBuffer),N.vertexAttribPointer(t.position,3,N.FLOAT,!1,0,0));else if(s.morphTargetBase){if(i=n.program.attributes,-1!==s.morphTargetBase?(N.bindBuffer(N.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[s.morphTargetBase]),N.vertexAttribPointer(i.position,3,N.FLOAT,!1,0,0)):i.position>=0&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglVertexBuffer),N.vertexAttribPointer(i.position,3,N.FLOAT,!1,0,0)),s.morphTargetForcedOrder.length){o=0;var l=s.morphTargetForcedOrder;for(a=s.morphTargetInfluences;n.numSupportedMorphTargets>o&&l.length>o;)N.bindBuffer(N.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[l[o]]),N.vertexAttribPointer(i["morphTarget"+o],3,N.FLOAT,!1,0,0),n.morphNormals&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglMorphNormalsBuffers[l[o]]),N.vertexAttribPointer(i["morphNormal"+o],3,N.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[o]=a[l[o]],o++}else{var l=[],h=-1,c=0;a=s.morphTargetInfluences;var u,d=a.length;for(o=0,-1!==s.morphTargetBase&&(l[s.morphTargetBase]=!0);n.numSupportedMorphTargets>o;){for(u=0;d>u;u++)!l[u]&&a[u]>h&&(c=u,h=a[c]);N.bindBuffer(N.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[c]),N.vertexAttribPointer(i["morphTarget"+o],3,N.FLOAT,!1,0,0),n.morphNormals&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglMorphNormalsBuffers[c]),N.vertexAttribPointer(i["morphNormal"+o],3,N.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[o]=h,l[c]=1,h=-1,o++}}null!==n.program.uniforms.morphTargetInfluences&&N.uniform1fv(n.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(e){if(r.__webglCustomAttributesList)for(o=0,a=r.__webglCustomAttributesList.length;a>o;o++)i=r.__webglCustomAttributesList[o],t[i.buffer.belongsToAttribute]>=0&&(N.bindBuffer(N.ARRAY_BUFFER,i.buffer),N.vertexAttribPointer(t[i.buffer.belongsToAttribute],i.size,N.FLOAT,!1,0,0));t.color>=0&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglColorBuffer),N.vertexAttribPointer(t.color,3,N.FLOAT,!1,0,0)),t.normal>=0&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglNormalBuffer),N.vertexAttribPointer(t.normal,3,N.FLOAT,!1,0,0)),t.tangent>=0&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglTangentBuffer),N.vertexAttribPointer(t.tangent,4,N.FLOAT,!1,0,0)),t.uv>=0&&(r.__webglUVBuffer?(N.bindBuffer(N.ARRAY_BUFFER,r.__webglUVBuffer),N.vertexAttribPointer(t.uv,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray(t.uv)):N.disableVertexAttribArray(t.uv)),t.uv2>=0&&(r.__webglUV2Buffer?(N.bindBuffer(N.ARRAY_BUFFER,r.__webglUV2Buffer),N.vertexAttribPointer(t.uv2,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray(t.uv2)):N.disableVertexAttribArray(t.uv2)),n.skinning&&t.skinVertexA>=0&&t.skinVertexB>=0&&t.skinIndex>=0&&t.skinWeight>=0&&(N.bindBuffer(N.ARRAY_BUFFER,r.__webglSkinVertexABuffer),N.vertexAttribPointer(t.skinVertexA,4,N.FLOAT,!1,0,0),N.bindBuffer(N.ARRAY_BUFFER,r.__webglSkinVertexBBuffer),N.vertexAttribPointer(t.skinVertexB,4,N.FLOAT,!1,0,0),N.bindBuffer(N.ARRAY_BUFFER,r.__webglSkinIndicesBuffer),N.vertexAttribPointer(t.skinIndex,4,N.FLOAT,!1,0,0),N.bindBuffer(N.ARRAY_BUFFER,r.__webglSkinWeightsBuffer),N.vertexAttribPointer(t.skinWeight,4,N.FLOAT,!1,0,0))}s instanceof THREE.Mesh?(n.wireframe?(n=n.wireframeLinewidth,n!==Q&&(N.lineWidth(n),Q=n),e&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),N.drawElements(N.LINES,r.__webglLineCount,N.UNSIGNED_SHORT,0)):(e&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),N.drawElements(N.TRIANGLES,r.__webglFaceCount,N.UNSIGNED_SHORT,0)),R.info.render.calls++,R.info.render.vertices=R.info.render.vertices+r.__webglFaceCount,R.info.render.faces=R.info.render.faces+r.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?N.LINE_STRIP:N.LINES,n=n.linewidth,n!==Q&&(N.lineWidth(n),Q=n),N.drawArrays(s,0,r.__webglLineCount),R.info.render.calls++):s instanceof THREE.ParticleSystem?(N.drawArrays(N.POINTS,0,r.__webglParticleCount),R.info.render.calls++,R.info.render.points=R.info.render.points+r.__webglParticleCount):s instanceof THREE.Ribbon&&(N.drawArrays(N.TRIANGLE_STRIP,0,r.__webglVertexCount),R.info.render.calls++)}},this.render=function(e,t,i,n){var r,s,c,u,d=e.__lights,p=e.fog;for(B=-1,ut=!0,void 0===t.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(t)),this.autoUpdateScene&&e.updateMatrixWorld(),t._viewMatrixArray||(t._viewMatrixArray=new Float32Array(16)),t._projectionMatrixArray||(t._projectionMatrixArray=new Float32Array(16)),t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(t._viewMatrixArray),t.projectionMatrix.flattenToArray(t._projectionMatrixArray),at.multiply(t.projectionMatrix,t.matrixWorldInverse),ot.setFromMatrix(at),this.autoUpdateObjects&&this.initWebGLObjects(e),a(this.renderPluginsPre,e,t),R.info.render.calls=0,R.info.render.vertices=0,R.info.render.faces=0,R.info.render.points=0,this.setRenderTarget(i),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects,n=0,r=u.length;r>n;n++)if(s=u[n],c=s.object,s.render=!1,c.visible&&(!(c instanceof THREE.Mesh||c instanceof THREE.ParticleSystem)||!c.frustumCulled||ot.contains(c))){g(c,t);var f=s,m=f.object,v=f.buffer,b=void 0,b=b=void 0,b=m.material;b instanceof THREE.MeshFaceMaterial?(b=v.materialIndex,b>=0&&(b=m.geometry.materials[b],b.transparent?(f.transparent=b,f.opaque=null):(f.opaque=b,f.transparent=null))):b&&(b.transparent?(f.transparent=b,f.opaque=null):(f.opaque=b,f.transparent=null)),s.render=!0,this.sortObjects&&(c.renderDepth?s.z=c.renderDepth:(ht.copy(c.matrixWorld.getPosition()),at.multiplyVector3(ht),s.z=ht.z))}for(this.sortObjects&&u.sort(o),u=e.__webglObjectsImmediate,n=0,r=u.length;r>n;n++)s=u[n],c=s.object,c.visible&&(g(c,t),c=s.object.material,c.transparent?(s.transparent=c,s.opaque=null):(s.opaque=c,s.transparent=null));e.overrideMaterial?(n=e.overrideMaterial,this.setBlending(n.blending,n.blendEquation,n.blendSrc,n.blendDst),this.setDepthTest(n.depthTest),this.setDepthWrite(n.depthWrite),y(n.polygonOffset,n.polygonOffsetFactor,n.polygonOffsetUnits),l(e.__webglObjects,!1,"",t,d,p,!0,n),h(e.__webglObjectsImmediate,"",t,d,p,!1,n)):(this.setBlending(THREE.NormalBlending),l(e.__webglObjects,!0,"opaque",t,d,p,!1),h(e.__webglObjectsImmediate,"opaque",t,d,p,!1),l(e.__webglObjects,!1,"transparent",t,d,p,!0),h(e.__webglObjectsImmediate,"transparent",t,d,p,!0)),a(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&(i instanceof THREE.WebGLRenderTargetCube?(N.bindTexture(N.TEXTURE_CUBE_MAP,i.__webglTexture),N.generateMipmap(N.TEXTURE_CUBE_MAP),N.bindTexture(N.TEXTURE_CUBE_MAP,null)):(N.bindTexture(N.TEXTURE_2D,i.__webglTexture),N.generateMipmap(N.TEXTURE_2D),N.bindTexture(N.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,i,n,r){var s=m(e,t,i,n,r);G=-1,R.setObjectFaces(r),r.immediateRenderCallback?r.immediateRenderCallback(s,N,ot):r.render(function(e){R.renderBufferImmediate(e,s,n.shading)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;){var o=e.__objectsAdded[0],a=e,l=void 0,h=void 0,m=void 0;if(!o.__webglInit)if(o.__webglInit=!0,o._modelViewMatrix=new THREE.Matrix4,o._normalMatrix=new THREE.Matrix3,o instanceof THREE.Mesh){if(h=o.geometry,h instanceof THREE.Geometry){if(void 0===h.geometryGroups){var g=h,y=void 0,v=void 0,b=void 0,x=void 0,L=void 0,w=void 0,C=void 0,S={},E=g.morphTargets.length,O=g.morphNormals.length;for(g.geometryGroups={},y=0,v=g.faces.length;v>y;y++)b=g.faces[y],x=b.materialIndex,w=void 0!==x?x:-1,void 0===S[w]&&(S[w]={hash:w,counter:0}),C=S[w].hash+"_"+S[w].counter,void 0===g.geometryGroups[C]&&(g.geometryGroups[C]={faces3:[],faces4:[],materialIndex:x,vertices:0,numMorphTargets:E,numMorphNormals:O}),L=b instanceof THREE.Face3?3:4,g.geometryGroups[C].vertices+L>65535&&(S[w].counter=S[w].counter+1,C=S[w].hash+"_"+S[w].counter,void 0===g.geometryGroups[C]&&(g.geometryGroups[C]={faces3:[],faces4:[],materialIndex:x,vertices:0,numMorphTargets:E,numMorphNormals:O})),b instanceof THREE.Face3?g.geometryGroups[C].faces3.push(y):g.geometryGroups[C].faces4.push(y),g.geometryGroups[C].vertices=g.geometryGroups[C].vertices+L;g.geometryGroupsList=[];var _=void 0;for(_ in g.geometryGroups)g.geometryGroups[_].id=z++,g.geometryGroupsList.push(g.geometryGroups[_])}for(l in h.geometryGroups)if(m=h.geometryGroups[l],!m.__webglVertexBuffer){var T=m;T.__webglVertexBuffer=N.createBuffer(),T.__webglNormalBuffer=N.createBuffer(),T.__webglTangentBuffer=N.createBuffer(),T.__webglColorBuffer=N.createBuffer(),T.__webglUVBuffer=N.createBuffer(),T.__webglUV2Buffer=N.createBuffer(),T.__webglSkinVertexABuffer=N.createBuffer(),T.__webglSkinVertexBBuffer=N.createBuffer(),T.__webglSkinIndicesBuffer=N.createBuffer(),T.__webglSkinWeightsBuffer=N.createBuffer(),T.__webglFaceBuffer=N.createBuffer(),T.__webglLineBuffer=N.createBuffer();var k=void 0,P=void 0;if(T.numMorphTargets)for(T.__webglMorphTargetsBuffers=[],k=0,P=T.numMorphTargets;P>k;k++)T.__webglMorphTargetsBuffers.push(N.createBuffer());if(T.numMorphNormals)for(T.__webglMorphNormalsBuffers=[],k=0,P=T.numMorphNormals;P>k;k++)T.__webglMorphNormalsBuffers.push(N.createBuffer());R.info.memory.geometries++;var A=m,M=o,D=M.geometry,I=A.faces3,F=A.faces4,B=3*I.length+4*F.length,G=1*I.length+2*F.length,j=3*I.length+4*F.length,X=i(M,A),U=r(X),H=n(X),J=X.vertexColors?X.vertexColors:!1;A.__vertexArray=new Float32Array(3*B),H&&(A.__normalArray=new Float32Array(3*B)),D.hasTangents&&(A.__tangentArray=new Float32Array(4*B)),J&&(A.__colorArray=new Float32Array(3*B)),U&&((D.faceUvs.length>0||D.faceVertexUvs.length>0)&&(A.__uvArray=new Float32Array(2*B)),(D.faceUvs.length>1||D.faceVertexUvs.length>1)&&(A.__uv2Array=new Float32Array(2*B))),M.geometry.skinWeights.length&&M.geometry.skinIndices.length&&(A.__skinVertexAArray=new Float32Array(4*B),A.__skinVertexBArray=new Float32Array(4*B),A.__skinIndexArray=new Float32Array(4*B),A.__skinWeightArray=new Float32Array(4*B)),A.__faceArray=new Uint16Array(3*G),A.__lineArray=new Uint16Array(2*j);var V=void 0,W=void 0;if(A.numMorphTargets)for(A.__morphTargetsArrays=[],V=0,W=A.numMorphTargets;W>V;V++)A.__morphTargetsArrays.push(new Float32Array(3*B));if(A.numMorphNormals)for(A.__morphNormalsArrays=[],V=0,W=A.numMorphNormals;W>V;V++)A.__morphNormalsArrays.push(new Float32Array(3*B));if(A.__webglFaceCount=3*G,A.__webglLineCount=2*j,X.attributes){void 0===A.__webglCustomAttributesList&&(A.__webglCustomAttributesList=[]);var $=void 0;for($ in X.attributes){var q,Y=X.attributes[$],K={};for(q in Y)K[q]=Y[q];if(!K.__webglInitialized||K.createUniqueBuffers){K.__webglInitialized=!0;var Z=1;"v2"===K.type?Z=2:"v3"===K.type?Z=3:"v4"===K.type?Z=4:"c"===K.type&&(Z=3),K.size=Z,K.array=new Float32Array(B*Z),K.buffer=N.createBuffer(),K.buffer.belongsToAttribute=$,Y.needsUpdate=!0,K.__original=Y}A.__webglCustomAttributesList.push(K)}}A.__inittedArrays=!0,h.verticesNeedUpdate=!0,h.morphTargetsNeedUpdate=!0,h.elementsNeedUpdate=!0,h.uvsNeedUpdate=!0,h.normalsNeedUpdate=!0,h.tangetsNeedUpdate=!0,h.colorsNeedUpdate=!0}}}else if(o instanceof THREE.Ribbon){if(h=o.geometry,!h.__webglVertexBuffer){var Q=h;Q.__webglVertexBuffer=N.createBuffer(),Q.__webglColorBuffer=N.createBuffer(),R.info.memory.geometries++;var et=h,tt=et.vertices.length;et.__vertexArray=new Float32Array(3*tt),et.__colorArray=new Float32Array(3*tt),et.__webglVertexCount=tt,h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0}}else if(o instanceof THREE.Line){if(h=o.geometry,!h.__webglVertexBuffer){var it=h;it.__webglVertexBuffer=N.createBuffer(),it.__webglColorBuffer=N.createBuffer(),R.info.memory.geometries++;var nt=h,rt=o,st=nt.vertices.length;nt.__vertexArray=new Float32Array(3*st),nt.__colorArray=new Float32Array(3*st),nt.__webglLineCount=st,t(nt,rt),h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0}}else if(o instanceof THREE.ParticleSystem&&(h=o.geometry,!h.__webglVertexBuffer)){var ot=h;ot.__webglVertexBuffer=N.createBuffer(),ot.__webglColorBuffer=N.createBuffer(),R.info.geometries++;var at=h,lt=o,ht=at.vertices.length;at.__vertexArray=new Float32Array(3*ht),at.__colorArray=new Float32Array(3*ht),at.__sortArray=[],at.__webglParticleCount=ht,t(at,lt),h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0}if(!o.__webglActive){if(o instanceof THREE.Mesh)if(h=o.geometry,h instanceof THREE.BufferGeometry)c(a.__webglObjects,h,o);else for(l in h.geometryGroups)m=h.geometryGroups[l],c(a.__webglObjects,m,o);else o instanceof THREE.Ribbon||o instanceof THREE.Line||o instanceof THREE.ParticleSystem?(h=o.geometry,c(a.__webglObjects,h,o)):o instanceof THREE.ImmediateRenderObject||o.immediateRenderCallback?a.__webglObjectsImmediate.push({object:o,opaque:null,transparent:null}):o instanceof THREE.Sprite?a.__webglSprites.push(o):o instanceof THREE.LensFlare&&a.__webglFlares.push(o);o.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var ct=e.__objectsRemoved[0],ut=e;ct instanceof THREE.Mesh||ct instanceof THREE.ParticleSystem||ct instanceof THREE.Ribbon||ct instanceof THREE.Line?p(ut.__webglObjects,ct):ct instanceof THREE.Sprite?f(ut.__webglSprites,ct):ct instanceof THREE.LensFlare?f(ut.__webglFlares,ct):(ct instanceof THREE.ImmediateRenderObject||ct.immediateRenderCallback)&&p(ut.__webglObjectsImmediate,ct),ct.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var dt=0,pt=e.__webglObjects.length;pt>dt;dt++){var ft=e.__webglObjects[dt].object,mt=ft.geometry,gt=void 0,yt=void 0,vt=void 0;if(ft instanceof THREE.Mesh)if(mt instanceof THREE.BufferGeometry)mt.verticesNeedUpdate=!1,mt.elementsNeedUpdate=!1,mt.uvsNeedUpdate=!1,mt.normalsNeedUpdate=!1,mt.colorsNeedUpdate=!1;else{for(var bt=0,xt=mt.geometryGroupsList.length;xt>bt;bt++)if(gt=mt.geometryGroupsList[bt],vt=i(ft,gt),yt=vt.attributes&&u(vt),mt.verticesNeedUpdate||mt.morphTargetsNeedUpdate||mt.elementsNeedUpdate||mt.uvsNeedUpdate||mt.normalsNeedUpdate||mt.colorsNeedUpdate||mt.tangetsNeedUpdate||yt){var Lt=gt,wt=ft,Ct=N.DYNAMIC_DRAW,St=!mt.dynamic,Et=vt;if(Lt.__inittedArrays){var Ot=n(Et),_t=Et.vertexColors?Et.vertexColors:!1,Tt=r(Et),kt=Ot===THREE.SmoothShading,Pt=void 0,At=void 0,Mt=void 0,Nt=void 0,Rt=void 0,Dt=void 0,It=void 0,Ft=void 0,Bt=void 0,Gt=void 0,jt=void 0,zt=void 0,Xt=void 0,Ut=void 0,Ht=void 0,Jt=void 0,Vt=void 0,Wt=void 0,$t=void 0,qt=void 0,Yt=void 0,Kt=void 0,Zt=void 0,Qt=void 0,ei=void 0,ti=void 0,ii=void 0,ni=void 0,ri=void 0,si=void 0,oi=void 0,ai=void 0,li=void 0,hi=void 0,ci=void 0,ui=void 0,di=void 0,pi=void 0,fi=void 0,mi=void 0,gi=void 0,yi=void 0,vi=void 0,bi=void 0,xi=void 0,Li=void 0,wi=void 0,Ci=void 0,Si=void 0,Ei=void 0,Oi=void 0,_i=void 0,Ti=void 0,ki=void 0,Pi=0,Ai=0,Mi=0,Ni=0,Ri=0,Di=0,Ii=0,Fi=0,Bi=0,Gi=0,ji=0,zi=0,Xi=void 0,Ui=Lt.__vertexArray,Hi=Lt.__uvArray,Ji=Lt.__uv2Array,Vi=Lt.__normalArray,Wi=Lt.__tangentArray,$i=Lt.__colorArray,qi=Lt.__skinVertexAArray,Yi=Lt.__skinVertexBArray,Ki=Lt.__skinIndexArray,Zi=Lt.__skinWeightArray,Qi=Lt.__morphTargetsArrays,en=Lt.__morphNormalsArrays,tn=Lt.__webglCustomAttributesList,nn=void 0,rn=Lt.__faceArray,sn=Lt.__lineArray,on=wt.geometry,an=on.elementsNeedUpdate,ln=on.uvsNeedUpdate,hn=on.normalsNeedUpdate,cn=on.tangetsNeedUpdate,un=on.colorsNeedUpdate,dn=on.morphTargetsNeedUpdate,pn=on.vertices,fn=Lt.faces3,mn=Lt.faces4,gn=on.faces,yn=on.faceVertexUvs[0],vn=on.faceVertexUvs[1],bn=on.skinVerticesA,xn=on.skinVerticesB,Ln=on.skinIndices,wn=on.skinWeights,Cn=on.morphTargets,Sn=on.morphNormals;if(on.verticesNeedUpdate){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],zt=pn[Nt.a],Xt=pn[Nt.b],Ut=pn[Nt.c],Ui[Ai]=zt.x,Ui[Ai+1]=zt.y,Ui[Ai+2]=zt.z,Ui[Ai+3]=Xt.x,Ui[Ai+4]=Xt.y,Ui[Ai+5]=Xt.z,Ui[Ai+6]=Ut.x,Ui[Ai+7]=Ut.y,Ui[Ai+8]=Ut.z,Ai+=9;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],zt=pn[Nt.a],Xt=pn[Nt.b],Ut=pn[Nt.c],Ht=pn[Nt.d],Ui[Ai]=zt.x,Ui[Ai+1]=zt.y,Ui[Ai+2]=zt.z,Ui[Ai+3]=Xt.x,Ui[Ai+4]=Xt.y,Ui[Ai+5]=Xt.z,Ui[Ai+6]=Ut.x,Ui[Ai+7]=Ut.y,Ui[Ai+8]=Ut.z,Ui[Ai+9]=Ht.x,Ui[Ai+10]=Ht.y,Ui[Ai+11]=Ht.z,Ai+=12;N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,Ui,Ct)}if(dn)for(Si=0,Ei=Cn.length;Ei>Si;Si++){for(Pt=ji=0,At=fn.length;At>Pt;Pt++)Ti=fn[Pt],Nt=gn[Ti],zt=Cn[Si].vertices[Nt.a],Xt=Cn[Si].vertices[Nt.b],Ut=Cn[Si].vertices[Nt.c],Oi=Qi[Si],Oi[ji]=zt.x,Oi[ji+1]=zt.y,Oi[ji+2]=zt.z,Oi[ji+3]=Xt.x,Oi[ji+4]=Xt.y,Oi[ji+5]=Xt.z,Oi[ji+6]=Ut.x,Oi[ji+7]=Ut.y,Oi[ji+8]=Ut.z,Et.morphNormals&&(kt?(ki=Sn[Si].vertexNormals[Ti],qt=ki.a,Yt=ki.b,Kt=ki.c):Kt=Yt=qt=Sn[Si].faceNormals[Ti],_i=en[Si],_i[ji]=qt.x,_i[ji+1]=qt.y,_i[ji+2]=qt.z,_i[ji+3]=Yt.x,_i[ji+4]=Yt.y,_i[ji+5]=Yt.z,_i[ji+6]=Kt.x,_i[ji+7]=Kt.y,_i[ji+8]=Kt.z),ji+=9;for(Pt=0,At=mn.length;At>Pt;Pt++)Ti=mn[Pt],Nt=gn[Ti],zt=Cn[Si].vertices[Nt.a],Xt=Cn[Si].vertices[Nt.b],Ut=Cn[Si].vertices[Nt.c],Ht=Cn[Si].vertices[Nt.d],Oi=Qi[Si],Oi[ji]=zt.x,Oi[ji+1]=zt.y,Oi[ji+2]=zt.z,Oi[ji+3]=Xt.x,Oi[ji+4]=Xt.y,Oi[ji+5]=Xt.z,Oi[ji+6]=Ut.x,Oi[ji+7]=Ut.y,Oi[ji+8]=Ut.z,Oi[ji+9]=Ht.x,Oi[ji+10]=Ht.y,Oi[ji+11]=Ht.z,Et.morphNormals&&(kt?(ki=Sn[Si].vertexNormals[Ti],qt=ki.a,Yt=ki.b,Kt=ki.c,Zt=ki.d):Zt=Kt=Yt=qt=Sn[Si].faceNormals[Ti],_i=en[Si],_i[ji]=qt.x,_i[ji+1]=qt.y,_i[ji+2]=qt.z,_i[ji+3]=Yt.x,_i[ji+4]=Yt.y,_i[ji+5]=Yt.z,_i[ji+6]=Kt.x,_i[ji+7]=Kt.y,_i[ji+8]=Kt.z,_i[ji+9]=Zt.x,_i[ji+10]=Zt.y,_i[ji+11]=Zt.z),ji+=12;N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglMorphTargetsBuffers[Si]),N.bufferData(N.ARRAY_BUFFER,Qi[Si],Ct),Et.morphNormals&&(N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglMorphNormalsBuffers[Si]),N.bufferData(N.ARRAY_BUFFER,en[Si],Ct))}if(wn.length){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],ni=wn[Nt.a],ri=wn[Nt.b],si=wn[Nt.c],Zi[Gi]=ni.x,Zi[Gi+1]=ni.y,Zi[Gi+2]=ni.z,Zi[Gi+3]=ni.w,Zi[Gi+4]=ri.x,Zi[Gi+5]=ri.y,Zi[Gi+6]=ri.z,Zi[Gi+7]=ri.w,Zi[Gi+8]=si.x,Zi[Gi+9]=si.y,Zi[Gi+10]=si.z,Zi[Gi+11]=si.w,ai=Ln[Nt.a],li=Ln[Nt.b],hi=Ln[Nt.c],Ki[Gi]=ai.x,Ki[Gi+1]=ai.y,Ki[Gi+2]=ai.z,Ki[Gi+3]=ai.w,Ki[Gi+4]=li.x,Ki[Gi+5]=li.y,Ki[Gi+6]=li.z,Ki[Gi+7]=li.w,Ki[Gi+8]=hi.x,Ki[Gi+9]=hi.y,Ki[Gi+10]=hi.z,Ki[Gi+11]=hi.w,ui=bn[Nt.a],di=bn[Nt.b],pi=bn[Nt.c],qi[Gi]=ui.x,qi[Gi+1]=ui.y,qi[Gi+2]=ui.z,qi[Gi+3]=1,qi[Gi+4]=di.x,qi[Gi+5]=di.y,qi[Gi+6]=di.z,qi[Gi+7]=1,qi[Gi+8]=pi.x,qi[Gi+9]=pi.y,qi[Gi+10]=pi.z,qi[Gi+11]=1,mi=xn[Nt.a],gi=xn[Nt.b],yi=xn[Nt.c],Yi[Gi]=mi.x,Yi[Gi+1]=mi.y,Yi[Gi+2]=mi.z,Yi[Gi+3]=1,Yi[Gi+4]=gi.x,Yi[Gi+5]=gi.y,Yi[Gi+6]=gi.z,Yi[Gi+7]=1,Yi[Gi+8]=yi.x,Yi[Gi+9]=yi.y,Yi[Gi+10]=yi.z,Yi[Gi+11]=1,Gi+=12;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],ni=wn[Nt.a],ri=wn[Nt.b],si=wn[Nt.c],oi=wn[Nt.d],Zi[Gi]=ni.x,Zi[Gi+1]=ni.y,Zi[Gi+2]=ni.z,Zi[Gi+3]=ni.w,Zi[Gi+4]=ri.x,Zi[Gi+5]=ri.y,Zi[Gi+6]=ri.z,Zi[Gi+7]=ri.w,Zi[Gi+8]=si.x,Zi[Gi+9]=si.y,Zi[Gi+10]=si.z,Zi[Gi+11]=si.w,Zi[Gi+12]=oi.x,Zi[Gi+13]=oi.y,Zi[Gi+14]=oi.z,Zi[Gi+15]=oi.w,ai=Ln[Nt.a],li=Ln[Nt.b],hi=Ln[Nt.c],ci=Ln[Nt.d],Ki[Gi]=ai.x,Ki[Gi+1]=ai.y,Ki[Gi+2]=ai.z,Ki[Gi+3]=ai.w,Ki[Gi+4]=li.x,Ki[Gi+5]=li.y,Ki[Gi+6]=li.z,Ki[Gi+7]=li.w,Ki[Gi+8]=hi.x,Ki[Gi+9]=hi.y,Ki[Gi+10]=hi.z,Ki[Gi+11]=hi.w,Ki[Gi+12]=ci.x,Ki[Gi+13]=ci.y,Ki[Gi+14]=ci.z,Ki[Gi+15]=ci.w,ui=bn[Nt.a],di=bn[Nt.b],pi=bn[Nt.c],fi=bn[Nt.d],qi[Gi]=ui.x,qi[Gi+1]=ui.y,qi[Gi+2]=ui.z,qi[Gi+3]=1,qi[Gi+4]=di.x,qi[Gi+5]=di.y,qi[Gi+6]=di.z,qi[Gi+7]=1,qi[Gi+8]=pi.x,qi[Gi+9]=pi.y,qi[Gi+10]=pi.z,qi[Gi+11]=1,qi[Gi+12]=fi.x,qi[Gi+13]=fi.y,qi[Gi+14]=fi.z,qi[Gi+15]=1,mi=xn[Nt.a],gi=xn[Nt.b],yi=xn[Nt.c],vi=xn[Nt.d],Yi[Gi]=mi.x,Yi[Gi+1]=mi.y,Yi[Gi+2]=mi.z,Yi[Gi+3]=1,Yi[Gi+4]=gi.x,Yi[Gi+5]=gi.y,Yi[Gi+6]=gi.z,Yi[Gi+7]=1,Yi[Gi+8]=yi.x,Yi[Gi+9]=yi.y,Yi[Gi+10]=yi.z,Yi[Gi+11]=1,Yi[Gi+12]=vi.x,Yi[Gi+13]=vi.y,Yi[Gi+14]=vi.z,Yi[Gi+15]=1,Gi+=16;Gi>0&&(N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglSkinVertexABuffer),N.bufferData(N.ARRAY_BUFFER,qi,Ct),N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglSkinVertexBBuffer),N.bufferData(N.ARRAY_BUFFER,Yi,Ct),N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglSkinIndicesBuffer),N.bufferData(N.ARRAY_BUFFER,Ki,Ct),N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglSkinWeightsBuffer),N.bufferData(N.ARRAY_BUFFER,Zi,Ct))}if(un&&_t){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],It=Nt.vertexColors,Ft=Nt.color,3===It.length&&_t===THREE.VertexColors?(Qt=It[0],ei=It[1],ti=It[2]):ti=ei=Qt=Ft,$i[Bi]=Qt.r,$i[Bi+1]=Qt.g,$i[Bi+2]=Qt.b,$i[Bi+3]=ei.r,$i[Bi+4]=ei.g,$i[Bi+5]=ei.b,$i[Bi+6]=ti.r,$i[Bi+7]=ti.g,$i[Bi+8]=ti.b,Bi+=9;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],It=Nt.vertexColors,Ft=Nt.color,4===It.length&&_t===THREE.VertexColors?(Qt=It[0],ei=It[1],ti=It[2],ii=It[3]):ii=ti=ei=Qt=Ft,$i[Bi]=Qt.r,$i[Bi+1]=Qt.g,$i[Bi+2]=Qt.b,$i[Bi+3]=ei.r,$i[Bi+4]=ei.g,$i[Bi+5]=ei.b,$i[Bi+6]=ti.r,$i[Bi+7]=ti.g,$i[Bi+8]=ti.b,$i[Bi+9]=ii.r,$i[Bi+10]=ii.g,$i[Bi+11]=ii.b,Bi+=12;Bi>0&&(N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,$i,Ct))}if(cn&&on.hasTangents){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],Bt=Nt.vertexTangents,Jt=Bt[0],Vt=Bt[1],Wt=Bt[2],Wi[Ii]=Jt.x,Wi[Ii+1]=Jt.y,Wi[Ii+2]=Jt.z,Wi[Ii+3]=Jt.w,Wi[Ii+4]=Vt.x,Wi[Ii+5]=Vt.y,Wi[Ii+6]=Vt.z,Wi[Ii+7]=Vt.w,Wi[Ii+8]=Wt.x,Wi[Ii+9]=Wt.y,Wi[Ii+10]=Wt.z,Wi[Ii+11]=Wt.w,Ii+=12;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],Bt=Nt.vertexTangents,Jt=Bt[0],Vt=Bt[1],Wt=Bt[2],$t=Bt[3],Wi[Ii]=Jt.x,Wi[Ii+1]=Jt.y,Wi[Ii+2]=Jt.z,Wi[Ii+3]=Jt.w,Wi[Ii+4]=Vt.x,Wi[Ii+5]=Vt.y,Wi[Ii+6]=Vt.z,Wi[Ii+7]=Vt.w,Wi[Ii+8]=Wt.x,Wi[Ii+9]=Wt.y,Wi[Ii+10]=Wt.z,Wi[Ii+11]=Wt.w,Wi[Ii+12]=$t.x,Wi[Ii+13]=$t.y,Wi[Ii+14]=$t.z,Wi[Ii+15]=$t.w,Ii+=16;N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglTangentBuffer),N.bufferData(N.ARRAY_BUFFER,Wi,Ct)}if(hn&&Ot){for(Pt=0,At=fn.length;At>Pt;Pt++)if(Nt=gn[fn[Pt]],Rt=Nt.vertexNormals,Dt=Nt.normal,3===Rt.length&&kt)for(bi=0;3>bi;bi++)Li=Rt[bi],Vi[Di]=Li.x,Vi[Di+1]=Li.y,Vi[Di+2]=Li.z,Di+=3;else for(bi=0;3>bi;bi++)Vi[Di]=Dt.x,Vi[Di+1]=Dt.y,Vi[Di+2]=Dt.z,Di+=3;for(Pt=0,At=mn.length;At>Pt;Pt++)if(Nt=gn[mn[Pt]],Rt=Nt.vertexNormals,Dt=Nt.normal,4===Rt.length&&kt)for(bi=0;4>bi;bi++)Li=Rt[bi],Vi[Di]=Li.x,Vi[Di+1]=Li.y,Vi[Di+2]=Li.z,Di+=3;else for(bi=0;4>bi;bi++)Vi[Di]=Dt.x,Vi[Di+1]=Dt.y,Vi[Di+2]=Dt.z,Di+=3;N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglNormalBuffer),N.bufferData(N.ARRAY_BUFFER,Vi,Ct)}if(ln&&yn&&Tt){for(Pt=0,At=fn.length;At>Pt;Pt++)if(Mt=fn[Pt],Nt=gn[Mt],Gt=yn[Mt],void 0!==Gt)for(bi=0;3>bi;bi++)wi=Gt[bi],Hi[Mi]=wi.u,Hi[Mi+1]=wi.v,Mi+=2;for(Pt=0,At=mn.length;At>Pt;Pt++)if(Mt=mn[Pt],Nt=gn[Mt],Gt=yn[Mt],void 0!==Gt)for(bi=0;4>bi;bi++)wi=Gt[bi],Hi[Mi]=wi.u,Hi[Mi+1]=wi.v,Mi+=2;Mi>0&&(N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglUVBuffer),N.bufferData(N.ARRAY_BUFFER,Hi,Ct))}if(ln&&vn&&Tt){for(Pt=0,At=fn.length;At>Pt;Pt++)if(Mt=fn[Pt],Nt=gn[Mt],jt=vn[Mt],void 0!==jt)for(bi=0;3>bi;bi++)Ci=jt[bi],Ji[Ni]=Ci.u,Ji[Ni+1]=Ci.v,Ni+=2;for(Pt=0,At=mn.length;At>Pt;Pt++)if(Mt=mn[Pt],Nt=gn[Mt],jt=vn[Mt],void 0!==jt)for(bi=0;4>bi;bi++)Ci=jt[bi],Ji[Ni]=Ci.u,Ji[Ni+1]=Ci.v,Ni+=2;Ni>0&&(N.bindBuffer(N.ARRAY_BUFFER,Lt.__webglUV2Buffer),N.bufferData(N.ARRAY_BUFFER,Ji,Ct))}if(an){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],rn[Ri]=Pi,rn[Ri+1]=Pi+1,rn[Ri+2]=Pi+2,Ri+=3,sn[Fi]=Pi,sn[Fi+1]=Pi+1,sn[Fi+2]=Pi,sn[Fi+3]=Pi+2,sn[Fi+4]=Pi+1,sn[Fi+5]=Pi+2,Fi+=6,Pi+=3;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],rn[Ri]=Pi,rn[Ri+1]=Pi+1,rn[Ri+2]=Pi+3,rn[Ri+3]=Pi+1,rn[Ri+4]=Pi+2,rn[Ri+5]=Pi+3,Ri+=6,sn[Fi]=Pi,sn[Fi+1]=Pi+1,sn[Fi+2]=Pi,sn[Fi+3]=Pi+3,sn[Fi+4]=Pi+1,sn[Fi+5]=Pi+2,sn[Fi+6]=Pi+2,sn[Fi+7]=Pi+3,Fi+=8,Pi+=4;N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,Lt.__webglFaceBuffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,rn,Ct),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,Lt.__webglLineBuffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,sn,Ct)}if(tn)for(bi=0,xi=tn.length;xi>bi;bi++)if(nn=tn[bi],nn.__original.needsUpdate){if(zi=0,1===nn.size){if(void 0===nn.boundTo||"vertices"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],nn.array[zi]=nn.value[Nt.a],nn.array[zi+1]=nn.value[Nt.b],nn.array[zi+2]=nn.value[Nt.c],zi+=3;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],nn.array[zi]=nn.value[Nt.a],nn.array[zi+1]=nn.value[Nt.b],nn.array[zi+2]=nn.value[Nt.c],nn.array[zi+3]=nn.value[Nt.d],zi+=4}else if("faces"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Xi=nn.value[fn[Pt]],nn.array[zi]=Xi,nn.array[zi+1]=Xi,nn.array[zi+2]=Xi,zi+=3;for(Pt=0,At=mn.length;At>Pt;Pt++)Xi=nn.value[mn[Pt]],nn.array[zi]=Xi,nn.array[zi+1]=Xi,nn.array[zi+2]=Xi,nn.array[zi+3]=Xi,zi+=4}}else if(2===nn.size){if(void 0===nn.boundTo||"vertices"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],zt=nn.value[Nt.a],Xt=nn.value[Nt.b],Ut=nn.value[Nt.c],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=Xt.x,nn.array[zi+3]=Xt.y,nn.array[zi+4]=Ut.x,nn.array[zi+5]=Ut.y,zi+=6;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],zt=nn.value[Nt.a],Xt=nn.value[Nt.b],Ut=nn.value[Nt.c],Ht=nn.value[Nt.d],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=Xt.x,nn.array[zi+3]=Xt.y,nn.array[zi+4]=Ut.x,nn.array[zi+5]=Ut.y,nn.array[zi+6]=Ht.x,nn.array[zi+7]=Ht.y,zi+=8}else if("faces"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Ut=Xt=zt=Xi=nn.value[fn[Pt]],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=Xt.x,nn.array[zi+3]=Xt.y,nn.array[zi+4]=Ut.x,nn.array[zi+5]=Ut.y,zi+=6;for(Pt=0,At=mn.length;At>Pt;Pt++)Ht=Ut=Xt=zt=Xi=nn.value[mn[Pt]],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=Xt.x,nn.array[zi+3]=Xt.y,nn.array[zi+4]=Ut.x,nn.array[zi+5]=Ut.y,nn.array[zi+6]=Ht.x,nn.array[zi+7]=Ht.y,zi+=8}}else if(3===nn.size){var En;if(En="c"===nn.type?["r","g","b"]:["x","y","z"],void 0===nn.boundTo||"vertices"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],zt=nn.value[Nt.a],Xt=nn.value[Nt.b],Ut=nn.value[Nt.c],nn.array[zi]=zt[En[0]],nn.array[zi+1]=zt[En[1]],nn.array[zi+2]=zt[En[2]],nn.array[zi+3]=Xt[En[0]],nn.array[zi+4]=Xt[En[1]],nn.array[zi+5]=Xt[En[2]],nn.array[zi+6]=Ut[En[0]],nn.array[zi+7]=Ut[En[1]],nn.array[zi+8]=Ut[En[2]],zi+=9;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],zt=nn.value[Nt.a],Xt=nn.value[Nt.b],Ut=nn.value[Nt.c],Ht=nn.value[Nt.d],nn.array[zi]=zt[En[0]],nn.array[zi+1]=zt[En[1]],nn.array[zi+2]=zt[En[2]],nn.array[zi+3]=Xt[En[0]],nn.array[zi+4]=Xt[En[1]],nn.array[zi+5]=Xt[En[2]],nn.array[zi+6]=Ut[En[0]],nn.array[zi+7]=Ut[En[1]],nn.array[zi+8]=Ut[En[2]],nn.array[zi+9]=Ht[En[0]],nn.array[zi+10]=Ht[En[1]],nn.array[zi+11]=Ht[En[2]],zi+=12}else if("faces"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Ut=Xt=zt=Xi=nn.value[fn[Pt]],nn.array[zi]=zt[En[0]],nn.array[zi+1]=zt[En[1]],nn.array[zi+2]=zt[En[2]],nn.array[zi+3]=Xt[En[0]],nn.array[zi+4]=Xt[En[1]],nn.array[zi+5]=Xt[En[2]],nn.array[zi+6]=Ut[En[0]],nn.array[zi+7]=Ut[En[1]],nn.array[zi+8]=Ut[En[2]],zi+=9;for(Pt=0,At=mn.length;At>Pt;Pt++)Ht=Ut=Xt=zt=Xi=nn.value[mn[Pt]],nn.array[zi]=zt[En[0]],nn.array[zi+1]=zt[En[1]],nn.array[zi+2]=zt[En[2]],nn.array[zi+3]=Xt[En[0]],nn.array[zi+4]=Xt[En[1]],nn.array[zi+5]=Xt[En[2]],nn.array[zi+6]=Ut[En[0]],nn.array[zi+7]=Ut[En[1]],nn.array[zi+8]=Ut[En[2]],nn.array[zi+9]=Ht[En[0]],nn.array[zi+10]=Ht[En[1]],nn.array[zi+11]=Ht[En[2]],zi+=12}}else if(4===nn.size)if(void 0===nn.boundTo||"vertices"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Nt=gn[fn[Pt]],zt=nn.value[Nt.a],Xt=nn.value[Nt.b],Ut=nn.value[Nt.c],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=zt.z,nn.array[zi+3]=zt.w,nn.array[zi+4]=Xt.x,nn.array[zi+5]=Xt.y,nn.array[zi+6]=Xt.z,nn.array[zi+7]=Xt.w,nn.array[zi+8]=Ut.x,nn.array[zi+9]=Ut.y,nn.array[zi+10]=Ut.z,nn.array[zi+11]=Ut.w,zi+=12;for(Pt=0,At=mn.length;At>Pt;Pt++)Nt=gn[mn[Pt]],zt=nn.value[Nt.a],Xt=nn.value[Nt.b],Ut=nn.value[Nt.c],Ht=nn.value[Nt.d],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=zt.z,nn.array[zi+3]=zt.w,nn.array[zi+4]=Xt.x,nn.array[zi+5]=Xt.y,nn.array[zi+6]=Xt.z,nn.array[zi+7]=Xt.w,nn.array[zi+8]=Ut.x,nn.array[zi+9]=Ut.y,nn.array[zi+10]=Ut.z,nn.array[zi+11]=Ut.w,nn.array[zi+12]=Ht.x,nn.array[zi+13]=Ht.y,nn.array[zi+14]=Ht.z,nn.array[zi+15]=Ht.w,zi+=16}else if("faces"===nn.boundTo){for(Pt=0,At=fn.length;At>Pt;Pt++)Ut=Xt=zt=Xi=nn.value[fn[Pt]],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=zt.z,nn.array[zi+3]=zt.w,nn.array[zi+4]=Xt.x,nn.array[zi+5]=Xt.y,nn.array[zi+6]=Xt.z,nn.array[zi+7]=Xt.w,nn.array[zi+8]=Ut.x,nn.array[zi+9]=Ut.y,nn.array[zi+10]=Ut.z,nn.array[zi+11]=Ut.w,zi+=12;for(Pt=0,At=mn.length;At>Pt;Pt++)Ht=Ut=Xt=zt=Xi=nn.value[mn[Pt]],nn.array[zi]=zt.x,nn.array[zi+1]=zt.y,nn.array[zi+2]=zt.z,nn.array[zi+3]=zt.w,nn.array[zi+4]=Xt.x,nn.array[zi+5]=Xt.y,nn.array[zi+6]=Xt.z,nn.array[zi+7]=Xt.w,nn.array[zi+8]=Ut.x,nn.array[zi+9]=Ut.y,nn.array[zi+10]=Ut.z,nn.array[zi+11]=Ut.w,nn.array[zi+12]=Ht.x,nn.array[zi+13]=Ht.y,nn.array[zi+14]=Ht.z,nn.array[zi+15]=Ht.w,zi+=16}N.bindBuffer(N.ARRAY_BUFFER,nn.buffer),N.bufferData(N.ARRAY_BUFFER,nn.array,Ct)}St&&(delete Lt.__inittedArrays,delete Lt.__colorArray,delete Lt.__normalArray,delete Lt.__tangentArray,delete Lt.__uvArray,delete Lt.__uv2Array,delete Lt.__faceArray,delete Lt.__vertexArray,delete Lt.__lineArray,delete Lt.__skinVertexAArray,delete Lt.__skinVertexBArray,delete Lt.__skinIndexArray,delete Lt.__skinWeightArray)}}mt.verticesNeedUpdate=!1,mt.morphTargetsNeedUpdate=!1,mt.elementsNeedUpdate=!1,mt.uvsNeedUpdate=!1,mt.normalsNeedUpdate=!1,mt.colorsNeedUpdate=!1,mt.tangetsNeedUpdate=!1,vt.attributes&&d(vt)}else if(ft instanceof THREE.Ribbon){if(mt.verticesNeedUpdate||mt.colorsNeedUpdate){var On=mt,_n=N.DYNAMIC_DRAW,Tn=void 0,kn=void 0,Pn=void 0,An=void 0,Mn=void 0,Nn=On.vertices,Rn=On.colors,Dn=Nn.length,In=Rn.length,Fn=On.__vertexArray,Bn=On.__colorArray,Gn=On.colorsNeedUpdate;if(On.verticesNeedUpdate){for(Tn=0;Dn>Tn;Tn++)Pn=Nn[Tn],An=3*Tn,Fn[An]=Pn.x,Fn[An+1]=Pn.y,Fn[An+2]=Pn.z;N.bindBuffer(N.ARRAY_BUFFER,On.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,Fn,_n)}if(Gn){for(kn=0;In>kn;kn++)Mn=Rn[kn],An=3*kn,Bn[An]=Mn.r,Bn[An+1]=Mn.g,Bn[An+2]=Mn.b;N.bindBuffer(N.ARRAY_BUFFER,On.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,Bn,_n)}}mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1}else if(ft instanceof THREE.Line){if(vt=i(ft,gt),yt=vt.attributes&&u(vt),mt.verticesNeedUpdate||mt.colorsNeedUpdate||yt){var jn=mt,zn=N.DYNAMIC_DRAW,Xn=void 0,Un=void 0,Hn=void 0,Jn=void 0,Vn=void 0,Wn=jn.vertices,$n=jn.colors,qn=Wn.length,Yn=$n.length,Kn=jn.__vertexArray,Zn=jn.__colorArray,Qn=jn.colorsNeedUpdate,er=jn.__webglCustomAttributesList,tr=void 0,ir=void 0,nr=void 0,rr=void 0,sr=void 0,or=void 0;
if(jn.verticesNeedUpdate){for(Xn=0;qn>Xn;Xn++)Hn=Wn[Xn],Jn=3*Xn,Kn[Jn]=Hn.x,Kn[Jn+1]=Hn.y,Kn[Jn+2]=Hn.z;N.bindBuffer(N.ARRAY_BUFFER,jn.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,Kn,zn)}if(Qn){for(Un=0;Yn>Un;Un++)Vn=$n[Un],Jn=3*Un,Zn[Jn]=Vn.r,Zn[Jn+1]=Vn.g,Zn[Jn+2]=Vn.b;N.bindBuffer(N.ARRAY_BUFFER,jn.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,Zn,zn)}if(er)for(tr=0,ir=er.length;ir>tr;tr++)if(or=er[tr],or.needsUpdate&&(void 0===or.boundTo||"vertices"===or.boundTo)){if(Jn=0,rr=or.value.length,1===or.size)for(nr=0;rr>nr;nr++)or.array[nr]=or.value[nr];else if(2===or.size)for(nr=0;rr>nr;nr++)sr=or.value[nr],or.array[Jn]=sr.x,or.array[Jn+1]=sr.y,Jn+=2;else if(3===or.size)if("c"===or.type)for(nr=0;rr>nr;nr++)sr=or.value[nr],or.array[Jn]=sr.r,or.array[Jn+1]=sr.g,or.array[Jn+2]=sr.b,Jn+=3;else for(nr=0;rr>nr;nr++)sr=or.value[nr],or.array[Jn]=sr.x,or.array[Jn+1]=sr.y,or.array[Jn+2]=sr.z,Jn+=3;else if(4===or.size)for(nr=0;rr>nr;nr++)sr=or.value[nr],or.array[Jn]=sr.x,or.array[Jn+1]=sr.y,or.array[Jn+2]=sr.z,or.array[Jn+3]=sr.w,Jn+=4;N.bindBuffer(N.ARRAY_BUFFER,or.buffer),N.bufferData(N.ARRAY_BUFFER,or.array,zn)}}mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1,vt.attributes&&d(vt)}else ft instanceof THREE.ParticleSystem&&(vt=i(ft,gt),yt=vt.attributes&&u(vt),(mt.verticesNeedUpdate||mt.colorsNeedUpdate||ft.sortParticles||yt)&&s(mt,N.DYNAMIC_DRAW,ft),mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1,vt.attributes&&d(vt))}},this.initMaterial=function(e,t,i,n){var r,s,o;if(e instanceof THREE.MeshDepthMaterial?o="depth":e instanceof THREE.MeshNormalMaterial?o="normal":e instanceof THREE.MeshBasicMaterial?o="basic":e instanceof THREE.MeshLambertMaterial?o="lambert":e instanceof THREE.MeshPhongMaterial?o="phong":e instanceof THREE.LineBasicMaterial?o="basic":e instanceof THREE.ParticleBasicMaterial&&(o="particle_basic"),o){var a=THREE.ShaderLib[o];e.uniforms=THREE.UniformsUtils.clone(a.uniforms),e.vertexShader=a.vertexShader,e.fragmentShader=a.fragmentShader}var l,h,c,u,d;for(l=u=d=a=0,h=t.length;h>l;l++)c=t[l],c.onlyShadow||(c instanceof THREE.DirectionalLight&&u++,c instanceof THREE.PointLight&&d++,c instanceof THREE.SpotLight&&a++);M>=d+a+u?(h=u,c=d,u=a):(h=Math.ceil(M*u/(d+u)),u=c=M-h);var p=0,a=0;for(d=t.length;d>a;a++)l=t[a],l.castShadow&&(l instanceof THREE.SpotLight&&p++,l instanceof THREE.DirectionalLight&&!l.shadowCascade&&p++);var f=50;void 0!==n&&n instanceof THREE.SkinnedMesh&&(f=n.bones.length);var m;e:{d=e.fragmentShader,l=e.vertexShader;var g,a=e.uniforms,t=e.attributes,i={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:f,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:h,maxPointLights:c,maxSpotLights:u,maxShadows:p,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:n&&n.doubleSided},n=[];o?n.push(o):(n.push(d),n.push(l));for(g in i)n.push(g),n.push(i[g]);for(o=n.join(),g=0,n=D.length;n>g;g++)if(D[g].code===o){m=D[g].program;break e}g=N.createProgram(),n=["precision "+S+" float;",pt>0?"#define VERTEX_TEXTURES":"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"",R.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),h=["precision "+S+" float;","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"",R.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),N.attachShader(g,v("fragment",h+d)),N.attachShader(g,v("vertex",n+l)),N.linkProgram(g),N.getProgramParameter(g,N.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+N.getProgramParameter(g,N.VALIDATE_STATUS)+", gl error ["+N.getError()+"]"),g.uniforms={},g.attributes={};var y,n=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(y in a)n.push(y);for(y=n,n=0,a=y.length;a>n;n++)d=y[n],g.uniforms[d]=N.getUniformLocation(g,d);for(n=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],y=0;i.maxMorphTargets>y;y++)n.push("morphTarget"+y);for(y=0;i.maxMorphNormals>y;y++)n.push("morphNormal"+y);for(m in t)n.push(m);for(m=n,y=0,t=m.length;t>y;y++)i=m[y],g.attributes[i]=N.getAttribLocation(g,i);g.id=D.length,D.push({program:g,code:o}),R.info.memory.programs=D.length,m=g}if(e.program=m,m=e.program.attributes,m.position>=0&&N.enableVertexAttribArray(m.position),m.color>=0&&N.enableVertexAttribArray(m.color),m.normal>=0&&N.enableVertexAttribArray(m.normal),m.tangent>=0&&N.enableVertexAttribArray(m.tangent),e.skinning&&m.skinVertexA>=0&&m.skinVertexB>=0&&m.skinIndex>=0&&m.skinWeight>=0&&(N.enableVertexAttribArray(m.skinVertexA),N.enableVertexAttribArray(m.skinVertexB),N.enableVertexAttribArray(m.skinIndex),N.enableVertexAttribArray(m.skinWeight)),e.attributes)for(s in e.attributes)void 0!==m[s]&&m[s]>=0&&N.enableVertexAttribArray(m[s]);if(e.morphTargets)for(e.numSupportedMorphTargets=0,g="morphTarget",s=0;this.maxMorphTargets>s;s++)y=g+s,m[y]>=0&&(N.enableVertexAttribArray(m[y]),e.numSupportedMorphTargets++);if(e.morphNormals)for(e.numSupportedMorphNormals=0,g="morphNormal",s=0;this.maxMorphNormals>s;s++)y=g+s,m[y]>=0&&(N.enableVertexAttribArray(m[y]),e.numSupportedMorphNormals++);e.uniformsList=[];for(r in e.uniforms)e.uniformsList.push([e.uniforms[r],r])},this.setFaceCulling=function(e,t){e?(t&&"ccw"!==t?N.frontFace(N.CW):N.frontFace(N.CCW),"back"===e?N.cullFace(N.BACK):"front"===e?N.cullFace(N.FRONT):N.cullFace(N.FRONT_AND_BACK),N.enable(N.CULL_FACE)):N.disable(N.CULL_FACE)},this.setObjectFaces=function(e){X!==e.doubleSided&&(e.doubleSided?N.disable(N.CULL_FACE):N.enable(N.CULL_FACE),X=e.doubleSided),U!==e.flipSided&&(e.flipSided?N.frontFace(N.CW):N.frontFace(N.CCW),U=e.flipSided)},this.setDepthTest=function(e){$!==e&&(e?N.enable(N.DEPTH_TEST):N.disable(N.DEPTH_TEST),$=e)},this.setDepthWrite=function(e){q!==e&&(N.depthMask(e),q=e)},this.setBlending=function(e,t,i,n){if(e!==H){switch(e){case THREE.NoBlending:N.disable(N.BLEND);break;case THREE.AdditiveBlending:N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.SRC_ALPHA,N.ONE);break;case THREE.SubtractiveBlending:N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.ZERO,N.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.ZERO,N.SRC_COLOR);break;case THREE.CustomBlending:N.enable(N.BLEND);break;default:N.enable(N.BLEND),N.blendEquationSeparate(N.FUNC_ADD,N.FUNC_ADD),N.blendFuncSeparate(N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA,N.ONE,N.ONE_MINUS_SRC_ALPHA)}H=e}e===THREE.CustomBlending?(t!==J&&(N.blendEquation(w(t)),J=t),(i!==V||n!==W)&&(N.blendFunc(w(i),w(n)),V=i,W=n)):W=V=J=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=N.createTexture(),R.info.memory.textures++),N.activeTexture(N.TEXTURE0+t),N.bindTexture(N.TEXTURE_2D,e.__webglTexture),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var i=e.image,n=0===(i.width&i.width-1)&&0===(i.height&i.height-1),r=w(e.format),s=w(e.type);b(N.TEXTURE_2D,e,n),e instanceof THREE.DataTexture?N.texImage2D(N.TEXTURE_2D,0,r,i.width,i.height,0,r,s,i.data):N.texImage2D(N.TEXTURE_2D,0,r,r,s,e.image),e.generateMipmaps&&n&&N.generateMipmap(N.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else N.activeTexture(N.TEXTURE0+t),N.bindTexture(N.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglTexture=N.createTexture();var i=0===(e.width&e.width-1)&&0===(e.height&e.height-1),n=w(e.format),r=w(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],N.bindTexture(N.TEXTURE_CUBE_MAP,e.__webglTexture),b(N.TEXTURE_CUBE_MAP,e,i);for(var s=0;6>s;s++){e.__webglFramebuffer[s]=N.createFramebuffer(),e.__webglRenderbuffer[s]=N.createRenderbuffer(),N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,n,e.width,e.height,0,n,r,null);var o=e,a=N.TEXTURE_CUBE_MAP_POSITIVE_X+s;N.bindFramebuffer(N.FRAMEBUFFER,e.__webglFramebuffer[s]),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,a,o.__webglTexture,0),x(e.__webglRenderbuffer[s],e)}i&&N.generateMipmap(N.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=N.createFramebuffer(),e.__webglRenderbuffer=N.createRenderbuffer(),N.bindTexture(N.TEXTURE_2D,e.__webglTexture),b(N.TEXTURE_2D,e,i),N.texImage2D(N.TEXTURE_2D,0,n,e.width,e.height,0,n,r,null),n=N.TEXTURE_2D,N.bindFramebuffer(N.FRAMEBUFFER,e.__webglFramebuffer),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,n,e.__webglTexture,0),x(e.__webglRenderbuffer,e),i&&N.generateMipmap(N.TEXTURE_2D);t?N.bindTexture(N.TEXTURE_CUBE_MAP,null):N.bindTexture(N.TEXTURE_2D,null),N.bindRenderbuffer(N.RENDERBUFFER,null),N.bindFramebuffer(N.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,e=e.height,r=n=0):(t=null,i=it,e=nt,n=et,r=tt),t!==F&&(N.bindFramebuffer(N.FRAMEBUFFER,t),N.viewport(n,r,i,e),F=t),rt=i,st=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e},THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget,THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.ColorUtils={adjustHSV:function(e,t,i,n){var r=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,r),r.h=THREE.Math.clamp(r.h+t,0,1),r.s=THREE.Math.clamp(r.s+i,0,1),r.v=THREE.Math.clamp(r.v+n,0,1),e.setHSV(r.h,r.s,r.v)},rgbToHsv:function(e,t){var i=e.r,n=e.g,r=e.b,s=Math.max(Math.max(i,n),r),o=Math.min(Math.min(i,n),r);if(o===s)o=i=0;else{var a=s-o,o=a/s,i=(i===s?(n-r)/a:n===s?2+(r-i)/a:4+(i-n)/a)/6;0>i&&(i+=1),i>1&&(i-=1)}return void 0===t&&(t={h:0,s:0,v:0}),t.h=i,t.s=o,t.v=s,t}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(e,t){for(var i,n,r=e.vertices.length,s=t instanceof THREE.Mesh?t.geometry:t,o=e.vertices,a=s.vertices,l=e.faces,h=s.faces,c=e.faceVertexUvs[0],u=s.faceVertexUvs[0],d={},p=0;e.materials.length>p;p++)d[e.materials[p].id]=p;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,n=new THREE.Matrix4,n.extractRotation(i,t.scale));for(var p=0,f=a.length;f>p;p++){var m=a[p].clone();i&&i.multiplyVector3(m),o.push(m)}for(p=0,f=h.length;f>p;p++){var g,y,o=h[p],v=o.vertexNormals,b=o.vertexColors;for(o instanceof THREE.Face3?g=new THREE.Face3(o.a+r,o.b+r,o.c+r):o instanceof THREE.Face4&&(g=new THREE.Face4(o.a+r,o.b+r,o.c+r,o.d+r)),g.normal.copy(o.normal),n&&n.multiplyVector3(g.normal),a=0,m=v.length;m>a;a++)y=v[a].clone(),n&&n.multiplyVector3(y),g.vertexNormals.push(y);for(g.color.copy(o.color),a=0,m=b.length;m>a;a++)y=b[a],g.vertexColors.push(y.clone());void 0!==o.materialIndex&&(a=s.materials[o.materialIndex],m=a.id,b=d[m],void 0===b&&(b=e.materials.length,d[m]=b,e.materials.push(a)),g.materialIndex=b),g.centroid.copy(o.centroid),i&&i.multiplyVector3(g.centroid),l.push(g)}for(p=0,f=u.length;f>p;p++){for(i=u[p],n=[],a=0,m=i.length;m>a;a++)n.push(new THREE.UV(i[a].u,i[a].v));c.push(n)}},clone:function(e){var t,i=new THREE.Geometry,n=e.vertices,r=e.faces,s=e.faceVertexUvs[0];for(e.materials&&(i.materials=e.materials.slice()),e=0,t=n.length;t>e;e++)i.vertices.push(n[e].clone());for(e=0,t=r.length;t>e;e++)i.faces.push(r[e].clone());for(e=0,t=s.length;t>e;e++){for(var n=s[e],r=[],o=0,a=n.length;a>o;o++)r.push(new THREE.UV(n[o].u,n[o].v));i.faceVertexUvs[0].push(r)}return i},randomPointInTriangle:function(e,t,i){var n,r,s,o=new THREE.Vector3,a=THREE.GeometryUtils.__v1;return n=THREE.GeometryUtils.random(),r=THREE.GeometryUtils.random(),n+r>1&&(n=1-n,r=1-r),s=1-n-r,o.copy(e),o.multiplyScalar(n),a.copy(t),a.multiplyScalar(r),o.addSelf(a),a.copy(i),a.multiplyScalar(s),o.addSelf(a),o},randomPointInFace:function(e,t,i){var n,r,s;if(e instanceof THREE.Face3)return n=t.vertices[e.a],r=t.vertices[e.b],s=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(n,r,s);if(e instanceof THREE.Face4){n=t.vertices[e.a],r=t.vertices[e.b],s=t.vertices[e.c];var o,t=t.vertices[e.d];return i?e._area1&&e._area2?(i=e._area1,o=e._area2):(i=THREE.GeometryUtils.triangleArea(n,r,t),o=THREE.GeometryUtils.triangleArea(r,s,t),e._area1=i,e._area2=o):(i=THREE.GeometryUtils.triangleArea(n,r,t),o=THREE.GeometryUtils.triangleArea(r,s,t)),i>THREE.GeometryUtils.random()*(i+o)?THREE.GeometryUtils.randomPointInTriangle(n,r,t):THREE.GeometryUtils.randomPointInTriangle(r,s,t)}},randomPointsInGeometry:function(e,t){function i(e){function t(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return p[r]>e?t(i,r-1):e>p[r]?t(r+1,n):r}return t(0,p.length-1)}var n,r,s,o,a,l,h=e.faces,c=e.vertices,u=h.length,d=0,p=[];for(r=0;u>r;r++)n=h[r],n instanceof THREE.Face3?(s=c[n.a],o=c[n.b],a=c[n.c],n._area=THREE.GeometryUtils.triangleArea(s,o,a)):n instanceof THREE.Face4&&(s=c[n.a],o=c[n.b],a=c[n.c],l=c[n.d],n._area1=THREE.GeometryUtils.triangleArea(s,o,l),n._area2=THREE.GeometryUtils.triangleArea(o,a,l),n._area=n._area1+n._area2),d+=n._area,p[r]=d;for(n=[],r=0;t>r;r++)c=THREE.GeometryUtils.random()*d,c=i(c),n[r]=THREE.GeometryUtils.randomPointInFace(h[c],e,!0);return n},triangleArea:function(e,t,i){var n,r=THREE.GeometryUtils.__v1;return r.sub(e,t),n=r.length(),r.sub(e,i),e=r.length(),r.sub(t,i),i=r.length(),t=.5*(n+e+i),Math.sqrt(t*(t-n)*(t-e)*(t-i))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new THREE.Vector3;return i.add(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,i=e.length;i>t;t++)for(var n=e[t],r=0,s=n.length;s>r;r++)1!==n[r].u&&(n[r].u=n[r].u-Math.floor(n[r].u)),1!==n[r].v&&(n[r].v=n[r].v-Math.floor(n[r].v))},triangulateQuads:function(e){var t,i,n,r,s=[],o=[],a=[];for(t=0,i=e.faceUvs.length;i>t;t++)o[t]=[];for(t=0,i=e.faceVertexUvs.length;i>t;t++)a[t]=[];for(t=0,i=e.faces.length;i>t;t++)if(n=e.faces[t],n instanceof THREE.Face4){r=n.a;var l=n.b,h=n.c,c=n.d,u=new THREE.Face3,d=new THREE.Face3;for(u.color.copy(n.color),d.color.copy(n.color),u.materialIndex=n.materialIndex,d.materialIndex=n.materialIndex,u.a=r,u.b=l,u.c=c,d.a=l,d.b=h,d.c=c,4===n.vertexColors.length&&(u.vertexColors[0]=n.vertexColors[0].clone(),u.vertexColors[1]=n.vertexColors[1].clone(),u.vertexColors[2]=n.vertexColors[3].clone(),d.vertexColors[0]=n.vertexColors[1].clone(),d.vertexColors[1]=n.vertexColors[2].clone(),d.vertexColors[2]=n.vertexColors[3].clone()),s.push(u,d),n=0,r=e.faceVertexUvs.length;r>n;n++)e.faceVertexUvs[n].length&&(u=e.faceVertexUvs[n][t],l=u[1],h=u[2],c=u[3],u=[u[0].clone(),l.clone(),c.clone()],l=[l.clone(),h.clone(),c.clone()],a[n].push(u,l));for(n=0,r=e.faceUvs.length;r>n;n++)e.faceUvs[n].length&&(l=e.faceUvs[n][t],o[n].push(l,l))}else{for(s.push(n),n=0,r=e.faceUvs.length;r>n;n++)o[n].push(e.faceUvs[n]);for(n=0,r=e.faceVertexUvs.length;r>n;n++)a[n].push(e.faceVertexUvs[n])}e.faces=s,e.faceUvs=o,e.faceVertexUvs=a,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],i=0,n=e.faces.length;n>i;i++){var r=t.length,s=e.faces[i];if(s instanceof THREE.Face4){var o=s.a,a=s.b,l=s.c,o=e.vertices[o],a=e.vertices[a],l=e.vertices[l],h=e.vertices[s.d];t.push(o.clone()),t.push(a.clone()),t.push(l.clone()),t.push(h.clone()),s.a=r,s.b=r+1,s.c=r+2,s.d=r+3}else o=s.a,a=s.b,l=s.c,o=e.vertices[o],a=e.vertices[a],l=e.vertices[l],t.push(o.clone()),t.push(a.clone()),t.push(l.clone()),s.a=r,s.b=r+1,s.c=r+2}e.vertices=t,delete e.__tmpVertices},tessellate:function(e,t){var i,n,r,s,o,a,l,h,c,u,d,p,f,m,g,y,v,b,x,L=[],w=[];for(i=0,n=e.faceVertexUvs.length;n>i;i++)w[i]=[];for(i=0,n=e.faces.length;n>i;i++)if(r=e.faces[i],r instanceof THREE.Face3)if(s=r.a,o=r.b,a=r.c,h=e.vertices[s],c=e.vertices[o],u=e.vertices[a],p=h.distanceTo(c),f=c.distanceTo(u),d=h.distanceTo(u),p>t||f>t||d>t)for(l=e.vertices.length,b=r.clone(),x=r.clone(),p>=f&&p>=d?(h=h.clone(),h.lerpSelf(c,.5),b.a=s,b.b=l,b.c=a,x.a=l,x.b=o,x.c=a,3===r.vertexNormals.length&&(s=r.vertexNormals[0].clone(),s.lerpSelf(r.vertexNormals[1],.5),b.vertexNormals[1].copy(s),x.vertexNormals[0].copy(s)),3===r.vertexColors.length&&(s=r.vertexColors[0].clone(),s.lerpSelf(r.vertexColors[1],.5),b.vertexColors[1].copy(s),x.vertexColors[0].copy(s)),r=0):f>=p&&f>=d?(h=c.clone(),h.lerpSelf(u,.5),b.a=s,b.b=o,b.c=l,x.a=l,x.b=a,x.c=s,3===r.vertexNormals.length&&(s=r.vertexNormals[1].clone(),s.lerpSelf(r.vertexNormals[2],.5),b.vertexNormals[2].copy(s),x.vertexNormals[0].copy(s),x.vertexNormals[1].copy(r.vertexNormals[2]),x.vertexNormals[2].copy(r.vertexNormals[0])),3===r.vertexColors.length&&(s=r.vertexColors[1].clone(),s.lerpSelf(r.vertexColors[2],.5),b.vertexColors[2].copy(s),x.vertexColors[0].copy(s),x.vertexColors[1].copy(r.vertexColors[2]),x.vertexColors[2].copy(r.vertexColors[0])),r=1):(h=h.clone(),h.lerpSelf(u,.5),b.a=s,b.b=o,b.c=l,x.a=l,x.b=o,x.c=a,3===r.vertexNormals.length&&(s=r.vertexNormals[0].clone(),s.lerpSelf(r.vertexNormals[2],.5),b.vertexNormals[2].copy(s),x.vertexNormals[0].copy(s)),3===r.vertexColors.length&&(s=r.vertexColors[0].clone(),s.lerpSelf(r.vertexColors[2],.5),b.vertexColors[2].copy(s),x.vertexColors[0].copy(s)),r=2),L.push(b,x),e.vertices.push(h),s=0,o=e.faceVertexUvs.length;o>s;s++)e.faceVertexUvs[s].length&&(h=e.faceVertexUvs[s][i],x=h[0],a=h[1],b=h[2],0===r?(c=x.clone(),c.lerpSelf(a,.5),h=[x.clone(),c.clone(),b.clone()],a=[c.clone(),a.clone(),b.clone()]):1===r?(c=a.clone(),c.lerpSelf(b,.5),h=[x.clone(),a.clone(),c.clone()],a=[c.clone(),b.clone(),x.clone()]):(c=x.clone(),c.lerpSelf(b,.5),h=[x.clone(),a.clone(),c.clone()],a=[c.clone(),a.clone(),b.clone()]),w[s].push(h,a));else for(L.push(r),s=0,o=e.faceVertexUvs.length;o>s;s++)w[s].push(e.faceVertexUvs[s][i]);else if(s=r.a,o=r.b,a=r.c,l=r.d,h=e.vertices[s],c=e.vertices[o],u=e.vertices[a],d=e.vertices[l],p=h.distanceTo(c),f=c.distanceTo(u),m=u.distanceTo(d),g=h.distanceTo(d),p>t||f>t||m>t||g>t)for(y=e.vertices.length,v=e.vertices.length+1,b=r.clone(),x=r.clone(),p>=f&&p>=m&&p>=g||m>=f&&m>=p&&m>=g?(p=h.clone(),p.lerpSelf(c,.5),c=u.clone(),c.lerpSelf(d,.5),b.a=s,b.b=y,b.c=v,b.d=l,x.a=y,x.b=o,x.c=a,x.d=v,4===r.vertexNormals.length&&(s=r.vertexNormals[0].clone(),s.lerpSelf(r.vertexNormals[1],.5),o=r.vertexNormals[2].clone(),o.lerpSelf(r.vertexNormals[3],.5),b.vertexNormals[1].copy(s),b.vertexNormals[2].copy(o),x.vertexNormals[0].copy(s),x.vertexNormals[3].copy(o)),4===r.vertexColors.length&&(s=r.vertexColors[0].clone(),s.lerpSelf(r.vertexColors[1],.5),o=r.vertexColors[2].clone(),o.lerpSelf(r.vertexColors[3],.5),b.vertexColors[1].copy(s),b.vertexColors[2].copy(o),x.vertexColors[0].copy(s),x.vertexColors[3].copy(o)),r=0):(p=c.clone(),p.lerpSelf(u,.5),c=d.clone(),c.lerpSelf(h,.5),b.a=s,b.b=o,b.c=y,b.d=v,x.a=v,x.b=y,x.c=a,x.d=l,4===r.vertexNormals.length&&(s=r.vertexNormals[1].clone(),s.lerpSelf(r.vertexNormals[2],.5),o=r.vertexNormals[3].clone(),o.lerpSelf(r.vertexNormals[0],.5),b.vertexNormals[2].copy(s),b.vertexNormals[3].copy(o),x.vertexNormals[0].copy(o),x.vertexNormals[1].copy(s)),4===r.vertexColors.length&&(s=r.vertexColors[1].clone(),s.lerpSelf(r.vertexColors[2],.5),o=r.vertexColors[3].clone(),o.lerpSelf(r.vertexColors[0],.5),b.vertexColors[2].copy(s),b.vertexColors[3].copy(o),x.vertexColors[0].copy(o),x.vertexColors[1].copy(s)),r=1),L.push(b,x),e.vertices.push(p,c),s=0,o=e.faceVertexUvs.length;o>s;s++)e.faceVertexUvs[s].length&&(h=e.faceVertexUvs[s][i],x=h[0],a=h[1],b=h[2],h=h[3],0===r?(c=x.clone(),c.lerpSelf(a,.5),u=b.clone(),u.lerpSelf(h,.5),x=[x.clone(),c.clone(),u.clone(),h.clone()],a=[c.clone(),a.clone(),b.clone(),u.clone()]):(c=a.clone(),c.lerpSelf(b,.5),u=h.clone(),u.lerpSelf(x,.5),x=[x.clone(),a.clone(),c.clone(),u.clone()],a=[u.clone(),c.clone(),b.clone(),h.clone()]),w[s].push(x,a));else for(L.push(r),s=0,o=e.faceVertexUvs.length;o>s;s++)w[s].push(e.faceVertexUvs[s][i]);e.faces=L,e.faceVertexUvs=w}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i){var n=new Image,r=new THREE.Texture(n,t);return n.onload=function(){r.needsUpdate=!0,i&&i(this)},n.crossOrigin=this.crossOrigin,n.src=e,r},loadTextureCube:function(e,t,i){var n,r=[],s=new THREE.Texture(r,t),t=r.loadCount=0;for(n=e.length;n>t;++t)r[t]=new Image,r[t].onload=function(){r.loadCount=r.loadCount+1,6===r.loadCount&&(s.needsUpdate=!0),i&&i(this)},r[t].crossOrigin=this.crossOrigin,r[t].src=e[t];return s},getNormalMap:function(e,t){var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=1|t,n=e.width,r=e.height,s=document.createElement("canvas");s.width=n,s.height=r;var o=s.getContext("2d");o.drawImage(e,0,0);for(var a=o.getImageData(0,0,n,r).data,l=o.createImageData(n,r),h=l.data,c=0;n>c;c++)for(var u=0;r>u;u++){var d=0>u-1?0:u-1,p=u+1>r-1?r-1:u+1,f=0>c-1?0:c-1,m=c+1>n-1?n-1:c+1,g=[],y=[0,0,a[4*(u*n+c)]/255*t];for(g.push([-1,0,a[4*(u*n+f)]/255*t]),g.push([-1,-1,a[4*(d*n+f)]/255*t]),g.push([0,-1,a[4*(d*n+c)]/255*t]),g.push([1,-1,a[4*(d*n+m)]/255*t]),g.push([1,0,a[4*(u*n+m)]/255*t]),g.push([1,1,a[4*(p*n+m)]/255*t]),g.push([0,1,a[4*(p*n+c)]/255*t]),g.push([-1,1,a[4*(p*n+f)]/255*t]),d=[],f=g.length,p=0;f>p;p++){var m=g[p],v=g[(p+1)%f],m=[m[0]-y[0],m[1]-y[1],m[2]-y[2]],v=[v[0]-y[0],v[1]-y[1],v[2]-y[2]];d.push(i([m[1]*v[2]-m[2]*v[1],m[2]*v[0]-m[0]*v[2],m[0]*v[1]-m[1]*v[0]]))}for(g=[0,0,0],p=0;d.length>p;p++)g[0]=g[0]+d[p][0],g[1]=g[1]+d[p][1],g[2]=g[2]+d[p][2];g[0]=g[0]/d.length,g[1]=g[1]/d.length,g[2]=g[2]/d.length,y=4*(u*n+c),h[y]=0|255*((g[0]+1)/2),h[y+1]=0|255*(g[1]+.5),h[y+2]=0|255*g[2],h[y+3]=255}return o.putImageData(l,0,0),s},generateDataTexture:function(e,t,i){for(var n=e*t,r=new Uint8Array(3*n),s=Math.floor(255*i.r),o=Math.floor(255*i.g),i=Math.floor(255*i.b),a=0;n>a;a++)r[3*a]=s,r[3*a+1]=o,r[3*a+2]=i;return e=new THREE.DataTexture(r,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var i,n,r=e.children.length;for(n=0;r>n;n++)i=e.children[n],t(i),THREE.SceneUtils.traverseHierarchy(i,t)},createMultiMaterialObject:function(e,t){var i,n=t.length,r=new THREE.Object3D;for(i=0;n>i;i++){var s=new THREE.Mesh(e,t[i]);r.add(s)}return r},cloneObject:function(e){var t;e instanceof THREE.MorphAnimMesh?(t=new THREE.MorphAnimMesh(e.geometry,e.material),t.duration=e.duration,t.mirroredLoop=e.mirroredLoop,t.time=e.time,t.lastKeyframe=e.lastKeyframe,t.currentKeyframe=e.currentKeyframe,t.direction=e.direction,t.directionBackwards=e.directionBackwards):e instanceof THREE.SkinnedMesh?t=new THREE.SkinnedMesh(e.geometry,e.material):e instanceof THREE.Mesh?t=new THREE.Mesh(e.geometry,e.material):e instanceof THREE.Line?t=new THREE.Line(e.geometry,e.material,e.type):e instanceof THREE.Ribbon?t=new THREE.Ribbon(e.geometry,e.material):e instanceof THREE.ParticleSystem?(t=new THREE.ParticleSystem(e.geometry,e.material),t.sortParticles=e.sortParticles):e instanceof THREE.Particle?t=new THREE.Particle(e.material):e instanceof THREE.Sprite?(t=new THREE.Sprite({}),t.color.copy(e.color),t.map=e.map,t.blending=e.blending,t.useScreenCoordinates=e.useScreenCoordinates,t.mergeWith3D=e.mergeWith3D,t.affectedByDistance=e.affectedByDistance,t.scaleByViewport=e.scaleByViewport,t.alignment=e.alignment,t.rotation3d.copy(e.rotation3d),t.rotation=e.rotation,t.opacity=e.opacity,t.uvOffset.copy(e.uvOffset),t.uvScale.copy(e.uvScale)):e instanceof THREE.LOD?t=new THREE.LOD:e instanceof THREE.Object3D&&(t=new THREE.Object3D),t.name=e.name,t.parent=e.parent,t.up.copy(e.up),t.position.copy(e.position),t.rotation instanceof THREE.Vector3&&t.rotation.copy(e.rotation),t.eulerOrder=e.eulerOrder,t.scale.copy(e.scale),t.dynamic=e.dynamic,t.doubleSided=e.doubleSided,t.flipSided=e.flipSided,t.renderDepth=e.renderDepth,t.rotationAutoUpdate=e.rotationAutoUpdate,t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld),t.matrixRotationWorld.copy(e.matrixRotationWorld),t.matrixAutoUpdate=e.matrixAutoUpdate,t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,t.quaternion.copy(e.quaternion),t.useQuaternion=e.useQuaternion,t.boundRadius=e.boundRadius,t.boundRadiusScale=e.boundRadiusScale,t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow,t.frustumCulled=e.frustumCulled;for(var i=0;e.children.length>i;i++){var n=THREE.SceneUtils.cloneObject(e.children[i]);t.children[i]=n,n.parent=t}if(e instanceof THREE.LOD)for(i=0;e.LODs.length>i;i++)t.LODs[i]={visibleAtDistance:e.LODs[i].visibleAtDistance,object3D:t.children[i]};return t},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var n=new THREE.Matrix4;n.getInverse(i.matrixWorld),e.applyMatrix(n),t.remove(e),i.add(e)}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++,this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null,this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.morphTargets=[]
},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}},THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return this.getPoint(this.getUtoTmapping(e))},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),s=0;for(n.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),s+=t.distanceTo(r),n.push(s),r=t;return this.cacheArcLengths=n},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,s=n.length;i=t?t:e*n[s-1];for(var o,a=0,l=s-1;l>=a;)if(r=Math.floor(a+(l-a)/2),o=n[r]-i,0>o)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}return r=l,n[r]==i?r/(s-1):(a=n[r],n=(r+(i-a)/(n[r+1]-a))/(s-1))},THREE.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new THREE.Vector2(-e.y,e.x)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().subSelf(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return this.getTangent(this.getUtoTmapping(e))},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=new THREE.Curve,THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);return t.multiplyScalar(e).addSelf(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},THREE.QuadraticBezierCurve.prototype=new THREE.Curve,THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},THREE.CubicBezierCurve.prototype=new THREE.Curve,THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=new THREE.Curve,THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t,i=new THREE.Vector2,n=[],r=this.points;return t=(r.length-1)*e,e=Math.floor(t),t-=e,n[0]=0==e?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,i.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,t),i.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,t),i},THREE.ArcCurve=function(e,t,i,n,r,s){this.aX=e,this.aY=t,this.aRadius=i,this.aStartAngle=n,this.aEndAngle=r,this.aClockwise=s},THREE.ArcCurve.prototype=new THREE.Curve,THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.ArcCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.aRadius*Math.cos(t),t=this.aY+this.aRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,n,r){var e=.5*(i-e),n=.5*(n-t),s=r*r;return(2*t-2*i+e+n)*r*s+(-3*t+3*i-2*e-n)*s+e*r+t}},THREE.Curve.create=function(e,t){return e.prototype=new THREE.Curve,e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,i,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(e){var t,i;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,i,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i=new THREE.Vector3,n=[],r=this.points,e=(r.length-1)*e;t=Math.floor(e),e-=t,n[0]=0==t?t:t-1,n[1]=t,n[2]=t>r.length-2?r.length-1:t+1,n[3]=t>r.length-3?r.length-1:t+2,t=r[n[0]];var s=r[n[1]],o=r[n[2]],n=r[n[3]];return i.x=THREE.Curve.Utils.interpolate(t.x,s.x,o.x,n.x,e),i.y=THREE.Curve.Utils.interpolate(t.y,s.y,o.y,n.y,e),i.z=THREE.Curve.Utils.interpolate(t.z,s.z,o.z,n.z,e),i}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i=new THREE.Vector3,n=[],r=this.points;return t=(r.length-0)*e,e=Math.floor(t),t-=e,e+=e>0?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,i.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,t),i.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,t),i.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,t),i}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=new THREE.Curve,THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),e=0;i.length>e;){if(i[e]>=t)return t=i[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;n>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,i,n,r=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=n=Number.POSITIVE_INFINITY;var s,o,a,l;for(l=new THREE.Vector2,o=0,a=r.length;a>o;o++)s=r[o],s.x>e?e=s.x:i>s.x&&(i=s.x),s.y>t?t=s.y:t>s.y&&(n=s.y),l.addSelf(s.x,s.y);return{minX:i,minY:n,maxX:e,maxY:t,centroid:l.divideScalar(a)}},THREE.CurvePath.prototype.createPointsGeometry=function(e){return this.createGeometry(this.getPoints(e,!0))},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return this.createGeometry(this.getSpacedPoints(e,!0))},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,i=0;e.length>i;i++)t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,s,o,a,l=this.getBoundingBox();for(i=0,n=e.length;n>i;i++)r=e[i],s=r.x,o=r.y,a=s/l.maxX,a=t.getUtoTmapping(a,s),s=t.getPoint(a),o=t.getNormalVector(a).multiplyScalar(o),r.x=s.x+o.x,r.y=s.y+o.y;return e},THREE.EventTarget=function(){var e={};this.addEventListener=function(t,i){void 0==e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)},this.dispatchEvent=function(t){for(var i in e[t.type])e[t.type][i](t)},this.removeEventListener=function(t,i){var n=e[t].indexOf(i);-1!==n&&e[t].splice(n,1)}},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=new THREE.Object3D,THREE.Gyroscope.prototype.constructor=THREE.Gyroscope,THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=new THREE.CurvePath,THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(n[n.length-2],n[n.length-1]),new THREE.Vector2(e,t))),this.actions.push({action:THREE.PathActions.LINE_TO,args:i})},THREE.Path.prototype.quadraticCurveTo=function(e,t,i,n){var r=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(i,n))),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:r})},THREE.Path.prototype.bezierCurveTo=function(e,t,i,n,r,s){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(a[a.length-2],a[a.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(i,n),new THREE.Vector2(r,s))),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new THREE.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,e),this.curves.push(new THREE.SplineCurve(i)),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,i,n,r,s){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1],a=new THREE.ArcCurve(a.x+e,a.y+t,i,n,r,s);this.curves.push(a),a=a.getPoint(s?1:0),o.push(a.x),o.push(a.y),this.actions.push({action:THREE.PathActions.ARC,args:o})},THREE.Path.prototype.absarc=function(e,t,i,n,r,s){var o=Array.prototype.slice.call(arguments),a=new THREE.ArcCurve(e,t,i,n,r,s);this.curves.push(a),a=a.getPoint(s?1:0),o.push(a.x),o.push(a.y),this.actions.push({action:THREE.PathActions.ARC,args:o})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var i,n,r,s,o,a,l,h,c,u,d,p,f,e=e||12,m=[];for(i=0,n=this.actions.length;n>i;i++)switch(r=this.actions[i],s=r.action,r=r.args,s){case THREE.PathActions.MOVE_TO:m.push(new THREE.Vector2(r[0],r[1]));break;case THREE.PathActions.LINE_TO:m.push(new THREE.Vector2(r[0],r[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(o=r[2],a=r[3],c=r[0],u=r[1],m.length>0?(s=m[m.length-1],d=s.x,p=s.y):(s=this.actions[i-1].args,d=s[s.length-2],p=s[s.length-1]),r=1;e>=r;r++)f=r/e,s=THREE.Shape.Utils.b2(f,d,c,o),f=THREE.Shape.Utils.b2(f,p,u,a),m.push(new THREE.Vector2(s,f));break;case THREE.PathActions.BEZIER_CURVE_TO:for(o=r[4],a=r[5],c=r[0],u=r[1],l=r[2],h=r[3],m.length>0?(s=m[m.length-1],d=s.x,p=s.y):(s=this.actions[i-1].args,d=s[s.length-2],p=s[s.length-1]),r=1;e>=r;r++)f=r/e,s=THREE.Shape.Utils.b3(f,d,c,l,o),f=THREE.Shape.Utils.b3(f,p,u,h,a),m.push(new THREE.Vector2(s,f));break;case THREE.PathActions.CSPLINE_THRU:for(s=this.actions[i-1].args,f=[new THREE.Vector2(s[s.length-2],s[s.length-1])],s=e*r[0].length,f=f.concat(r[0]),f=new THREE.SplineCurve(f),r=1;s>=r;r++)m.push(f.getPointAt(r/s));break;case THREE.PathActions.ARC:for(o=r[0],a=r[1],l=r[2],c=r[3],u=!!r[5],h=r[4]-c,d=2*e,r=1;d>=r;r++)f=r/d,u||(f=1-f),f=c+f*h,s=o+l*Math.cos(f),f=a+l*Math.sin(f),m.push(new THREE.Vector2(s,f))}return i=m[m.length-1],1e-10>Math.abs(i.x-m[0].x)&&1e-10>Math.abs(i.y-m[0].y)&&m.splice(m.length-1,1),t&&m.push(m[0]),m},THREE.Path.prototype.transform=function(e,t){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(t),e)},THREE.Path.prototype.nltransform=function(e,t,i,n,r,s){var o,a,l,h,c,u=this.getPoints();for(o=0,a=u.length;a>o;o++)l=u[o],h=l.x,c=l.y,l.x=e*h+t*c+i,l.y=n*c+r*h+s;return u},THREE.Path.prototype.debug=function(e){var t=this.getBoundingBox();e||(e=document.createElement("canvas"),e.setAttribute("width",t.maxX+100),e.setAttribute("height",t.maxY+100),document.body.appendChild(e)),t=e.getContext("2d"),t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.strokeStyle="black",t.beginPath();var i,n,r,e=0;for(i=this.actions.length;i>e;e++)n=this.actions[e],r=n.args,n=n.action,n!=THREE.PathActions.CSPLINE_THRU&&t[n].apply(t,r);for(t.stroke(),t.closePath(),t.strokeStyle="red",n=this.getPoints(),e=0,i=n.length;i>e;e++)r=n[e],t.beginPath(),t.arc(r.x,r.y,1.5,0,2*Math.PI,!1),t.stroke(),t.closePath()},THREE.Path.prototype.toShapes=function(){var e,t,i,n,r=[],s=new THREE.Path;for(e=0,t=this.actions.length;t>e;e++)i=this.actions[e],n=i.args,i=i.action,i==THREE.PathActions.MOVE_TO&&0!=s.actions.length&&(r.push(s),s=new THREE.Path),s[i].apply(s,n);if(0!=s.actions.length&&r.push(s),0==r.length)return[];var o;if(n=[],e=!THREE.Shape.Utils.isClockWise(r[0].getPoints()),1==r.length)return s=r[0],o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves,n.push(o),n;if(e)for(o=new THREE.Shape,e=0,t=r.length;t>e;e++)s=r[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o.actions=s.actions,o.curves=s.curves,n.push(o),o=new THREE.Shape):o.holes.push(s);else{for(e=0,t=r.length;t>e;e++)s=r[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o&&n.push(o),o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves):o.holes.push(s);n.push(o)}return n},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=new THREE.Path,THREE.Shape.prototype.constructor=THREE.Path,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var i,n,r,s,o,a,l,h,c,u,d=e.concat(),p=d.concat(),f=[];for(o=0;t.length>o;o++){for(a=t[o],Array.prototype.push.apply(p,a),n=Number.POSITIVE_INFINITY,i=0;a.length>i;i++)for(c=a[i],u=[],h=0;d.length>h;h++)l=d[h],l=c.distanceToSquared(l),u.push(l),n>l&&(n=l,r=i,s=h);i=s-1>=0?s-1:d.length-1,n=r-1>=0?r-1:a.length-1;var m=[a[r],d[s],d[i]];h=THREE.FontUtils.Triangulate.area(m);var g=[a[r],a[n],d[s]];c=THREE.FontUtils.Triangulate.area(g),u=s,l=r,s+=1,r+=-1,0>s&&(s+=d.length),s%=d.length,0>r&&(r+=a.length),r%=a.length,i=s-1>=0?s-1:d.length-1,n=r-1>=0?r-1:a.length-1,m=[a[r],d[s],d[i]],m=THREE.FontUtils.Triangulate.area(m),g=[a[r],a[n],d[s]],g=THREE.FontUtils.Triangulate.area(g),h+c>m+g&&(s=u,r=l,0>s&&(s+=d.length),s%=d.length,0>r&&(r+=a.length),r%=a.length,i=s-1>=0?s-1:d.length-1,n=r-1>=0?r-1:a.length-1),h=d.slice(0,s),c=d.slice(s),u=a.slice(r),l=a.slice(0,r),n=[a[r],a[n],d[s]],f.push([a[r],d[s],d[i]]),f.push(n),d=h.concat(u).concat(l).concat(c)}return{shape:d,isolatedPts:f,allpoints:p}},triangulateShape:function(e,t){var i,n,r,s,o=THREE.Shape.Utils.removeHoles(e,t),a=o.allpoints,l=o.isolatedPts,o=THREE.FontUtils.Triangulate(o.shape,!1),h={};for(i=0,n=a.length;n>i;i++)s=a[i].x+":"+a[i].y,void 0!==h[s]&&console.log("Duplicate point",s),h[s]=i;for(i=0,n=o.length;n>i;i++)for(r=o[i],a=0;3>a;a++)s=r[a].x+":"+r[a].y,s=h[s],void 0!==s&&(r[a]=s);for(i=0,n=l.length;n>i;i++)for(r=l[i],a=0;3>a;a++)s=r[a].x+":"+r[a].y,s=h[s],void 0!==s&&(r[a]=s);return o.concat(l)},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},THREE.TextPath=function(e,t){THREE.Path.call(this),this.parameters=t||{},this.set(e)},THREE.TextPath.prototype.set=function(e,t){t=t||this.parameters,this.text=e;var i=void 0!==t.curveSegments?t.curveSegments:4,n=void 0!==t.font?t.font:"helvetiker",r=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=i,THREE.FontUtils.face=n,THREE.FontUtils.weight=r,THREE.FontUtils.style=s},THREE.TextPath.prototype.toShapes=function(){for(var e=THREE.FontUtils.drawText(this.text).paths,t=[],i=0,n=e.length;n>i;i++)Array.prototype.push.apply(t,e[i].toShapes());return t},THREE.AnimationHandler=function(){var e=[],t={},i={update:function(t){for(var i=0;e.length>i;i++)e[i].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},add:function(e){if(void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,e.initialized!==!0){for(var i=0;e.hierarchy.length>i;i++){for(var n=0;e.hierarchy[i].keys.length>n;n++)if(0>e.hierarchy[i].keys[n].time&&(e.hierarchy[i].keys[n].time=0),void 0!==e.hierarchy[i].keys[n].rot&&!(e.hierarchy[i].keys[n].rot instanceof THREE.Quaternion)){var r=e.hierarchy[i].keys[n].rot;e.hierarchy[i].keys[n].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}if(e.hierarchy[i].keys.length&&void 0!==e.hierarchy[i].keys[0].morphTargets){for(r={},n=0;e.hierarchy[i].keys.length>n;n++)for(var s=0;e.hierarchy[i].keys[n].morphTargets.length>s;s++){var o=e.hierarchy[i].keys[n].morphTargets[s];r[o]=-1}for(e.hierarchy[i].usedMorphTargets=r,n=0;e.hierarchy[i].keys.length>n;n++){var a={};for(o in r){for(s=0;e.hierarchy[i].keys[n].morphTargets.length>s;s++)if(e.hierarchy[i].keys[n].morphTargets[s]===o){a[o]=e.hierarchy[i].keys[n].morphTargetsInfluences[s];break}s===e.hierarchy[i].keys[n].morphTargets.length&&(a[o]=0)}e.hierarchy[i].keys[n].morphTargetsInfluences=a}}for(n=1;e.hierarchy[i].keys.length>n;n++)e.hierarchy[i].keys[n].time===e.hierarchy[i].keys[n-1].time&&(e.hierarchy[i].keys.splice(n,1),n--);for(n=0;e.hierarchy[i].keys.length>n;n++)e.hierarchy[i].keys[n].index=n}for(n=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[],i=0;e.hierarchy.length>i;i++)e.JIT.hierarchy.push(Array(n));e.initialized=!0}},get:function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;e.bones.length>i;i++)t.push(e.bones[i]);else n(e,t);return t}},n=function(e,t){t.push(e);for(var i=0;e.children.length>i;i++)n(e.children[i],t)};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),THREE.Animation=function(e,t,i,n){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==i?i:THREE.AnimationHandler.LINEAR,this.JITCompile=void 0!==n?n:!0,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var i,n,r=this.hierarchy.length;for(i=0;r>i;i++){n=this.hierarchy[i],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(n.useQuaternion=!0),n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);var s=n.animationCache.prevKey;n=n.animationCache.nextKey,s.pos=this.data.hierarchy[i].keys[0],s.rot=this.data.hierarchy[i].keys[0],s.scl=this.data.hierarchy[i].keys[0],n.pos=this.getNextKeyWith("pos",i,1),n.rot=this.getNextKeyWith("rot",i,1),n.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;this.hierarchy.length>e;e++)void 0!==this.hierarchy[e].animationCache&&(this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix=this.hierarchy[e].animationCache.originalMatrix:this.hierarchy[e].matrix=this.hierarchy[e].animationCache.originalMatrix,delete this.hierarchy[e].animationCache)},THREE.Animation.prototype.update=function(e){if(this.isPlaying){var t,i,n,r,s,o,a,l,h,c,u=["pos","rot","scl"],d=this.data.JIT.hierarchy;c=this.currentTime=this.currentTime+e*this.timeScale,h=this.currentTime=this.currentTime%this.data.length,l=parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);for(var p=0,f=this.hierarchy.length;f>p;p++)if(e=this.hierarchy[p],a=e.animationCache,this.JITCompile&&void 0!==d[p][l])e instanceof THREE.Bone?(e.skinMatrix=d[p][l],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!1):(e.matrix=d[p][l],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(e instanceof THREE.Bone?e.skinMatrix=e.animationCache.originalMatrix:e.matrix=e.animationCache.originalMatrix);for(var m=0;3>m;m++){if(t=u[m],s=a.prevKey[t],o=a.nextKey[t],c>=o.time){if(c>h){if(!this.loop)return this.stop(),void 0;for(s=this.data.hierarchy[p].keys[0],o=this.getNextKeyWith(t,p,1);h>o.time;)s=o,o=this.getNextKeyWith(t,p,o.index+1)}else do s=o,o=this.getNextKeyWith(t,p,o.index+1);while(h>o.time);a.prevKey[t]=s,a.nextKey[t]=o}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,i=(h-s.time)/(o.time-s.time),n=s[t],r=o[t],(0>i||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+p),i=0>i?0:1),"pos"===t?(t=e.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(t.x=n[0]+(r[0]-n[0])*i,t.y=n[1]+(r[1]-n[1])*i,t.z=n[2]+(r[2]-n[2])*i):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",p,s.index-1).pos,this.points[1]=n,this.points[2]=r,this.points[3]=this.getNextKeyWith("pos",p,o.index+1).pos,i=.33*i+.33,n=this.interpolateCatmullRom(this.points,i),t.x=n[0],t.y=n[1],t.z=n[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(i=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(i[0],i[1],i[2]),this.target.subSelf(t),this.target.y=0,this.target.normalize(),i=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,i,0)))):"rot"===t?THREE.Quaternion.slerp(n,r,e.quaternion,i):"scl"===t&&(t=e.scale,t.x=n[0]+(r[0]-n[0])*i,t.y=n[1]+(r[1]-n[1])*i,t.z=n[2]+(r[2]-n[2])*i)}}if(this.JITCompile&&void 0===d[0][l])for(this.hierarchy[0].updateMatrixWorld(!0),p=0;this.hierarchy.length>p;p++)d[p][l]=this.hierarchy[p]instanceof THREE.Bone?this.hierarchy[p].skinMatrix.clone():this.hierarchy[p].matrix.clone()}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i,n,r,s,o,a,l=[],h=[];return i=(e.length-1)*t,n=Math.floor(i),i-=n,l[0]=0===n?n:n-1,l[1]=n,l[2]=n>e.length-2?n:n+1,l[3]=n>e.length-3?n:n+2,n=e[l[0]],s=e[l[1]],o=e[l[2]],a=e[l[3]],l=i*i,r=i*l,h[0]=this.interpolate(n[0],s[0],o[0],a[0],i,l,r),h[1]=this.interpolate(n[1],s[1],o[1],a[1],i,l,r),h[2]=this.interpolate(n[2],s[2],o[2],a[2],i,l,r),h},THREE.Animation.prototype.interpolate=function(e,t,i,n,r,s,o){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*o+(-3*(t-i)-2*e-n)*s+e*r+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,i){for(var n=this.data.hierarchy[t].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n.length-1>i?i:n.length-1:i%n.length;n.length>i;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){for(var n=this.data.hierarchy[t].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]},THREE.KeyFrameAnimation=function(e,t,i){for(this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0!==i?i:!0,e=0,t=this.hierarchy.length;t>e;e++){var i=this.data.hierarchy[e].sids,n=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&i){for(var r=0;i.length>r;r++){var s=i[r],o=this.getNextKeyWith(s,e,0);o&&o.apply(s)}n.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,n,r,s=this.hierarchy.length;for(i=0;s>i;i++)n=this.hierarchy[i],r=this.data.hierarchy[i],n.useQuaternion=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix),n=this.data.hierarchy[i].keys,n.length&&(r.animationCache.prevKey=n[0],r.animationCache.nextKey=n[1],this.startTime=Math.min(n[0].time,this.startTime),this.endTime=Math.max(n[n.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;this.data.hierarchy.length>e;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;t instanceof THREE.Bone?(n.copy(t.skinMatrix),t.skinMatrix=n):(n.copy(t.matrix),t.matrix=n),delete i.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,n,r,s,o,a,l=this.data.JIT.hierarchy;if(o=this.currentTime=this.currentTime+e*this.timeScale,s=this.currentTime=this.currentTime%this.data.length,this.startTimeMs>s&&(s=this.currentTime=this.startTimeMs+s),r=parseInt(Math.min(s*this.data.fps,this.data.length*this.data.fps),10),(a=o>s)&&!this.loop){for(var e=0,h=this.hierarchy.length;h>e;e++){var c=this.data.hierarchy[e].keys,l=this.data.hierarchy[e].sids;if(n=c.length-1,r=this.hierarchy[e],c.length){for(c=0;l.length>c;c++)s=l[c],(o=this.getPrevKeyWith(s,e,n))&&o.apply(s);this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(this.startTime>s)){for(e=0,h=this.hierarchy.length;h>e;e++){n=this.hierarchy[e],t=this.data.hierarchy[e];var c=t.keys,u=t.animationCache;if(this.JITCompile&&void 0!==l[e][r])n instanceof THREE.Bone?(n.skinMatrix=l[e][r],n.matrixWorldNeedsUpdate=!1):(n.matrix=l[e][r],n.matrixWorldNeedsUpdate=!0);else if(c.length){if(this.JITCompile&&u&&(n instanceof THREE.Bone?n.skinMatrix=u.originalMatrix:n.matrix=u.originalMatrix),t=u.prevKey,i=u.nextKey,t&&i){if(o>=i.time){if(a&&this.loop)for(t=c[0],i=c[1];s>i.time;)t=i,i=c[t.index+1];else if(!a)for(var d=c.length-1;s>i.time&&i.index!==d;)t=i,i=c[t.index+1];u.prevKey=t,u.nextKey=i}i.time>=s?t.interpolate(i,s):t.interpolate(i,i.time)}this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===l[0][r])for(this.hierarchy[0].updateMatrixWorld(!0),e=0;this.hierarchy.length>e;e++)l[e][r]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i%=t.length;t.length>i;i++)if(t[i].hasTarget(e))return t[i];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i=i>=0?i:i+t.length;i>=0;i--)if(t[i].hasTarget(e))return t[i];
return t[t.length-1]},THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var n=new THREE.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new THREE.Vector3(1,0,0)),this.add(n);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(-1,0,0)),this.add(r);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new THREE.Vector3(0,-1,0)),this.add(o);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(0,0,1)),this.add(a);var l=new THREE.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,-1)),this.add(l),this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,h=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,n,i),i.activeCubeFace=1,e.render(t,r,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,o,i),i.activeCubeFace=4,e.render(t,a,i),i.generateMipmaps=h,i.activeCubeFace=5,e.render(t,l,i)}},THREE.CubeCamera.prototype=new THREE.Object3D,THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.CombinedCamera=function(e,t,i,n,r,s,o){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(i,e/t,n,r),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=new THREE.Camera,THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera,THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPersepectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPersepectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPersepectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){var i=2*Math.atan((void 0!==t?t:24)/(2*e))*(180/Math.PI);return this.setFov(i),i},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.FirstPersonControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1)),this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){var t=0;if(!this.freeze){this.heightSpeed?(t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin,this.autoSpeedFactor=e*t*this.heightCoef):this.autoSpeedFactor=0,t=e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t),e*=this.lookSpeed,this.activeLook||(e=0),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var t=this.target,i=this.object.position;t.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=i.y+100*Math.cos(this.phi),t.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta),t=1,this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin)),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),t=this.target,i=this.object.position,t.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=i.y+100*Math.cos(this.phi),t.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(t)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",i(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",i(this,this.onKeyUp),!1)},THREE.PathControls=function(e,t){function i(e){return 1>(e=2*e)?.5*e*e:-.5*(--e*(e-2)-1)}function n(e,t){return function(){t.apply(e,arguments)}}function r(e,t,i,n){var r,s={name:i,fps:.6,length:n,hierarchy:[]},o=t.getControlPointsArray(),a=t.getLength(),l=o.length,h=0;for(r=l-1,t={parent:-1,keys:[]},t.keys[0]={time:0,pos:o[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[r]={time:n,pos:o[r],rot:[0,0,0,1],scl:[1,1,1]},r=1;l-1>r;r++)h=n*a.chunks[r]/a.total,t.keys[r]={time:h,pos:o[r]};return s.hierarchy[0]=t,THREE.AnimationHandler.add(s),new THREE.Animation(e,i,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function s(e,t){var i,n,r=new THREE.Geometry;for(i=0;e.points.length*t>i;i++)n=i/(e.points.length*t),n=e.getPoint(n),r.vertices[i]=new THREE.Vector3(n.x,n.y,n.z);return r}this.object=e,this.domElement=void 0!==t?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var o=2*Math.PI,a=Math.PI/180;this.update=function(e){var t;this.lookHorizontal&&(this.lon=this.lon+this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat=this.lat-this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*a,this.theta=this.lon*a,e=this.phi%o,this.phi=e>=0?e:e+o,t=this.verticalAngleMap.srcRange,e=this.verticalAngleMap.dstRange,t=THREE.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var n=e[1]-e[0];this.phi=i((t-e[0])/n)*n+e[0],t=this.horizontalAngleMap.srcRange,e=this.horizontalAngleMap.dstRange,t=THREE.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]),n=e[1]-e[0],this.theta=i((t-e[0])/n)*n+e[0],e=this.target.position,e.x=100*Math.sin(this.phi)*Math.cos(this.theta),e.y=100*Math.cos(this.phi),e.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){if(this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),i=new THREE.CubeGeometry(10,10,20),o=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(i,e),e=new THREE.Mesh(o,t),e.position.set(0,10,0),this.animation=r(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(e)}else this.animation=r(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var e=this.debugPath,t=this.spline,o=s(t,10),i=s(t,10),a=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),o=new THREE.Line(o,a),i=new THREE.ParticleSystem(i,new THREE.ParticleBasicMaterial({color:16755200,size:3}));o.scale.set(1,1,1),e.add(o),i.scale.set(1,1,1),e.add(i);for(var o=new THREE.SphereGeometry(1,16,8),a=new THREE.MeshBasicMaterial({color:65280}),l=0;t.points.length>l;l++)i=new THREE.Mesh(o,a),i.position.copy(t.points[l]),e.add(i)}this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1)}},THREE.PathControlsIdCounter=0,THREE.FlyControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),i=t.size[0]/2,n=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-i)/i,this.moveState.pitchDown=(e.pageY-t.offset[1]-n)/n,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,e=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",i(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",i(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",i(this,this.mouseup),!1),this.domElement.addEventListener("keydown",i(this,this.keydown),!1),this.domElement.addEventListener("keyup",i(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.RollControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Matrix4,o=!1,a=1,l=0,h=0,c=0,u=0,d=0,p=window.innerWidth/2,f=window.innerHeight/2;this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*u),this.rotateVertically(t*d)}t=e*this.movementSpeed,this.object.translateZ(-t*(l>0||this.autoForward&&!(0>l)?1:l)),this.object.translateX(t*h),this.object.translateY(t*c),o&&(this.roll=this.roll+this.rollSpeed*e*a),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),r.copy(this.forward),n.set(0,1,0),i.cross(n,r).normalize(),n.cross(r,i).normalize(),this.object.matrix.elements[0]=i.x,this.object.matrix.elements[4]=n.x,this.object.matrix.elements[8]=r.x,this.object.matrix.elements[1]=i.y,this.object.matrix.elements[5]=n.y,this.object.matrix.elements[9]=r.y,this.object.matrix.elements[2]=i.z,this.object.matrix.elements[6]=n.z,this.object.matrix.elements[10]=r.z,s.identity(),s.elements[0]=Math.cos(this.roll),s.elements[4]=-Math.sin(this.roll),s.elements[1]=Math.sin(this.roll),s.elements[5]=Math.cos(this.roll),this.object.matrix.multiplySelf(s),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*e},this.translateY=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*e},this.translateZ=function(e){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*e,this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*e,this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*e},this.rotateHorizontally=function(e){i.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),i.multiplyScalar(e),this.forward.subSelf(i),this.forward.normalize()},this.rotateVertically=function(e){n.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),n.multiplyScalar(e),this.forward.addSelf(n),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){u=(e.clientX-p)/window.innerWidth,d=(e.clientY-f)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:l=1;break;case 2:l=-1}},!1),this.domElement.addEventListener("mouseup",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:l=0;break;case 2:l=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:l=1;break;case 37:case 65:h=-1;break;case 40:case 83:l=-1;break;case 39:case 68:h=1;break;case 81:o=!0,a=1;break;case 69:o=!0,a=-1;break;case 82:c=1;break;case 70:c=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:l=0;break;case 37:case 65:h=0;break;case 40:case 83:l=0;break;case 39:case 68:h=0;break;case 81:o=!1;break;case 69:o=!1;break;case 82:c=0;break;case 70:c=0}},!1)},THREE.TrackballControls=function(e,t){THREE.EventTarget.call(this);var i=this;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var n=new THREE.Vector3,r=!1,s=-1,o=new THREE.Vector3,a=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector2,c=new THREE.Vector2,u=new THREE.Vector2,d=new THREE.Vector2,p={type:"change"};this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2(.5*((e-i.screen.offsetLeft)/i.radius),.5*((t-i.screen.offsetTop)/i.radius))},this.getMouseProjectionOnBall=function(e,t){var n=new THREE.Vector3((e-.5*i.screen.width-i.screen.offsetLeft)/i.radius,(.5*i.screen.height+i.screen.offsetTop-t)/i.radius,0),r=n.length();return r>1?n.normalize():n.z=Math.sqrt(1-r*r),o.copy(i.object.position).subSelf(i.target),r=i.object.up.clone().setLength(n.y),r.addSelf(i.object.up.clone().crossSelf(o).setLength(n.x)),r.addSelf(o.setLength(n.z)),r},this.rotateCamera=function(){var e=Math.acos(a.dot(l)/a.length()/l.length());if(e){var t=(new THREE.Vector3).cross(a,l).normalize(),n=new THREE.Quaternion,e=e*i.rotateSpeed;n.setFromAxisAngle(t,-e),n.multiplyVector3(o),n.multiplyVector3(i.object.up),n.multiplyVector3(l),i.staticMoving?a=l:(n.setFromAxisAngle(t,e*(i.dynamicDampingFactor-1)),n.multiplyVector3(a))}},this.zoomCamera=function(){var e=1+(c.y-h.y)*i.zoomSpeed;1!==e&&e>0&&(o.multiplyScalar(e),i.staticMoving?h=c:h.y=h.y+(c.y-h.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=d.clone().subSelf(u);if(e.lengthSq()){e.multiplyScalar(o.length()*i.panSpeed);var t=o.clone().crossSelf(i.object.up).setLength(e.x);t.addSelf(i.object.up.clone().setLength(e.y)),i.object.position.addSelf(t),i.target.addSelf(t),i.staticMoving?u=d:u.addSelf(e.sub(d,u).multiplyScalar(i.dynamicDampingFactor))}},this.checkDistances=function(){i.noZoom&&i.noPan||(i.object.position.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.setLength(i.maxDistance),o.lengthSq()<i.minDistance*i.minDistance&&i.object.position.add(i.target,o.setLength(i.minDistance)))},this.update=function(){o.copy(i.object.position).subSelf(i.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.object.position.add(i.target,o),i.checkDistances(),i.object.lookAt(i.target),n.distanceTo(i.object.position)>0&&(i.dispatchEvent(p),n.copy(i.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){i.enabled&&(r&&(a=l=i.getMouseProjectionOnBall(e.clientX,e.clientY),h=c=i.getMouseOnScreen(e.clientX,e.clientY),u=d=i.getMouseOnScreen(e.clientX,e.clientY),r=!1),-1!==s&&(0!==s||i.noRotate?1!==s||i.noZoom?2===s&&!i.noPan&&(d=i.getMouseOnScreen(e.clientX,e.clientY)):c=i.getMouseOnScreen(e.clientX,e.clientY):l=i.getMouseProjectionOnBall(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mousedown",function(e){i.enabled&&(e.preventDefault(),e.stopPropagation(),-1===s&&(s=e.button,0!==s||i.noRotate?1!==s||i.noZoom?this.noPan||(u=d=i.getMouseOnScreen(e.clientX,e.clientY)):h=c=i.getMouseOnScreen(e.clientX,e.clientY):a=l=i.getMouseProjectionOnBall(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mouseup",function(e){i.enabled&&(e.preventDefault(),e.stopPropagation(),s=-1)},!1),window.addEventListener("keydown",function(e){i.enabled&&-1===s&&(e.keyCode!==i.keys[0]||i.noRotate?e.keyCode!==i.keys[1]||i.noZoom?e.keyCode===i.keys[2]&&!i.noPan&&(s=2):s=1:s=0,-1!==s&&(r=!0))},!1),window.addEventListener("keyup",function(){i.enabled&&-1!==s&&(s=-1)},!1)},THREE.CubeGeometry=function(e,t,i,n,r,s,o,a){function l(e,t,i,o,a,l,h,c){var u,d=n||1,p=r||1,f=a/2,g=l/2,y=m.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?u="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(u="y",p=s||1):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(u="x",d=s||1);var v=d+1,b=p+1,x=a/d,L=l/p,w=new THREE.Vector3;for(w[u]=h>0?1:-1,a=0;b>a;a++)for(l=0;v>l;l++){var C=new THREE.Vector3;C[e]=(l*x-f)*i,C[t]=(a*L-g)*o,C[u]=h,m.vertices.push(C)}for(a=0;p>a;a++)for(l=0;d>l;l++)e=new THREE.Face4(l+v*a+y,l+v*(a+1)+y,l+1+v*(a+1)+y,l+1+v*a+y),e.normal.copy(w),e.vertexNormals.push(w.clone(),w.clone(),w.clone(),w.clone()),e.materialIndex=c,m.faces.push(e),m.faceVertexUvs[0].push([new THREE.UV(l/d,a/p),new THREE.UV(l/d,(a+1)/p),new THREE.UV((l+1)/d,(a+1)/p),new THREE.UV((l+1)/d,a/p)])}THREE.Geometry.call(this);var h,c,u,d,p,f,m=this,g=e/2,y=t/2,v=i/2;if(void 0!==o){if(o instanceof Array)this.materials=o;else for(this.materials=[],h=0;6>h;h++)this.materials.push(o);h=0,d=1,c=2,p=3,u=4,f=5}else this.materials=[];if(this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0},void 0!=a)for(var b in a)void 0!==this.sides[b]&&(this.sides[b]=a[b]);this.sides.px&&l("z","y",-1,-1,i,t,g,h),this.sides.nx&&l("z","y",1,-1,i,t,-g,d),this.sides.py&&l("x","z",1,1,e,i,y,c),this.sides.ny&&l("x","z",1,-1,e,i,-y,p),this.sides.pz&&l("x","y",1,-1,e,t,v,u),this.sides.nz&&l("x","y",-1,-1,e,t,-v,f),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=new THREE.Geometry,THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry,THREE.CylinderGeometry=function(e,t,i,n,r,s){THREE.Geometry.call(this);var o,a,e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,l=i/2,n=n||8,r=r||1,h=[],c=[];for(a=0;r>=a;a++){var u=[],d=[],p=a/r,f=p*(t-e)+e;for(o=0;n>=o;o++){var m=o/n,g=new THREE.Vector3;g.x=f*Math.sin(2*m*Math.PI),g.y=-p*i+l,g.z=f*Math.cos(2*m*Math.PI),this.vertices.push(g),u.push(this.vertices.length-1),d.push(new THREE.UV(m,p))}h.push(u),c.push(d)}for(i=(t-e)/i,o=0;n>o;o++)for(0!==e?(u=this.vertices[h[0][o]].clone(),d=this.vertices[h[0][o+1]].clone()):(u=this.vertices[h[1][o]].clone(),d=this.vertices[h[1][o+1]].clone()),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*i).normalize(),d.setY(Math.sqrt(d.x*d.x+d.z*d.z)*i).normalize(),a=0;r>a;a++){var p=h[a][o],f=h[a+1][o],m=h[a+1][o+1],g=h[a][o+1],y=u.clone(),v=u.clone(),b=d.clone(),x=d.clone(),L=c[a][o].clone(),w=c[a+1][o].clone(),C=c[a+1][o+1].clone(),S=c[a][o+1].clone();this.faces.push(new THREE.Face4(p,f,m,g,[y,v,b,x])),this.faceVertexUvs[0].push([L,w,C,S])}if(!s&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),o=0;n>o;o++)p=h[0][o],f=h[0][o+1],m=this.vertices.length-1,y=new THREE.Vector3(0,1,0),v=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),L=c[0][o].clone(),w=c[0][o+1].clone(),C=new THREE.UV(w.u,0),this.faces.push(new THREE.Face3(p,f,m,[y,v,b])),this.faceVertexUvs[0].push([L,w,C]);if(!s&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),o=0;n>o;o++)p=h[a][o+1],f=h[a][o],m=this.vertices.length-1,y=new THREE.Vector3(0,-1,0),v=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),L=c[a][o+1].clone(),w=c[a][o].clone(),C=new THREE.UV(w.u,1),this.faces.push(new THREE.Face3(p,f,m,[y,v,b])),this.faceVertexUvs[0].push([L,w,C]);this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=new THREE.Geometry,THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(e,t){e!==void 0&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=new THREE.Geometry,THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;i>n;n++)this.addShape(e[n],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).addSelf(e)}function n(e,t,i){var n=THREE.ExtrudeGeometry.__v1,r=THREE.ExtrudeGeometry.__v2,s=THREE.ExtrudeGeometry.__v3,o=THREE.ExtrudeGeometry.__v4,a=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6;return n.set(e.x-t.x,e.y-t.y),r.set(e.x-i.x,e.y-i.y),n=n.normalize(),r=r.normalize(),s.set(-n.y,n.x),o.set(r.y,-r.x),a.copy(e).addSelf(s),l.copy(e).addSelf(o),a.equals(l)?o.clone():(a.copy(t).addSelf(s),l.copy(i).addSelf(o),s=n.dot(o),o=l.subSelf(a).dot(o),0===s&&(console.log("Either infinite or no solutions!"),0===o?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),o/=s,0>o?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(i.y-e.y,i.x-e.x),t>e&&(e+=2*Math.PI),i=(t+e)/2,e=-Math.cos(i),i=-Math.sin(i),new THREE.Vector2(e,i)):n.multiplyScalar(o).addSelf(a).subSelf(e).clone())}function r(i,n){var r,s;for(G=i.length;--G>=0;){r=G,s=G-1,0>s&&(s=i.length-1);for(var o=0,a=y+2*m,o=0;a>o;o++){var l=F*o,h=F*(o+1),c=n+r+l,l=n+s+l,u=n+s+h,h=n+r+h,d=i,p=o,f=a,c=c+_,l=l+_,u=u+_,h=h+_;O.faces.push(new THREE.Face4(c,l,u,h,null,null,w)),c=U.generateSideWallUV(O,e,d,t,c,l,u,h,p,f),O.faceVertexUvs[0].push(c)}}}function s(e,t,i){O.vertices.push(new THREE.Vector3(e,t,i))}function o(i,n,r,s){i+=_,n+=_,r+=_,O.faces.push(new THREE.Face3(i,n,r,null,null,L)),i=s?U.generateBottomUV(O,e,t,i,n,r):U.generateTopUV(O,e,t,i,n,r),O.faceVertexUvs[0].push(i)}var a,l,h,c,u,d=void 0!==t.amount?t.amount:100,p=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:p-2,m=void 0!==t.bevelSegments?t.bevelSegments:3,g=void 0!==t.bevelEnabled?t.bevelEnabled:!0,y=void 0!==t.steps?t.steps:1,v=t.bendPath,b=t.extrudePath,x=!1,L=t.material,w=t.extrudeMaterial;b&&(a=b.getSpacedPoints(y),x=!0,g=!1,l=new THREE.TubeGeometry.FrenetFrames(b,y,!1),h=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3),g||(f=p=m=0);var C,S,E,O=this,_=this.vertices.length;v&&e.addWrapPath(v);var b=e.extractPoints(),v=b.shape,T=b.holes;if(b=!THREE.Shape.Utils.isClockWise(v)){for(v=v.reverse(),S=0,E=T.length;E>S;S++)C=T[S],THREE.Shape.Utils.isClockWise(C)&&(T[S]=C.reverse());b=!1}var k=THREE.Shape.Utils.triangulateShape(v,T),P=v;for(S=0,E=T.length;E>S;S++)C=T[S],v=v.concat(C);var A,M,N,R,D,I,F=v.length,B=k.length,b=[],G=0;for(N=P.length,A=N-1,M=G+1;N>G;G++,A++,M++)A===N&&(A=0),M===N&&(M=0),b[G]=n(P[G],P[A],P[M]);var j,z=[],X=b.concat();for(S=0,E=T.length;E>S;S++){for(C=T[S],j=[],G=0,N=C.length,A=N-1,M=G+1;N>G;G++,A++,M++)A===N&&(A=0),M===N&&(M=0),j[G]=n(C[G],C[A],C[M]);z.push(j),X=X.concat(j)}for(A=0;m>A;A++){for(N=A/m,R=p*(1-N),M=f*Math.sin(N*Math.PI/2),G=0,N=P.length;N>G;G++)D=i(P[G],b[G],M),s(D.x,D.y,-R);for(S=0,E=T.length;E>S;S++)for(C=T[S],j=z[S],G=0,N=C.length;N>G;G++)D=i(C[G],j[G],M),s(D.x,D.y,-R)}for(M=f,G=0;F>G;G++)D=g?i(v[G],X[G],M):v[G],x?(c.copy(l.normals[0]).multiplyScalar(D.x),h.copy(l.binormals[0]).multiplyScalar(D.y),u.copy(a[0]).addSelf(c).addSelf(h),s(u.x,u.y,u.z)):s(D.x,D.y,0);for(N=1;y>=N;N++)for(G=0;F>G;G++)D=g?i(v[G],X[G],M):v[G],x?(c.copy(l.normals[N]).multiplyScalar(D.x),h.copy(l.binormals[N]).multiplyScalar(D.y),u.copy(a[N]).addSelf(c).addSelf(h),s(u.x,u.y,u.z)):s(D.x,D.y,d/y*N);for(A=m-1;A>=0;A--){for(N=A/m,R=p*(1-N),M=f*Math.sin(N*Math.PI/2),G=0,N=P.length;N>G;G++)D=i(P[G],b[G],M),s(D.x,D.y,d+R);for(S=0,E=T.length;E>S;S++)for(C=T[S],j=z[S],G=0,N=C.length;N>G;G++)D=i(C[G],j[G],M),x?s(D.x,D.y+a[y-1].y,a[y-1].x+R):s(D.x,D.y,d+R)}var U=THREE.ExtrudeGeometry.WorldUVGenerator;(function(){if(g){var e;for(e=0*F,G=0;B>G;G++)I=k[G],o(I[2]+e,I[1]+e,I[0]+e,!0);for(e=y+2*m,e=F*e,G=0;B>G;G++)I=k[G],o(I[0]+e,I[1]+e,I[2]+e,!1)
}else{for(G=0;B>G;G++)I=k[G],o(I[2],I[1],I[0],!0);for(G=0;B>G;G++)I=k[G],o(I[0]+F*y,I[1]+F*y,I[2]+F*y,!1)}})(),function(){var e=0;for(r(P,e),e+=P.length,S=0,E=T.length;E>S;S++)C=T[S],r(C,e),e+=C.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,n,r,s){return t=e.vertices[r].x,r=e.vertices[r].y,i=e.vertices[s].x,s=e.vertices[s].y,[new THREE.UV(e.vertices[n].x,1-e.vertices[n].y),new THREE.UV(t,1-r),new THREE.UV(i,1-s)]},generateBottomUV:function(e,t,i,n,r,s){return this.generateTopUV(e,t,i,n,r,s)},generateSideWallUV:function(e,t,i,n,r,s,o,a){var t=e.vertices[r].x,i=e.vertices[r].y,r=e.vertices[r].z,n=e.vertices[s].x,l=e.vertices[s].y,s=e.vertices[s].z,h=e.vertices[o].x,c=e.vertices[o].y,o=e.vertices[o].z,u=e.vertices[a].x,d=e.vertices[a].y,e=e.vertices[a].z;return.01>Math.abs(i-l)?[new THREE.UV(t,r),new THREE.UV(n,s),new THREE.UV(h,o),new THREE.UV(u,e)]:[new THREE.UV(i,r),new THREE.UV(l,s),new THREE.UV(c,o),new THREE.UV(d,e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.LatheGeometry=function(e,t,i){THREE.Geometry.call(this);for(var t=t||12,i=i||2*Math.PI,n=[],r=(new THREE.Matrix4).makeRotationZ(i/t),s=0;e.length>s;s++)n[s]=e[s].clone(),this.vertices.push(n[s]);for(var o=t+1,i=0;o>i;i++)for(s=0;n.length>s;s++)n[s]=r.multiplyVector3(n[s].clone()),this.vertices.push(n[s]);for(i=0;t>i;i++)for(n=0,r=e.length;r-1>n;n++)this.faces.push(new THREE.Face4(i*r+n,(i+1)%o*r+n,(i+1)%o*r+(n+1)%r,i*r+(n+1)%r)),this.faceVertexUvs[0].push([new THREE.UV(1-i/t,n/r),new THREE.UV(1-(i+1)/t,n/r),new THREE.UV(1-(i+1)/t,(n+1)/r),new THREE.UV(1-i/t,(n+1)/r)]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=new THREE.Geometry,THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,i,n){THREE.Geometry.call(this);for(var r=e/2,s=t/2,i=i||1,n=n||1,o=i+1,a=n+1,l=e/i,h=t/n,c=new THREE.Vector3(0,1,0),e=0;a>e;e++)for(t=0;o>t;t++)this.vertices.push(new THREE.Vector3(t*l-r,0,e*h-s));for(e=0;n>e;e++)for(t=0;i>t;t++)r=new THREE.Face4(t+o*e,t+o*(e+1),t+1+o*(e+1),t+1+o*e),r.normal.copy(c),r.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),this.faces.push(r),this.faceVertexUvs[0].push([new THREE.UV(t/i,e/n),new THREE.UV(t/i,(e+1)/n),new THREE.UV((t+1)/i,(e+1)/n),new THREE.UV((t+1)/i,e/n)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=new THREE.Geometry,THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.SphereGeometry=function(e,t,i,n,r,s,o){THREE.Geometry.call(this);var a,l,e=e||50,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,s=void 0!==s?s:0,o=void 0!==o?o:Math.PI,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),h=[],c=[];for(l=0;i>=l;l++){var u=[],d=[];for(a=0;t>=a;a++){var p=a/t,f=l/i,m=new THREE.Vector3;m.x=-e*Math.cos(n+p*r)*Math.sin(s+f*o),m.y=e*Math.cos(s+f*o),m.z=e*Math.sin(n+p*r)*Math.sin(s+f*o),this.vertices.push(m),u.push(this.vertices.length-1),d.push(new THREE.UV(p,f))}h.push(u),c.push(d)}for(l=0;i>l;l++)for(a=0;t>a;a++){var n=h[l][a+1],r=h[l][a],s=h[l+1][a],o=h[l+1][a+1],u=this.vertices[n].clone().normalize(),d=this.vertices[r].clone().normalize(),p=this.vertices[s].clone().normalize(),f=this.vertices[o].clone().normalize(),m=c[l][a+1].clone(),g=c[l][a].clone(),y=c[l+1][a].clone(),v=c[l+1][a+1].clone();Math.abs(this.vertices[n].y)==e?(this.faces.push(new THREE.Face3(n,s,o,[u,p,f])),this.faceVertexUvs[0].push([m,y,v])):Math.abs(this.vertices[s].y)==e?(this.faces.push(new THREE.Face3(n,r,s,[u,d,p])),this.faceVertexUvs[0].push([m,g,y])):(this.faces.push(new THREE.Face4(n,r,s,o,[u,d,p,f])),this.faceVertexUvs[0].push([m,g,y,v]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},THREE.SphereGeometry.prototype=new THREE.Geometry,THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(e,t){var i=new THREE.TextPath(e,t).toShapes();if(t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),t.bend){var n=i[i.length-1].getBoundingBox().maxX;t.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(n/2,120),new THREE.Vector2(n,0))}THREE.ExtrudeGeometry.call(this,i,t)},THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry,THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),i=this.size/t.resolution,n=0,r=(""+e).split(""),s=r.length,o=[],e=0;s>e;e++){var a=new THREE.Path,a=this.extractGlyphPoints(r[e],t,i,n,a),n=n+a.offset;o.push(a.path)}return{paths:o,offset:n/2}},extractGlyphPoints:function(e,t,i,n,r){var s,o,a,l,h,c,u,d,p,f,m,g=[],y=t.glyphs[e]||t.glyphs["?"];if(y){if(y.o)for(t=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),l=t.length,e=0;l>e;)switch(a=t[e++]){case"m":a=t[e++]*i+n,h=t[e++]*i,g.push(new THREE.Vector2(a,h)),r.moveTo(a,h);break;case"l":a=t[e++]*i+n,h=t[e++]*i,g.push(new THREE.Vector2(a,h)),r.lineTo(a,h);break;case"q":if(a=t[e++]*i+n,h=t[e++]*i,d=t[e++]*i+n,p=t[e++]*i,r.quadraticCurveTo(d,p,a,h),s=g[g.length-1])for(c=s.x,u=s.y,s=1,o=this.divisions;o>=s;s++){var v=s/o,b=THREE.Shape.Utils.b2(v,c,d,a),v=THREE.Shape.Utils.b2(v,u,p,h);g.push(new THREE.Vector2(b,v))}break;case"b":if(a=t[e++]*i+n,h=t[e++]*i,d=t[e++]*i+n,p=t[e++]*-i,f=t[e++]*i+n,m=t[e++]*-i,r.bezierCurveTo(a,h,d,p,f,m),s=g[g.length-1])for(c=s.x,u=s.y,s=1,o=this.divisions;o>=s;s++)v=s/o,b=THREE.Shape.Utils.b3(v,c,d,f,a),v=THREE.Shape.Utils.b3(v,u,p,m,h),g.push(new THREE.Vector2(b,v))}return{offset:y.ha*i,points:g,path:r}}}},function(e){var t=function(e){for(var t=e.length,i=0,n=t-1,r=0;t>r;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i};return e.Triangulate=function(e,i){var n=e.length;if(3>n)return null;var r,s,o,a=[],l=[],h=[];if(t(e)>0)for(s=0;n>s;s++)l[s]=s;else for(s=0;n>s;s++)l[s]=n-1-s;var c=2*n;for(s=n-1;n>2;){if(0>=c--){console.log("Warning, unable to triangulate polygon!");break}r=s,r>=n&&(r=0),s=r+1,s>=n&&(s=0),o=s+1,o>=n&&(o=0);var u;e:{u=e;var d=r,p=s,f=o,m=n,g=l,y=void 0,v=void 0,b=void 0,x=void 0,L=void 0,w=void 0,C=void 0,S=void 0,E=void 0,v=u[g[d]].x,b=u[g[d]].y,x=u[g[p]].x,L=u[g[p]].y,w=u[g[f]].x,C=u[g[f]].y;if(1e-10>(x-v)*(C-b)-(L-b)*(w-v))u=!1;else{for(y=0;m>y;y++)if(y!=d&&y!=p&&y!=f){var S=u[g[y]].x,E=u[g[y]].y,O=void 0,_=void 0,T=void 0,k=void 0,P=void 0,A=void 0,M=void 0,N=void 0,R=void 0,D=void 0,I=void 0,F=void 0,O=T=P=void 0,O=w-x,_=C-L,T=v-w,k=b-C,P=x-v,A=L-b,M=S-v,N=E-b,R=S-x,D=E-L,I=S-w,F=E-C,O=O*D-_*R,P=P*N-A*M,T=T*F-k*I;if(O>=0&&T>=0&&P>=0){u=!1;break e}}u=!0}}if(u){for(a.push([e[l[r]],e[l[s]],e[l[o]]]),h.push([l[r],l[s],l[o]]),r=s,o=s+1;n>o;r++,o++)l[r]=l[o];n--,c=2*n}}return i?h:a},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.TorusGeometry=function(e,t,i,n,r){for(THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=i||8,this.segmentsT=n||6,this.arc=r||2*Math.PI,r=new THREE.Vector3,e=[],t=[],i=0;this.segmentsR>=i;i++)for(n=0;this.segmentsT>=n;n++){var s=n/this.segmentsT*this.arc,o=2*i/this.segmentsR*Math.PI;r.x=this.radius*Math.cos(s),r.y=this.radius*Math.sin(s);var a=new THREE.Vector3;a.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),a.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),a.z=this.tube*Math.sin(o),this.vertices.push(a),e.push(new THREE.UV(n/this.segmentsT,1-i/this.segmentsR)),t.push(a.clone().subSelf(r).normalize())}for(i=1;this.segmentsR>=i;i++)for(n=1;this.segmentsT>=n;n++){var r=(this.segmentsT+1)*i+n-1,s=(this.segmentsT+1)*(i-1)+n-1,o=(this.segmentsT+1)*(i-1)+n,a=(this.segmentsT+1)*i+n,l=new THREE.Face4(r,s,o,a,[t[r],t[s],t[o],t[a]]);l.normal.addSelf(t[r]),l.normal.addSelf(t[s]),l.normal.addSelf(t[o]),l.normal.addSelf(t[a]),l.normal.normalize(),this.faces.push(l),this.faceVertexUvs[0].push([e[r].clone(),e[s].clone(),e[o].clone(),e[a].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=new THREE.Geometry,THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,i,n,r,s,o){function a(e,t,i,n,r,s){var o=Math.cos(e);return Math.cos(t),t=Math.sin(e),e=i/n*e,i=Math.cos(e),o=.5*r*(2+i)*o,t=.5*r*(2+i)*t,r=.5*s*r*Math.sin(e),new THREE.Vector3(o,t,r)}for(THREE.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=i||64,this.segmentsT=n||8,this.p=r||2,this.q=s||3,this.heightScale=o||1,this.grid=Array(this.segmentsR),i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,e=0;this.segmentsR>e;++e)for(this.grid[e]=Array(this.segmentsT),t=0;this.segmentsT>t;++t){var l=2*(e/this.segmentsR)*this.p*Math.PI,o=2*(t/this.segmentsT)*Math.PI,s=a(l,o,this.q,this.p,this.radius,this.heightScale),l=a(l+.01,o,this.q,this.p,this.radius,this.heightScale);i.sub(l,s),n.add(l,s),r.cross(i,n),n.cross(r,i),r.normalize(),n.normalize(),l=-this.tube*Math.cos(o),o=this.tube*Math.sin(o),s.x=s.x+(l*n.x+o*r.x),s.y=s.y+(l*n.y+o*r.y),s.z=s.z+(l*n.z+o*r.z),this.grid[e][t]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1}for(e=0;this.segmentsR>e;++e)for(t=0;this.segmentsT>t;++t){var r=(e+1)%this.segmentsR,s=(t+1)%this.segmentsT,i=this.grid[e][t],n=this.grid[r][t],r=this.grid[r][s],s=this.grid[e][s],o=new THREE.UV(e/this.segmentsR,t/this.segmentsT),l=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),h=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),c=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(i,n,r,s)),this.faceVertexUvs[0].push([o,l,h,c])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=new THREE.Geometry,THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TubeGeometry=function(e,t,i,n,r,s){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.segmentsRadius=n||8,this.closed=r||!1,s&&(this.debug=new THREE.Object3D),this.grid=[];var o,a,l,h,c,u,d,p,s=this.segments+1,f=new THREE.Vector3,t=new THREE.TubeGeometry.FrenetFrames(e,t,r);for(u=t.tangents,d=t.normals,p=t.binormals,this.tangents=u,this.normals=d,this.binormals=p,t=0;s>t;t++)for(this.grid[t]=[],n=t/(s-1),c=e.getPointAt(n),n=u[t],o=d[t],a=p[t],this.debug&&(this.debug.add(new THREE.ArrowHelper(n,c,i,255)),this.debug.add(new THREE.ArrowHelper(o,c,i,16711680)),this.debug.add(new THREE.ArrowHelper(a,c,i,65280))),n=0;this.segmentsRadius>n;n++)l=2*(n/this.segmentsRadius)*Math.PI,h=-this.radius*Math.cos(l),l=this.radius*Math.sin(l),f.copy(c),f.x=f.x+(h*o.x+l*a.x),f.y=f.y+(h*o.y+l*a.y),f.z=f.z+(h*o.z+l*a.z),this.grid[t][n]=this.vertices.push(new THREE.Vector3(f.x,f.y,f.z))-1;for(t=0;this.segments>t;t++)for(n=0;this.segmentsRadius>n;n++)s=r?(t+1)%this.segments:t+1,f=(n+1)%this.segmentsRadius,e=this.grid[t][n],i=this.grid[s][n],s=this.grid[s][f],f=this.grid[t][f],u=new THREE.UV(t/this.segments,n/this.segmentsRadius),d=new THREE.UV((t+1)/this.segments,n/this.segmentsRadius),p=new THREE.UV((t+1)/this.segments,(n+1)/this.segmentsRadius),o=new THREE.UV(t/this.segments,(n+1)/this.segmentsRadius),this.faces.push(new THREE.Face4(e,i,s,f)),this.faceVertexUvs[0].push([u,d,p,o]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=new THREE.Geometry,THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.FrenetFrames=function(e,t,i){new THREE.Vector3;var n=new THREE.Vector3;new THREE.Vector3;var r,s,o,a=[],l=[],h=[],c=new THREE.Vector3,u=new THREE.Matrix4,t=t+1;for(this.tangents=a,this.normals=l,this.binormals=h,r=0;t>r;r++)s=r/(t-1),a[r]=e.getTangentAt(s),a[r].normalize();for(l[0]=new THREE.Vector3,h[0]=new THREE.Vector3,e=Number.MAX_VALUE,r=Math.abs(a[0].x),s=Math.abs(a[0].y),o=Math.abs(a[0].z),e>=r&&(e=r,n.set(1,0,0)),e>=s&&(e=s,n.set(0,1,0)),e>=o&&n.set(0,0,1),c.cross(a[0],n).normalize(),l[0].cross(a[0],c),h[0].cross(a[0],l[0]),r=1;t>r;r++)l[r]=l[r-1].clone(),h[r]=h[r-1].clone(),c.cross(a[r-1],a[r]),c.length()>1e-4&&(c.normalize(),n=Math.acos(a[r-1].dot(a[r])),u.makeRotationAxis(c,n).multiplyVector3(l[r])),h[r].cross(a[r],l[r]);if(i)for(n=Math.acos(l[0].dot(l[t-1])),n/=t-1,a[0].dot(c.cross(l[0],l[t-1]))>0&&(n=-n),r=1;t>r;r++)u.makeRotationAxis(a[r],n*r).multiplyVector3(l[r]),h[r].cross(a[r],l[r])},THREE.PolyhedronGeometry=function(e,t,i,n){function r(e){var t=e.normalize().clone();t.index=l.vertices.push(t)-1;var i=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new THREE.UV(i,e),t}function s(e,t,i,n){1>n?(n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]),n.centroid.addSelf(e).addSelf(t).addSelf(i).divideScalar(3),n.normal=n.centroid.clone().normalize(),l.faces.push(n),n=Math.atan2(n.centroid.z,-n.centroid.x),l.faceVertexUvs[0].push([a(e.uv,e,n),a(t.uv,t,n),a(i.uv,i,n)])):(n-=1,s(e,o(e,t),o(e,i),n),s(o(e,t),t,o(t,i),n),s(o(e,i),o(t,i),i,n),s(o(e,t),o(t,i),o(e,i),n))}function o(e,t){u[e.index]||(u[e.index]=[]),u[t.index]||(u[t.index]=[]);var i=u[e.index][t.index];return void 0===i&&(u[e.index][t.index]=u[t.index][e.index]=i=r((new THREE.Vector3).add(e,t).divideScalar(2))),i}function a(e,t,i){return 0>i&&1===e.u&&(e=new THREE.UV(e.u-1,e.v)),0===t.x&&0===t.z&&(e=new THREE.UV(i/2/Math.PI+.5,e.v)),e}THREE.Geometry.call(this);for(var i=i||1,n=n||0,l=this,h=0,c=e.length;c>h;h++)r(new THREE.Vector3(e[h][0],e[h][1],e[h][2]));for(var u=[],e=this.vertices,h=0,c=t.length;c>h;h++)s(e[t[h][0]],e[t[h][1]],e[t[h][2]],n);for(this.mergeVertices(),h=0,c=this.vertices.length;c>h;h++)this.vertices[h].multiplyScalar(i);this.computeCentroids(),this.boundingSphere={radius:i}},THREE.PolyhedronGeometry.prototype=new THREE.Geometry,THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=new THREE.Geometry,THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=new THREE.Geometry,THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=new THREE.Geometry,THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.ParametricGeometry=function(e,t,i,n){THREE.Geometry.call(this);var r,s,o,a,l=this.vertices,h=this.faces,c=this.faceVertexUvs[0],n=void 0===n?!1:n,u=t+1;for(r=0;i>=r;r++)for(a=r/i,s=0;t>=s;s++)o=s/t,o=e(o,a),l.push(o);var d,p,f,m;for(r=0;i>r;r++)for(s=0;t>s;s++)e=r*u+s,l=r*u+s+1,a=(r+1)*u+s,o=(r+1)*u+s+1,d=new THREE.UV(r/t,s/i),p=new THREE.UV(r/t,(s+1)/i),f=new THREE.UV((r+1)/t,s/i),m=new THREE.UV((r+1)/t,(s+1)/i),n?(h.push(new THREE.Face3(e,l,a)),h.push(new THREE.Face3(l,o,a)),c.push([d,p,f]),c.push([p,m,f])):(h.push(new THREE.Face4(e,l,o,a)),c.push([d,p,f,m]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=new THREE.Geometry,THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.AxisHelper=function(){THREE.Object3D.call(this);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3),e.vertices.push(new THREE.Vector3(0,100,0));var t,i=new THREE.CylinderGeometry(0,5,25,5,1);t=new THREE.Line(e,new THREE.LineBasicMaterial({color:16711680})),t.rotation.z=-Math.PI/2,this.add(t),t=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:16711680})),t.position.x=100,t.rotation.z=-Math.PI/2,this.add(t),t=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280})),this.add(t),t=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:65280})),t.position.y=100,this.add(t),t=new THREE.Line(e,new THREE.LineBasicMaterial({color:255})),t.rotation.x=Math.PI/2,this.add(t),t=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:255})),t.position.z=100,t.rotation.x=Math.PI/2,this.add(t)},THREE.AxisHelper.prototype=new THREE.Object3D,THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(e,t,i,n){THREE.Object3D.call(this),void 0===n&&(n=16776960),void 0===i&&(i=20);var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(0,0,0)),r.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(r,new THREE.LineBasicMaterial({color:n})),this.add(this.line),r=new THREE.CylinderGeometry(0,.05,.25,5,1),this.cone=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:n})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof THREE.Vector3&&(this.position=t),this.setDirection(e),this.setLength(i)},THREE.ArrowHelper.prototype=new THREE.Object3D,THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(e){var t=new THREE.Vector3(0,1,0).crossSelf(e),e=Math.acos(new THREE.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),e),this.rotation.getRotationFromMatrix(this.matrix,this.scale)},THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.CameraHelper=function(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){n.lineGeometry.vertices.push(new THREE.Vector3),n.lineGeometry.colors.push(new THREE.Color(t)),void 0===n.pointMap[e]&&(n.pointMap[e]=[]),n.pointMap[e].push(n.lineGeometry.vertices.length-1)}THREE.Object3D.call(this);var n=this;this.lineGeometry=new THREE.Geometry,this.lineMaterial=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e),this.lines=new THREE.Line(this.lineGeometry,this.lineMaterial,THREE.LinePieces),this.add(this.lines)},THREE.CameraHelper.prototype=new THREE.Object3D,THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function e(e,i,n,r){if(THREE.CameraHelper.__v.set(i,n,r),THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c),e=t.pointMap[e],void 0!==e)for(i=0,n=e.length;n>i;i++)t.lineGeometry.vertices[e[i]].copy(THREE.CameraHelper.__v)}var t=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.lineGeometry.verticesNeedUpdate=!0},THREE.CameraHelper.__projector=new THREE.Projector,THREE.CameraHelper.__v=new THREE.Vector3,THREE.CameraHelper.__c=new THREE.Camera,THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier,THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-->0;)this.smooth(e)},THREE.SubdivisionModifier.prototype.smooth=function(e){function t(){v.debug&&console.log.apply(console,arguments)}function i(){console&&console.log.apply(console,arguments)}function n(e,i,n,r,o,a,l){var h=new THREE.Face4(e,i,n,r,null,o.color,o.material);if(v.useOldVertexColors){h.vertexColors=[];for(var c,u,d,p=0;4>p;p++){d=a[p],c=new THREE.Color,c.setRGB(0,0,0);for(var f=0;d.length>f;f++)u=o.vertexColors[d[f]-1],c.r=c.r+u.r,c.g=c.g+u.g,c.b=c.b+u.b;c.r=c.r/d.length,c.g=c.g/d.length,c.b=c.b/d.length,h.vertexColors[p]=c}}g.push(h),v.supportUVs&&(o=[s(e,""),s(i,l),s(n,l),s(r,l)],o[0]?o[1]?o[2]?o[3]?y.push(o):t("d :( ",r+":"+l):t("c :( ",n+":"+l):t("b :( ",i+":"+l):t("a :( ",e+":"+l))}function r(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function s(e,n){var r=e+":"+n,s=S[r];return s?s:(e>=E&&E+x.length>e?t("face pt"):t("edge pt"),i("warning, UV not found for",r),null)}function o(e,t,n){var r=e+":"+t;r in S?i("dup vertexNo",e,"oldFaceNo",t,"value",n,"key",r,S[r]):S[r]=n}function a(e,t){void 0===k[e]&&(k[e]=[]),k[e].push(t)}function l(e,t,i){void 0===P[e]&&(P[e]={}),P[e][t]=i}var h,c,u,d,p,f,m=[],g=[],y=[],v=this,b=e.vertices,x=e.faces,m=b.concat(),L=[],w={},C={},S={},E=b.length,O=e.faceVertexUvs[0];if(t("originalFaces, uvs, originalVerticesLength",x.length,O.length,E),v.supportUVs)for(h=0,c=O.length;c>h;h++)for(u=0,d=O[h].length;d>u;u++)f=x[h]["abcd".charAt(u)],o(f,h,O[h][u]);0==O.length&&(v.supportUVs=!1),h=0;for(p in S)h++;for(h||(v.supportUVs=!1,t("no uvs")),t("-- Original Faces + Vertices UVs completed",S,"vs",O.length),h=0,c=x.length;c>h;h++)p=x[h],L.push(p.centroid),m.push(p.centroid),v.supportUVs&&(O=new THREE.UV,p instanceof THREE.Face3?(O.u=s(p.a,h).u+s(p.b,h).u+s(p.c,h).u,O.v=s(p.a,h).v+s(p.b,h).v+s(p.c,h).v,O.u=O.u/3,O.v=O.v/3):p instanceof THREE.Face4&&(O.u=s(p.a,h).u+s(p.b,h).u+s(p.c,h).u+s(p.d,h).u,O.v=s(p.a,h).v+s(p.b,h).v+s(p.c,h).v+s(p.d,h).v,O.u=O.u/4,O.v=O.v/4),o(E+h,"",O));t("-- added UVs for new Faces",S),c=function(e){function t(e,t){void 0===a[e]&&(a[e]=[]),a[e].push(t)}var i,n,s,o,a={};for(i=0,n=e.faces.length;n>i;i++)s=e.faces[i],s instanceof THREE.Face3?(o=r(s.a,s.b),t(o,i),o=r(s.b,s.c),t(o,i),o=r(s.c,s.a),t(o,i)):s instanceof THREE.Face4&&(o=r(s.a,s.b),t(o,i),o=r(s.b,s.c),t(o,i),o=r(s.c,s.d),t(o,i),o=r(s.d,s.a),t(o,i));return a}(e),f=0;var _,T,k={},P={};for(h in c){for(O=c[h],_=h.split("_"),T=_[0],_=_[1],a(T,[T,_]),a(_,[T,_]),u=0,d=O.length;d>u;u++)p=O[u],l(T,p,h),l(_,p,h);2>O.length&&(C[h]=!0)}t("vertexEdgeMap",k,"vertexFaceMap",P);for(h in c)O=c[h],p=O[0],d=O[1],_=h.split("_"),T=_[0],_=_[1],O=new THREE.Vector3,C[h]?(O.addSelf(b[T]),O.addSelf(b[_]),O.multiplyScalar(.5)):(O.addSelf(L[p]),O.addSelf(L[d]),O.addSelf(b[T]),O.addSelf(b[_]),O.multiplyScalar(.25)),w[h]=E+x.length+f,m.push(O),f++,v.supportUVs&&(O=new THREE.UV,O.u=s(T,p).u+s(_,p).u,O.v=s(T,p).v+s(_,p).v,O.u=O.u/2,O.v=O.v/2,o(w[h],p,O),C[h]||(O=new THREE.UV,O.u=s(T,d).u+s(_,d).u,O.v=s(T,d).v+s(_,d).v,O.u=O.u/2,O.v=O.v/2,o(w[h],d,O)));t("-- Step 2 done");var A,M;d=["123","12","2","23"],_=["123","23","3","31"];var N=["123","31","1","12"],R=["1234","12","2","23"],D=["1234","23","3","34"],I=["1234","34","4","41"],F=["1234","41","1","12"];for(h=0,c=L.length;c>h;h++)p=x[h],O=E+h,p instanceof THREE.Face3?(f=r(p.a,p.b),T=r(p.b,p.c),A=r(p.c,p.a),n(O,w[f],p.b,w[T],p,d,h),n(O,w[T],p.c,w[A],p,_,h),n(O,w[A],p.a,w[f],p,N,h)):p instanceof THREE.Face4?(f=r(p.a,p.b),T=r(p.b,p.c),A=r(p.c,p.d),M=r(p.d,p.a),n(O,w[f],p.b,w[T],p,R,h),n(O,w[T],p.c,w[A],p,D,h),n(O,w[A],p.d,w[M],p,I,h),n(O,w[M],p.a,w[f],p,F,h)):t("face should be a face!",p);for(w=new THREE.Vector3,p=new THREE.Vector3,h=0,c=b.length;c>h;h++)if(void 0!==k[h]){w.set(0,0,0),p.set(0,0,0),T=new THREE.Vector3(0,0,0),O=0;for(u in P[h])w.addSelf(L[u]),O++;for(d=0,f=k[h].length,u=0;f>u;u++)C[r(k[h][u][0],k[h][u][1])]&&d++;if(2!=d){for(w.divideScalar(O),u=0;f>u;u++)O=k[h][u],O=b[O[0]].clone().addSelf(b[O[1]]).divideScalar(2),p.addSelf(O);p.divideScalar(f),T.addSelf(b[h]),T.multiplyScalar(f-3),T.addSelf(w),T.addSelf(p.multiplyScalar(2)),T.divideScalar(f),m[h]=T}}e.vertices=m,e.faces=g,e.faceVertexUvs[0]=y,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=new THREE.Object3D,THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.LensFlare=function(e,t,i,n,r){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)},THREE.LensFlare.prototype=new THREE.Object3D,THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.supr=THREE.Object3D.prototype,THREE.LensFlare.prototype.add=function(e,t,i,n,r,s){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===s&&(s=1),void 0===r&&(r=new THREE.Color(16777215)),void 0===n&&(n=THREE.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:r,blending:n})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=.25*t.x*Math.PI,t.rotation=t.rotation+.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=new THREE.Mesh,THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){t={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,n={},r=this.geometry,s=0,o=r.morphTargets.length;o>s;s++){var a=r.morphTargets[s].name.match(i);if(a&&a.length>1){var l=a[1];n[l]||(n[l]={start:1/0,end:-1/0}),a=n[l],a.start>s&&(a.start=s),s>a.end&&(a.end=s),t||(t=l)}}for(l in n)a=n[l],this.createAnimation(l,a.start,a.end,e);this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var n=this.animationsList[t];if(n.active){var r=n.duration/n.length;n.time=n.time+n.direction*e,n.mirroredLoop?(n.time>n.duration||0>n.time)&&(n.direction=-1*n.direction,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),0>n.time&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,0>n.time&&(n.time=n.time+n.duration));var s=n.startFrame+THREE.Math.clamp(Math.floor(n.time/r),0,n.length-1),o=n.weight;s!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*o,this.morphTargetInfluences[s]=0,n.lastFrame=n.currentFrame,n.currentFrame=s),r=n.time%r/r,n.directionBackwards&&(r=1-r),this.morphTargetInfluences[n.currentFrame]=r*o,this.morphTargetInfluences[n.lastFrame]=(1-r)*o}}},THREE.LensFlarePlugin=function(){function e(e){var i=t.createProgram(),n=t.createShader(t.FRAGMENT_SHADER),r=t.createShader(t.VERTEX_SHADER);return t.shaderSource(n,e.fragmentShader),t.shaderSource(r,e.vertexShader),t.compileShader(n),t.compileShader(r),t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),i}var t,i,n,r,s,o,a,l,h,c,u,d,p;this.init=function(f){t=f.context,i=f,n=new Float32Array(16),r=new Uint16Array(6),f=0,n[f++]=-1,n[f++]=-1,n[f++]=0,n[f++]=0,n[f++]=1,n[f++]=-1,n[f++]=1,n[f++]=0,n[f++]=1,n[f++]=1,n[f++]=1,n[f++]=1,n[f++]=-1,n[f++]=1,n[f++]=0,n[f++]=1,f=0,r[f++]=0,r[f++]=1,r[f++]=2,r[f++]=0,r[f++]=2,r[f++]=3,s=t.createBuffer(),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),a=t.createTexture(),l=t.createTexture(),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),0>=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(h=!1,c=e(THREE.ShaderFlares.lensFlare)):(h=!0,c=e(THREE.ShaderFlares.lensFlareVertexTexture)),u={},d={},u.vertex=t.getAttribLocation(c,"position"),u.uv=t.getAttribLocation(c,"uv"),d.renderType=t.getUniformLocation(c,"renderType"),d.map=t.getUniformLocation(c,"map"),d.occlusionMap=t.getUniformLocation(c,"occlusionMap"),d.opacity=t.getUniformLocation(c,"opacity"),d.color=t.getUniformLocation(c,"color"),d.scale=t.getUniformLocation(c,"scale"),d.rotation=t.getUniformLocation(c,"rotation"),d.screenPosition=t.getUniformLocation(c,"screenPosition"),p=!1},this.render=function(e,n,r,f){var e=e.__webglFlares,m=e.length;if(m){var g=new THREE.Vector3,y=f/r,v=.5*r,b=.5*f,x=16/f,L=new THREE.Vector2(x*y,x),w=new THREE.Vector3(1,1,0),C=new THREE.Vector2(1,1),S=d,x=u;t.useProgram(c),p||(t.enableVertexAttribArray(u.vertex),t.enableVertexAttribArray(u.uv),p=!0),t.uniform1i(S.occlusionMap,0),t.uniform1i(S.map,1),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.disable(t.CULL_FACE),t.depthMask(!1);
var E,O,_,T,k;for(E=0;m>E;E++)if(x=16/f,L.set(x*y,x),T=e[E],g.set(T.matrixWorld.elements[12],T.matrixWorld.elements[13],T.matrixWorld.elements[14]),n.matrixWorldInverse.multiplyVector3(g),n.projectionMatrix.multiplyVector3(g),w.copy(g),C.x=w.x*v+v,C.y=w.y*b+b,h||C.x>0&&r>C.x&&C.y>0&&f>C.y)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,C.x-8,C.y-8,16,16,0),t.uniform1i(S.renderType,0),t.uniform2f(S.scale,L.x,L.y),t.uniform3f(S.screenPosition,w.x,w.y,w.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,C.x-8,C.y-8,16,16,0),t.uniform1i(S.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),T.positionScreen.copy(w),T.customUpdateCallback?T.customUpdateCallback(T):T.updateLensFlares(),t.uniform1i(S.renderType,2),t.enable(t.BLEND),O=0,_=T.lensFlares.length;_>O;O++)k=T.lensFlares[O],k.opacity>.001&&k.scale>.001&&(w.x=k.x,w.y=k.y,w.z=k.z,x=k.size*k.scale/f,L.x=x*y,L.y=x,t.uniform3f(S.screenPosition,w.x,w.y,w.z),t.uniform2f(S.scale,L.x,L.y),t.uniform1f(S.rotation,k.rotation),t.uniform1f(S.opacity,k.opacity),t.uniform3f(S.color,k.color.r,k.color.g,k.color.b),i.setBlending(k.blending,k.blendEquation,k.blendSrc,k.blendDst),i.setTexture(k.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,i,n,r=new THREE.Frustum,s=new THREE.Matrix4,o=new THREE.Vector3,a=new THREE.Vector3;this.init=function(r){e=r.context,t=r;var r=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(r.uniforms);i=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:s}),n=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:s,morphTargets:!0}),i._shadowPass=!0,n._shadowPass=!0},this.render=function(e,i){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,i)},this.update=function(l,h){var c,u,d,p,f,m,g,y,v,b=[];for(p=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),c=0,u=l.__lights.length;u>c;c++)if(d=l.__lights[c],d.castShadow)if(d instanceof THREE.DirectionalLight&&d.shadowCascade)for(f=0;d.shadowCascadeCount>f;f++){var x;if(d.shadowCascadeArray[f])x=d.shadowCascadeArray[f];else{v=d,g=f,x=new THREE.DirectionalLight,x.isVirtual=!0,x.onlyShadow=!0,x.castShadow=!0,x.shadowCameraNear=v.shadowCameraNear,x.shadowCameraFar=v.shadowCameraFar,x.shadowCameraLeft=v.shadowCameraLeft,x.shadowCameraRight=v.shadowCameraRight,x.shadowCameraBottom=v.shadowCameraBottom,x.shadowCameraTop=v.shadowCameraTop,x.shadowCameraVisible=v.shadowCameraVisible,x.shadowDarkness=v.shadowDarkness,x.shadowBias=v.shadowCascadeBias[g],x.shadowMapWidth=v.shadowCascadeWidth[g],x.shadowMapHeight=v.shadowCascadeHeight[g],x.pointsWorld=[],x.pointsFrustum=[],y=x.pointsWorld,m=x.pointsFrustum;for(var L=0;8>L;L++)y[L]=new THREE.Vector3,m[L]=new THREE.Vector3;y=v.shadowCascadeNearZ[g],v=v.shadowCascadeFarZ[g],m[0].set(-1,-1,y),m[1].set(1,-1,y),m[2].set(-1,1,y),m[3].set(1,1,y),m[4].set(-1,-1,v),m[5].set(1,-1,v),m[6].set(-1,1,v),m[7].set(1,1,v),x.originalCamera=h,m=new THREE.Gyroscope,m.position=d.shadowCascadeOffset,m.add(x),m.add(x.target),h.add(m),d.shadowCascadeArray[f]=x,console.log("Created virtualLight",x)}g=d,y=f,v=g.shadowCascadeArray[y],v.position.copy(g.position),v.target.position.copy(g.target.position),v.lookAt(v.target),v.shadowCameraVisible=g.shadowCameraVisible,v.shadowDarkness=g.shadowDarkness,v.shadowBias=g.shadowCascadeBias[y],m=g.shadowCascadeNearZ[y],g=g.shadowCascadeFarZ[y],v=v.pointsFrustum,v[0].z=m,v[1].z=m,v[2].z=m,v[3].z=m,v[4].z=g,v[5].z=g,v[6].z=g,v[7].z=g,b[p]=x,p++}else b[p]=d,p++;for(c=0,u=b.length;u>c;c++){if(d=b[c],d.shadowMap||(d.shadowMap=new THREE.WebGLRenderTarget(d.shadowMapWidth,d.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),d.shadowMapSize=new THREE.Vector2(d.shadowMapWidth,d.shadowMapHeight),d.shadowMatrix=new THREE.Matrix4),!d.shadowCamera){if(d instanceof THREE.SpotLight)d.shadowCamera=new THREE.PerspectiveCamera(d.shadowCameraFov,d.shadowMapWidth/d.shadowMapHeight,d.shadowCameraNear,d.shadowCameraFar);else{if(!(d instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}d.shadowCamera=new THREE.OrthographicCamera(d.shadowCameraLeft,d.shadowCameraRight,d.shadowCameraTop,d.shadowCameraBottom,d.shadowCameraNear,d.shadowCameraFar)}l.add(d.shadowCamera),t.autoUpdateScene&&l.updateMatrixWorld()}if(d.shadowCameraVisible&&!d.cameraHelper&&(d.cameraHelper=new THREE.CameraHelper(d.shadowCamera),d.shadowCamera.add(d.cameraHelper)),d.isVirtual&&x.originalCamera==h){for(f=h,p=d.shadowCamera,m=d.pointsFrustum,v=d.pointsWorld,o.set(1/0,1/0,1/0),a.set(-1/0,-1/0,-1/0),g=0;8>g;g++)y=v[g],y.copy(m[g]),THREE.ShadowMapPlugin.__projector.unprojectVector(y,f),p.matrixWorldInverse.multiplyVector3(y),y.x<o.x&&(o.x=y.x),y.x>a.x&&(a.x=y.x),y.y<o.y&&(o.y=y.y),y.y>a.y&&(a.y=y.y),y.z<o.z&&(o.z=y.z),y.z>a.z&&(a.z=y.z);p.left=o.x,p.right=a.x,p.top=a.y,p.bottom=o.y,p.updateProjectionMatrix()}for(p=d.shadowMap,m=d.shadowMatrix,f=d.shadowCamera,f.position.copy(d.matrixWorld.getPosition()),f.lookAt(d.target.matrixWorld.getPosition()),f.updateMatrixWorld(),f.matrixWorldInverse.getInverse(f.matrixWorld),d.cameraHelper&&(d.cameraHelper.lines.visible=d.shadowCameraVisible),d.shadowCameraVisible&&d.cameraHelper.update(),m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiplySelf(f.projectionMatrix),m.multiplySelf(f.matrixWorldInverse),f._viewMatrixArray||(f._viewMatrixArray=new Float32Array(16)),f._projectionMatrixArray||(f._projectionMatrixArray=new Float32Array(16)),f.matrixWorldInverse.flattenToArray(f._viewMatrixArray),f.projectionMatrix.flattenToArray(f._projectionMatrixArray),s.multiply(f.projectionMatrix,f.matrixWorldInverse),r.setFromMatrix(s),t.setRenderTarget(p),t.clear(),v=l.__webglObjects,d=0,p=v.length;p>d;d++)g=v[d],m=g.object,g.render=!1,!m.visible||!m.castShadow||m instanceof THREE.Mesh&&m.frustumCulled&&!r.contains(m)||(m._modelViewMatrix.multiply(f.matrixWorldInverse,m.matrixWorld),g.render=!0);for(d=0,p=v.length;p>d;d++)g=v[d],g.render&&(m=g.object,g=g.buffer,y=m.customDepthMaterial?m.customDepthMaterial:m.geometry.morphTargets.length?n:i,g instanceof THREE.BufferGeometry?t.renderBufferDirect(f,l.__lights,null,y,g,m):t.renderBuffer(f,l.__lights,null,y,g,m));for(v=l.__webglObjectsImmediate,d=0,p=v.length;p>d;d++)g=v[d],m=g.object,m.visible&&m.castShadow&&(m._modelViewMatrix.multiply(f.matrixWorldInverse,m.matrixWorld),t.renderImmediateObject(f,l.__lights,null,i,m))}c=t.getClearColor(),u=t.getClearAlpha(),e.clearColor(c.r,c.g,c.b,u),e.enable(e.BLEND),t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,i,n,r,s,o,a,l,h,c;this.init=function(e){t=e.context,i=e,n=new Float32Array(16),r=new Uint16Array(6),e=0,n[e++]=-1,n[e++]=-1,n[e++]=0,n[e++]=1,n[e++]=1,n[e++]=-1,n[e++]=1,n[e++]=1,n[e++]=1,n[e++]=1,n[e++]=1,n[e++]=0,n[e++]=-1,n[e++]=1,n[e++]=0,e=n[e++]=0,r[e++]=0,r[e++]=1,r[e++]=2,r[e++]=0,r[e++]=2,r[e++]=3,s=t.createBuffer(),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW);var e=THREE.ShaderSprite.sprite,u=t.createProgram(),d=t.createShader(t.FRAGMENT_SHADER),p=t.createShader(t.VERTEX_SHADER);t.shaderSource(d,e.fragmentShader),t.shaderSource(p,e.vertexShader),t.compileShader(d),t.compileShader(p),t.attachShader(u,d),t.attachShader(u,p),t.linkProgram(u),a=u,l={},h={},l.position=t.getAttribLocation(a,"position"),l.uv=t.getAttribLocation(a,"uv"),h.uvOffset=t.getUniformLocation(a,"uvOffset"),h.uvScale=t.getUniformLocation(a,"uvScale"),h.rotation=t.getUniformLocation(a,"rotation"),h.scale=t.getUniformLocation(a,"scale"),h.alignment=t.getUniformLocation(a,"alignment"),h.color=t.getUniformLocation(a,"color"),h.map=t.getUniformLocation(a,"map"),h.opacity=t.getUniformLocation(a,"opacity"),h.useScreenCoordinates=t.getUniformLocation(a,"useScreenCoordinates"),h.affectedByDistance=t.getUniformLocation(a,"affectedByDistance"),h.screenPosition=t.getUniformLocation(a,"screenPosition"),h.modelViewMatrix=t.getUniformLocation(a,"modelViewMatrix"),h.projectionMatrix=t.getUniformLocation(a,"projectionMatrix"),c=!1},this.render=function(n,r,u,d){var n=n.__webglSprites,p=n.length;if(p){var f=l,m=h,g=d/u,u=.5*u,y=.5*d,v=!0;t.useProgram(a),c||(t.enableVertexAttribArray(f.position),t.enableVertexAttribArray(f.uv),c=!0),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.depthMask(!0),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(f.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(f.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.uniformMatrix4fv(m.projectionMatrix,!1,r._projectionMatrixArray),t.activeTexture(t.TEXTURE0),t.uniform1i(m.map,0);for(var b,x=[],f=0;p>f;f++)b=n[f],b.visible&&0!==b.opacity&&(b.useScreenCoordinates?b.z=-b.position.z:(b._modelViewMatrix.multiply(r.matrixWorldInverse,b.matrixWorld),b.z=-b._modelViewMatrix.elements[14]));for(n.sort(e),f=0;p>f;f++)b=n[f],b.visible&&0!==b.opacity&&b.map&&b.map.image&&b.map.image.width&&(b.useScreenCoordinates?(t.uniform1i(m.useScreenCoordinates,1),t.uniform3f(m.screenPosition,(b.position.x-u)/u,(y-b.position.y)/y,Math.max(0,Math.min(1,b.position.z)))):(t.uniform1i(m.useScreenCoordinates,0),t.uniform1i(m.affectedByDistance,b.affectedByDistance?1:0),t.uniformMatrix4fv(m.modelViewMatrix,!1,b._modelViewMatrix.elements)),r=b.map.image.width/(b.scaleByViewport?d:1),x[0]=r*g*b.scale.x,x[1]=r*b.scale.y,t.uniform2f(m.uvScale,b.uvScale.x,b.uvScale.y),t.uniform2f(m.uvOffset,b.uvOffset.x,b.uvOffset.y),t.uniform2f(m.alignment,b.alignment.x,b.alignment.y),t.uniform1f(m.opacity,b.opacity),t.uniform3f(m.color,b.color.r,b.color.g,b.color.b),t.uniform1f(m.rotation,b.rotation),t.uniform2fv(m.scale,x),b.mergeWith3D&&!v?(t.enable(t.DEPTH_TEST),v=!0):!b.mergeWith3D&&v&&(t.disable(t.DEPTH_TEST),v=!1),i.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),i.setTexture(b.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,i,n,r=new THREE.Frustum,s=new THREE.Matrix4;this.init=function(r){e=r.context,t=r;var r=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(r.uniforms);i=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:s}),n=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:s,morphTargets:!0}),i._shadowPass=!0,n._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(o,a){var l,h,c,u,d,p;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&o.updateMatrixWorld(),a._viewMatrixArray||(a._viewMatrixArray=new Float32Array(16)),a._projectionMatrixArray||(a._projectionMatrixArray=new Float32Array(16)),a.matrixWorldInverse.getInverse(a.matrixWorld),a.matrixWorldInverse.flattenToArray(a._viewMatrixArray),a.projectionMatrix.flattenToArray(a._projectionMatrixArray),s.multiply(a.projectionMatrix,a.matrixWorldInverse),r.setFromMatrix(s),t.setRenderTarget(this.renderTarget),t.clear(),p=o.__webglObjects,l=0,h=p.length;h>l;l++)c=p[l],d=c.object,c.render=!1,!d.visible||d instanceof THREE.Mesh&&d.frustumCulled&&!r.contains(d)||(d._modelViewMatrix.multiply(a.matrixWorldInverse,d.matrixWorld),c.render=!0);for(l=0,h=p.length;h>l;l++)c=p[l],c.render&&(d=c.object,c=c.buffer,t.setObjectFaces(d),u=d.customDepthMaterial?d.customDepthMaterial:d.geometry.morphTargets.length?n:i,c instanceof THREE.BufferGeometry?t.renderBufferDirect(a,o.__lights,null,u,c,d):t.renderBuffer(a,o.__lights,null,u,c,d));for(p=o.__webglObjectsImmediate,l=0,h=p.length;h>l;l++)c=p[l],d=c.object,d.visible&&d.castShadow&&(d._modelViewMatrix.multiply(a.matrixWorldInverse,d.matrixWorld),t.renderImmediateObject(a,o.__lights,null,i,d));l=t.getClearColor(),h=t.getClearAlpha(),e.clearColor(l.r,l.g,l.b,h),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};